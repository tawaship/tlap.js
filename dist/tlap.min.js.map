{"version":3,"file":"tlap.min.js","sources":["../src/Anchor.ts","../node_modules/ismobilejs/esm/isMobile.js","../src/Application.ts","../src/BodyPosition.ts","../src/BodyRotation.ts","../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../node_modules/@tawaship/task/dist/Task.esm.js","../src/DisplayObject.ts","../src/Object3D.ts","../src/Camera.ts","../src/Object2D.ts","../src/Container2D.ts","../src/Container3D.ts","../src/Content.ts","../src/Mesh.ts","../src/OIMO.ts","../src/PhysicsObject3D.ts","../src/View.ts","../src/PhysicsView.ts","../src/Sprite.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport { IMesh } from './IMesh';\r\n\r\nexport class Anchor {\r\n\tprivate _x: number;\r\n\tprivate _y: number;\r\n\tprivate _z: number;\r\n\tprivate _mesh: IMesh;\r\n\t\r\n\tconstructor(x: number, y: number, z: number, mesh: IMesh) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._mesh = mesh;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._x = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._y = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._z = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\t\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n}","var appleIphone = /iPhone/i;\nvar appleIpod = /iPod/i;\nvar appleTablet = /iPad/i;\nvar appleUniversal = /\\biOS-universal(?:.+)Mac\\b/i;\nvar androidPhone = /\\bAndroid(?:.+)Mobile\\b/i;\nvar androidTablet = /Android/i;\nvar amazonPhone = /(?:SD4930UR|\\bSilk(?:.+)Mobile\\b)/i;\nvar amazonTablet = /Silk/i;\nvar windowsPhone = /Windows Phone/i;\nvar windowsTablet = /\\bWindows(?:.+)ARM\\b/i;\nvar otherBlackBerry = /BlackBerry/i;\nvar otherBlackBerry10 = /BB10/i;\nvar otherOpera = /Opera Mini/i;\nvar otherChrome = /\\b(CriOS|Chrome)(?:.+)Mobile/i;\nvar otherFirefox = /Mobile(?:.+)Firefox\\b/i;\nvar isAppleTabletOnIos13 = function (navigator) {\n    return (typeof navigator !== 'undefined' &&\n        navigator.platform === 'MacIntel' &&\n        typeof navigator.maxTouchPoints === 'number' &&\n        navigator.maxTouchPoints > 1 &&\n        typeof MSStream === 'undefined');\n};\nfunction createMatch(userAgent) {\n    return function (regex) { return regex.test(userAgent); };\n}\nexport default function isMobile(param) {\n    var nav = {\n        userAgent: '',\n        platform: '',\n        maxTouchPoints: 0\n    };\n    if (!param && typeof navigator !== 'undefined') {\n        nav = {\n            userAgent: navigator.userAgent,\n            platform: navigator.platform,\n            maxTouchPoints: navigator.maxTouchPoints || 0\n        };\n    }\n    else if (typeof param === 'string') {\n        nav.userAgent = param;\n    }\n    else if (param && param.userAgent) {\n        nav = {\n            userAgent: param.userAgent,\n            platform: param.platform,\n            maxTouchPoints: param.maxTouchPoints || 0\n        };\n    }\n    var userAgent = nav.userAgent;\n    var tmp = userAgent.split('[FBAN');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    tmp = userAgent.split('Twitter');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    var match = createMatch(userAgent);\n    var result = {\n        apple: {\n            phone: match(appleIphone) && !match(windowsPhone),\n            ipod: match(appleIpod),\n            tablet: !match(appleIphone) &&\n                (match(appleTablet) || isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone),\n            universal: match(appleUniversal),\n            device: (match(appleIphone) ||\n                match(appleIpod) ||\n                match(appleTablet) ||\n                match(appleUniversal) ||\n                isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone)\n        },\n        amazon: {\n            phone: match(amazonPhone),\n            tablet: !match(amazonPhone) && match(amazonTablet),\n            device: match(amazonPhone) || match(amazonTablet)\n        },\n        android: {\n            phone: (!match(windowsPhone) && match(amazonPhone)) ||\n                (!match(windowsPhone) && match(androidPhone)),\n            tablet: !match(windowsPhone) &&\n                !match(amazonPhone) &&\n                !match(androidPhone) &&\n                (match(amazonTablet) || match(androidTablet)),\n            device: (!match(windowsPhone) &&\n                (match(amazonPhone) ||\n                    match(amazonTablet) ||\n                    match(androidPhone) ||\n                    match(androidTablet))) ||\n                match(/\\bokhttp\\b/i)\n        },\n        windows: {\n            phone: match(windowsPhone),\n            tablet: match(windowsTablet),\n            device: match(windowsPhone) || match(windowsTablet)\n        },\n        other: {\n            blackberry: match(otherBlackBerry),\n            blackberry10: match(otherBlackBerry10),\n            opera: match(otherOpera),\n            firefox: match(otherFirefox),\n            chrome: match(otherChrome),\n            device: match(otherBlackBerry) ||\n                match(otherBlackBerry10) ||\n                match(otherOpera) ||\n                match(otherFirefox) ||\n                match(otherChrome)\n        },\n        any: false,\n        phone: false,\n        tablet: false\n    };\n    result.any =\n        result.apple.device ||\n            result.android.device ||\n            result.windows.device ||\n            result.other.device;\n    result.phone =\n        result.apple.phone || result.android.phone || result.windows.phone;\n    result.tablet =\n        result.apple.tablet || result.android.tablet || result.windows.tablet;\n    return result;\n}\n//# sourceMappingURL=isMobile.js.map","import * as THREE from 'three';\r\nimport isMobile from 'ismobilejs';\r\nimport { View } from './View';\r\nimport { DisplayObject, IInteractionEvent, ITickerData } from './DisplayObject';\r\nimport { Content } from './Content';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport interface IApplicationOption {\r\n\tcanvas?: HTMLCanvasElement;\r\n\tcontainer?: HTMLElement;\r\n\twidth?: number;\r\n\theight?: number;\r\n\ttransparent?: boolean;\r\n\tresolution?: number;\r\n\tbackgroundColor?: number;\r\n\tantialias?: boolean;\r\n\tautoAdjust?: TAutoAdjust;\r\n\tbasepath?: string;\r\n\tversion?: string;\r\n}\r\n\r\nexport interface IAdjustDelegate {\r\n\t(app: Application): void;\r\n}\r\n\r\nexport type TAutoAdjust = boolean | IAdjustDelegate;\r\n\r\nexport interface IAutoAdjustDelegate {\r\n\t(): void;\r\n}\r\n\r\nexport type TAutoAdjuster = IAutoAdjustDelegate | null;\r\n\r\nexport interface ISize {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IPosition {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport interface IHorizontal {\r\n\tx: number;\r\n\twidth: number;\r\n}\r\n\r\nexport interface IVertical {\r\n\ty: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IRect extends ISize, IPosition {}\r\n\r\nexport class Application {\r\n\tprivate _container: HTMLElement;\r\n\tprivate _renderer: THREE.WebGLRenderer;\r\n\tprivate _views: View[] = [];\r\n\tprivate _lastTime: number = 0;\r\n\tprivate _playing: boolean = false;\r\n\tprivate _rendererSize: THREE.Vector2;\r\n\tprivate _autoAdjuster: TAutoAdjuster = null;\r\n\tprivate _basepath: string = '';\r\n\tprivate _version: string = '';\r\n\t\r\n\tinteractionDown: boolean = true;\r\n\tinteractionMove: boolean = false;\r\n\tinteractionUp: boolean = true;\r\n\t\r\n\tconstructor(options: IApplicationOption = {}) {\r\n\t\tconst canvas = options.canvas || undefined;\r\n\t\tconst container = options.container || document.body;\r\n\t\tconst transparent = options.transparent || false;\r\n\t\tconst antialias = options.antialias || false;\r\n\t\tconst rendererOptions = {\r\n\t\t\tcanvas, alpha: transparent, antialias\r\n\t\t}\r\n\t\t\r\n\t\tconst renderer = new THREE.WebGLRenderer(rendererOptions);\r\n\t\t\r\n\t\tconst width = options.width || 600;\r\n\t\tconst height = options.height || 400;\r\n\t\tconst resolution = options.resolution || 1;\r\n\t\tconst backgroundColor = options.backgroundColor || 0;\r\n\t\tconst opacity = transparent ? 0 : 1;\r\n\t\tconst autoAdjust = options.autoAdjust || false;\r\n\t\tconst basepath = options.basepath || './';\r\n\t\tconst version = options.version || '';\r\n\t\t\r\n\t\trenderer.setClearColor(backgroundColor, 0);\r\n\t\trenderer.setSize(width, height);\r\n\t\trenderer.setPixelRatio(resolution);\r\n\t\trenderer.autoClear = false;\r\n\t\t\r\n\t\tthis._container = container;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._rendererSize = new THREE.Vector2(width, height);\r\n\t\tthis._basepath = basepath;\r\n\t\tthis._version = version;\r\n\t\t\r\n\t\tconst dom = renderer.domElement;\r\n\t\tdom.style.position = 'absolute';\r\n\t\tconst isSP = isMobile(navigator.userAgent).any;\r\n\t\t\r\n\t\tconst raycaster = new THREE.Raycaster();\r\n\t\tconst mouse = new THREE.Vector2();\r\n\t\tconst event: IInteractionEvent = { type: '', emitted: [], originalEvent: null };\r\n\t\tlet down: DisplayObject[] = [];\r\n\t\tlet over: DisplayObject[] = [];\r\n\t\t\r\n\t\tconst cast = (e: Event, x: number, y: number) => {\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tevent.emitted = [];\r\n\t\t\t\r\n\t\t\tconst w = dom.offsetWidth;\r\n\t\t\tconst h = dom.offsetHeight;\r\n\t\t\t\r\n\t\t\tmouse.x = (x / w) * 2 - 1;\r\n\t\t\tmouse.y = -(y / h) * 2 + 1;\r\n\t\t\t\r\n\t\t\tconst c = this._views;\r\n\t\t\tfor (let i = c.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tc[i].onInteraction(event, raycaster, mouse);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tconst dispatch = (targets: DisplayObject[], type: string) => {\r\n\t\t\tfor (let i = 0; i < targets.length; i++) {\r\n\t\t\t\ttargets[i].emit(type, event);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tconst separate = (_first: DisplayObject[], _emitted: DisplayObject[]) => {\r\n\t\t\tconst first: DisplayObject[] = _first.concat([]);\r\n\t\t\tconst emitted: DisplayObject[] = _emitted.concat([]);\r\n\t\t\tconst both: DisplayObject[] = [];\r\n\t\t\t\r\n\t\t\tfor (let i = first.length - 1; i >= 0; i--) {\r\n\t\t\t\tconst p = first[i];\r\n\t\t\t\tconst index = emitted.indexOf(p);\r\n\t\t\t\t\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tfirst.splice(i, 1);\r\n\t\t\t\t\temitted.splice(index, 1);\r\n\t\t\t\t\tboth.push(p);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn { both, first, emitted };\r\n\t\t}\r\n\t\t\r\n\t\tconst startHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tdown = [];\r\n\t\t\tif (!this.interactionDown) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointerdown';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdispatch(event.emitted, 'pointerdown');\r\n\t\t\tdown = event.emitted;\r\n\t\t};\r\n\t\t\r\n\t\tconst moveHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tif (!this.interactionMove) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointermove';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (over.length === 0) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\tdispatch(event.emitted, 'pointerover');\r\n\t\t\t\t\tover = event.emitted;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\tdispatch(over, 'pointerout');\r\n\t\t\t\tover = [];\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst saparated = separate(over, event.emitted);\r\n\t\t\t\r\n\t\t\tdispatch(saparated.emitted, 'pointerover');\r\n\t\t\tdispatch(saparated.first, 'pointerout');\r\n\t\t\tover = event.emitted;\r\n\t\t\t\r\n\t\t\tdispatch(saparated.both, 'pointermove');\r\n\t\t}\r\n\t\t\r\n\t\tconst endHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tif (!this.interactionUp) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointerup';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (down.length === 0) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\tdispatch(event.emitted, 'pointerup');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\tdispatch(down, 'pointerupoutside');\r\n\t\t\t\tdown = [];\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst saparated = separate(down, event.emitted);\r\n\t\t\t\r\n\t\t\tdispatch(saparated.emitted, 'pointerup');\r\n\t\t\tdispatch(saparated.first, 'pointerupoutside');\r\n\t\t\t\r\n\t\t\tdispatch(saparated.both, 'pointerup');\r\n\t\t\tdispatch(saparated.both, 'pointertap');\r\n\t\t\tdown = [];\r\n\t\t}\r\n\t\t\r\n\t\tif (isSP) {\r\n\t\t\tdom.addEventListener('touchstart', e => {\r\n\t\t\t\tstartHandler(e, e.touches[0].clientX - dom.offsetLeft, e.touches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('touchmove', e => {\r\n\t\t\t\tmoveHandler(e, e.touches[0].clientX - dom.offsetLeft, e.touches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('touchend', e => {\r\n\t\t\t\tendHandler(e, e.changedTouches[0].clientX - dom.offsetLeft, e.changedTouches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdom.addEventListener('mousedown', e => {\r\n\t\t\t\tstartHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('mousemove', e => {\r\n\t\t\t\tmoveHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('mouseup', e => {\r\n\t\t\t\tendHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\twindow.addEventListener('visibilitychange', e => {\r\n\t\t\tthis._lastTime = e.timeStamp;\r\n\t\t});\r\n\t\t\r\n\t\tconst step = (timestamp: number) => {\r\n\t\t\tconst delta = (timestamp - this._lastTime) * 0.06;\r\n\t\t\tthis._lastTime = timestamp;\r\n\t\t\t\r\n\t\t\tif (!this._playing) {\r\n\t\t\t\trequestAnimationFrame(step);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.update(delta);\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t};\r\n\t\t\r\n\t\trequestAnimationFrame(step);\r\n\t\t\r\n\t\tif (autoAdjust) {\r\n\t\t\tif (autoAdjust === true) {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tthis.fullScreen()\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tautoAdjust(this);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tattachAsync(content: Content) {\r\n\t\treturn content.loadAssetsAsync(this._basepath, this._version)\r\n\t\t\t.then(resources => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: this._rendererSize.width,\r\n\t\t\t\t\theight: this._rendererSize.height,\r\n\t\t\t\t\tresources,\r\n\t\t\t\t\tvars: content.vars\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.then(($: IDeliverData) => {\r\n\t\t\t\tconst viewClasses = content.viewClasses;\r\n\t\t\t\tfor (let i = 0; i < viewClasses.length; i++) {\r\n\t\t\t\t\tthis.addView(new viewClasses[i]($));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn this;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tget element() {\r\n\t\treturn this._renderer.domElement;\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\treturn this._rendererSize.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\treturn this._rendererSize.y;\r\n\t}\r\n\t\r\n\taddView(view: View) {\r\n\t\tthis._views.push(view);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tremoveView(view: View) {\r\n\t\tconst index = this._views.indexOf(view);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._views.splice(index, 1);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tplay() {\r\n\t\tthis._container.appendChild(this._renderer.domElement);\r\n\t\t\r\n\t\treturn this.start();\r\n\t}\r\n\t\r\n\tstart() {\r\n\t\tthis._playing = true;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tstop() {\r\n\t\tthis._playing = false;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tupdate(delta: number) {\r\n\t\tconst c = this._views;\r\n\t\tconst e: ITickerData = { delta };\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t\t\r\n\t\tthis.render();\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tthis._renderer.setViewport(0, 0, this._rendererSize.x, this._rendererSize.y);\r\n\t\tthis._renderer.clear();\r\n\t\t\r\n\t\tconst c = this._views;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].render(this._renderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget autoAdjuster() {\r\n\t\treturn this._autoAdjuster;\r\n\t}\r\n\t\r\n\tset autoAdjuster(autoAdjuster: TAutoAdjuster) {\r\n\t\tif (this._autoAdjuster) {\r\n\t\t\twindow.removeEventListener('resize', this._autoAdjuster);\r\n\t\t}\r\n\t\t\r\n\t\tif (!autoAdjuster) {\r\n\t\t\tthis._autoAdjuster = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._autoAdjuster = autoAdjuster;\r\n\t\twindow.addEventListener('resize', autoAdjuster);\r\n\t\tautoAdjuster();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified rectangle.\r\n\t * \r\n\t * @param rect Rectangle to adjust.\r\n\t */\r\n\tfullScreen(rect?: IRect) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst r: IRect = rect || {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tif (r.width / r.height > view.width / view.height) {\r\n\t\t\treturn this.adjustHeight(r.height).toCenter(r).toTop(r);\r\n\t\t}\r\n\t\t\r\n\t\treturn this.adjustWidth(r.width).toMiddle(r).toLeft(r);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified width.\r\n\t * \r\n\t * @param width Width to adjust.\r\n\t */\r\n\tadjustWidth(width?: number) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst w: number = width || this._container.offsetWidth || window.innerWidth;\r\n\t\t\r\n\t\tconst h: number = w / view.width * view.height;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.width = `${w}px`;\r\n\t\tview.style.height = `${h}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified height.\r\n\t * \r\n\t * @param height Height to adjust.\r\n\t */\r\n\tadjustHeight(height?: number) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst h: number = height || this._container.offsetHeight || window.innerHeight;\r\n\t\t\r\n\t\tconst w = h / view.height * view.width;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.height = `${h}px`;\r\n\t\tview.style.width = `${w}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Left justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoLeft(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Center justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoCenter(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${(hol.width - this._getViewRect().width) / 2 + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Right justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoRight(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.width - this._getViewRect().width + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Top justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoTop(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Middle justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoMiddle(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${(ver.height - this._getViewRect().height) / 2 + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Bottom justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoBottom(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.height - this._getViewRect().height + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tprivate _getViewRect(): IRect {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: parseInt(view.style.left.replace('px', '')),\r\n\t\t\ty: parseInt(view.style.top.replace('px', '')),\r\n\t\t\twidth: parseInt(view.style.width.replace('px', '')),\r\n\t\t\theight: parseInt(view.style.height.replace('px', ''))\r\n\t\t};\r\n\t}\r\n}\r\n","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyPosition {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getPosition().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getPosition().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.y = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getPosition().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.z = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = x;\r\n\t\tposition.y = y;\r\n\t\tposition.z = z;\r\n\t\t\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyRotation {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.y = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.z = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = x;\r\n\t\trotation.y = y;\r\n\t\trotation.z = z;\r\n\t\t\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","/*!\n * @tawaship/emitter - v3.1.1\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    _on(type, callback, once) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ callback, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    on(type, callback) {\r\n        return this._on(type, callback, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    once(type, callback) {\r\n        return this._on(type, callback, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Registered callback.\r\n     */\r\n    off(type, callback) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    _emit(type, context, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const targets = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const event = events[i];\r\n            if (event.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            targets.push(event);\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emit(type, ...args) {\r\n        return this._emit(type, this, ...args);\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        return this._emit(type, context, ...args);\r\n    }\r\n    _emitAll(context, ...args) {\r\n        if (context == null) {\r\n            return this;\r\n        }\r\n        const targets = [];\r\n        for (let type in this._events) {\r\n            const events = this._events[type] || [];\r\n            for (let i = events.length - 1; i >= 0; i--) {\r\n                const event = events[i];\r\n                if (event.once) {\r\n                    events.splice(i, 1);\r\n                }\r\n                targets.push(event);\r\n            }\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit all events.\r\n     *\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emitAll(...args) {\r\n        return this._emitAll(this, ...args);\r\n    }\r\n    /**\r\n     * Emit all events with specifying a context.\r\n     *\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemitAll(context, ...args) {\r\n        return this._emitAll(context, ...args);\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove. If it is empty, removes all events.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","/*!\n * @tawaship/task - v1.1.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Task {\r\n    constructor(callbacks, context) {\r\n        this._taskData = {\r\n            context: context == null ? this : context,\r\n            enabled: true,\r\n            index: -1,\r\n            callbacks: [],\r\n            value: null\r\n        };\r\n        this.add(callbacks);\r\n    }\r\n    /**\r\n     * Whether the task works.\r\n     */\r\n    get enabled() {\r\n        return this._taskData.enabled;\r\n    }\r\n    set enabled(enabled) {\r\n        this._taskData.enabled = enabled;\r\n    }\r\n    /**\r\n     * Add the task to the end of the list.\r\n     */\r\n    add(callbacks) {\r\n        if (!Array.isArray(callbacks)) {\r\n            callbacks = [callbacks];\r\n        }\r\n        const list = this._taskData.callbacks;\r\n        const flag = list.length === 0;\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (!(callbacks[i] instanceof Function)) {\r\n                continue;\r\n            }\r\n            list.push(callbacks[i]);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Execute the current task.\r\n     */\r\n    done(...args) {\r\n        if (!this._taskData.enabled) {\r\n            return;\r\n        }\r\n        const task = this._taskData.callbacks[this._taskData.index];\r\n        if (!task) {\r\n            return;\r\n        }\r\n        return this._taskData.value = task.apply(this._taskData.context, args);\r\n    }\r\n    _to(index) {\r\n        this._taskData.index = Number(index);\r\n        return this;\r\n    }\r\n    /**\r\n     * Change the current task to the first task.\r\n     */\r\n    first() {\r\n        return this._to(0);\r\n    }\r\n    /**\r\n     * Change the current task to the previos task.\r\n     */\r\n    prev() {\r\n        return this._to(this._taskData.index - 1);\r\n    }\r\n    /**\r\n     * Change the current task to the next task.\r\n     */\r\n    next() {\r\n        return this._to(this._taskData.index + 1);\r\n    }\r\n    /**\r\n     * Change the current task to the specified task.\r\n     */\r\n    to(index) {\r\n        return this._to(index);\r\n    }\r\n    /**\r\n     * Skips all tasks and changes to the finished state.\r\n     */\r\n    finish() {\r\n        this._taskData.index = -1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Cancel all task and leave them unregistered.\r\n     */\r\n    reset() {\r\n        this._taskData.callbacks = [];\r\n        this._taskData.index = -1;\r\n        this._taskData.value = null;\r\n        return this;\r\n    }\r\n    /**\r\n     * Destroy instance.\r\n     */\r\n    destroy() {\r\n        this.reset();\r\n    }\r\n    /**\r\n     * The value returned by the last task executed.\r\n     */\r\n    get value() {\r\n        return this._taskData.value;\r\n    }\r\n}\n\nexport { Task };\n//# sourceMappingURL=Task.esm.js.map\n","import * as THREE from 'three';\r\nimport { Emitter } from '@tawaship/emitter';\r\nimport { Task } from '@tawaship/task';\r\n\r\nexport interface IInteractionEvent extends THREE.Event {\r\n\ttype: string;\r\n\temitted: DisplayObject[];\r\n\toriginalEvent: Event | null;\r\n};\r\n\r\nexport interface ITickerData {\r\n\tdelta: number;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _box = new THREE.Box3();\r\n\r\nexport abstract class DisplayObject<T extends THREE.Object3D = THREE.Object3D> extends Emitter {\r\n\tprotected _three: T;\r\n\tprotected _sub: T;\r\n\tprotected _size: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _pivot: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _children: DisplayObject[] = [];\r\n\tprotected _task: Task;\r\n\t\r\n\tinteractive: boolean = false;\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._three = this._sub = three;\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerdown', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerup', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointermove', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerupoutside', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthis._task = new Task([], this);\r\n\t\tthis._task.first();\r\n\t}\r\n\t\r\n\tget three() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget task() {\r\n\t\treturn this._task;\r\n\t}\r\n\t\r\n\tget parent(): DisplayObject | null {\r\n\t\treturn this._three.userData.parent;\r\n\t}\r\n\t\r\n\tget children() {\r\n\t\treturn this._children;\r\n\t}\r\n\t\r\n\tupdateTask(e: ITickerData) {\r\n\t\tthis._task.done(e);\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.y;\r\n\t}\r\n\t\r\n\tget depth() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.z * this.scale.z;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._three.position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._three.position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._three.position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._three.position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._three.position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._three.position.z = value;\r\n\t}\r\n\t\r\n\t/*\r\n\tget position() {\r\n\t\treturn this._three.position;\r\n\t}\r\n\t*/\r\n\t\r\n\tget scale() {\r\n\t\treturn this._three.scale;\r\n\t}\r\n\t\r\n\tget pivot() {\r\n\t\treturn this._pivot;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTransform();\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\tabstract updateTransform(): void;\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis.updateTransform();\r\n\t\t\r\n\t\tthis._three.remove(this._sub)\r\n\t\t_box.setFromObject(this._sub);\r\n\t\tthis._three.add(this._sub)\r\n\t\t_box.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\taddChild(object: DisplayObject) {\r\n\t\tif (object.parent) {\r\n\t\t\tobject.parent.removeChild(object);\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.push(object);\r\n\t\tthis._sub.add(object.three);\r\n\t\tobject.three.userData.parent = this;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: DisplayObject) {\r\n\t\tif (object.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._children.indexOf(object);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.splice(index, 1);\r\n\t\tthis._sub.remove(object.three);\r\n\t\tobject.three.userData.parent = null;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object3D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tget rotation() {\r\n\t\treturn this._three.rotation;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { IRect } from './Application';\r\n\r\nexport class Camera extends Object3D<THREE.Camera> {\r\n\tprivate _viewport: IRect;\r\n\t\r\n\tconstructor(camera: THREE.Camera, viewport: IRect) {\r\n\t\tsuper(camera);\r\n\t\t\r\n\t\tthis._viewport = viewport;\r\n\t}\r\n\t\r\n\tget camera() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget viewport() {\r\n\t\treturn this._viewport;\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer, scene: THREE.Scene) {\r\n\t\trenderer.setViewport(this._viewport.x, this._viewport.y, this._viewport.width, this._viewport.height);\r\n\t\trenderer.render(scene, this._three);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object2D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tprotected _skew: THREE.Vector2 = new THREE.Vector2();\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthree.matrixAutoUpdate = false;\r\n\t}\r\n\t\r\n\tget skew() {\r\n\t\treturn this._skew;\r\n\t}\r\n\t\r\n\tget rotation() {\r\n\t\treturn this._three.rotation.z;\r\n\t}\r\n\t\r\n\tset rotation(value) {\r\n\t\tthis._three.rotation.z = value;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._updateMatrix();\r\n\t}\r\n\t\r\n\t_updateMatrix() {\r\n\t\tconst x = this.x;\r\n\t\tconst y = this.y;\r\n\t\tconst z = this._three.position.z;\r\n\t\tconst scaleX = this.scale.x;\r\n\t\tconst scaleY = this.scale.y;\r\n\t\tconst skewX = this.skew.x;\r\n\t\tconst skewY = this.skew.y;\r\n\t\tconst rotation = this.rotation;\r\n\t\tconst pivotX = this.pivot.x;\r\n\t\tconst pivotY = this.pivot.y;\r\n\t\t\r\n\t\tconst a = Math.cos(rotation + skewY) * scaleX;\r\n\t\tconst b = Math.sin(rotation + skewY) * scaleX;\r\n\t\tconst c = -Math.sin(rotation - skewX) * scaleY;\r\n\t\tconst d = Math.cos(rotation - skewX) * scaleY;\r\n\t\tconst tx = x - ((pivotX * a) + (pivotY * c));\r\n\t\tconst ty = y - ((pivotX * b) + (pivotY * d));\r\n\t\t\r\n\t\tthis._three.matrix.set(\r\n\t\t\ta, c, 0, tx, \r\n\t\t\tb, d, 0, ty,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\t\t);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\n\r\nexport class Container2D extends Object2D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\t_updateOrder() {\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].three.position.z = i * 0.0000001;\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._updateMatrix();\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\n\r\nexport class Container3D extends Object3D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._sub.position.x = -this._pivot.x;\r\n\t\tthis._sub.position.y = -this._pivot.y;\r\n\t\tthis._sub.position.z = -this._pivot.z;\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { GLTFLoader, GLTF } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { View } from './View';\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolvePath(path: string, basepath: string) {\r\n\tif (path.indexOf('http://') === 0 || path.indexOf('https://') === 0 || path.indexOf('//') === 0 || path.indexOf('/') === 0) {\r\n\t\treturn path;\r\n\t} else {\r\n\t\treturn basepath.replace(/^(.+)\\/$/, '$1') + '/' + path;\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolveVersion(url: string, version: string) {\r\n\tif (!version) {\r\n\t\treturn url;\r\n\t}\r\n\t\r\n\treturn `${url}${url.match(/\\?/) ? '&' : '?'}_fv=${version}`;\r\n}\r\n\r\nexport interface IAssetDefinitionDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface IAssetDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface ITextureDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface ITextureDictionary extends IAssetDictionary<THREE.Texture> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadTexturesAsync(data: ITextureDefinitionDictionary, basepath: string, version: string): Promise<ITextureDictionary> {\r\n\tconst loader = new THREE.TextureLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst textures: ITextureDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, texture => {\r\n\t\t\t\t\ttextures[i] = texture;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => textures);\r\n}\r\n\r\nexport interface IGLTFDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface IGLTFDictionary extends IAssetDictionary<GLTF> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadGLTFsAsync(data: IGLTFDefinitionDictionary, basepath: string, version: string): Promise<IGLTFDictionary> {\r\n\tconst loader = new GLTFLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst models: IGLTFDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, model => {\r\n\t\t\t\t\tmodels[i] = model;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => models);\r\n}\r\n\r\nexport interface IAssetLoaderDelegate<T> {\r\n\t(data: { [key: string]: any }, basepath: string, version: string): Promise<IAssetDictionary<T>>;\r\n}\r\n\r\nexport interface IResourceDictionary {\r\n\t[key: string]: IAssetDictionary<any>;\r\n}\r\n\r\nexport interface IVariableDictionary {\r\n\t[key: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _assetLoaders: { [key: string]: IAssetLoaderDelegate<any> } = {};\r\n\r\nexport class Content {\r\n\tprivate _assetDefines: { [ley: string]: IAssetDictionary<any> } = {};\r\n\tprivate _viewClasses: typeof View[] = [];\r\n\tprivate _vars: IVariableDictionary = {};\r\n\t\r\n\tget viewClasses() {\r\n\t\treturn this._viewClasses;\r\n\t}\r\n\t\r\n\tget vars() {\r\n\t\treturn Object.assign({}, this._vars);\r\n\t}\r\n\t\r\n\tdefineViews(viewClasses: typeof View | typeof View[]) {\r\n\t\tif (!Array.isArray(viewClasses)) {\r\n\t\t\tviewClasses = [ viewClasses ];\r\n\t\t}\r\n\t\t\r\n\t\tviewClasses.forEach(viewClass => {\r\n\t\t\tthis._viewClasses.push(viewClass);\r\n\t\t});\r\n\t}\r\n\t\r\n\tdefineAssets<T>(key: string, data: IAssetDefinitionDictionary<T>) {\r\n\t\tthis._assetDefines[key] = this._assetDefines[key] || {};\r\n\t\t\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._assetDefines[key][i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tdefineTextures(data: ITextureDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('textures', data);\r\n\t}\r\n\t\r\n\tdefineGLBs(data: IGLTFDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('glbs', data);\r\n\t}\r\n\t\r\n\tloadAssetsAsync(basepath: string, version: string) {\r\n\t\tconst promises: Promise<IAssetDictionary<any>>[] = [];\r\n\t\tconst resources: IResourceDictionary = {};\r\n\t\t\r\n\t\tfor (let i in this._assetDefines) {\r\n\t\t\tif (!(i in _assetLoaders)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpromises.push(\r\n\t\t\t\t_assetLoaders[i](this._assetDefines[i], basepath, version)\r\n\t\t\t\t\t.then((assets: IAssetDictionary<any>) => {\r\n\t\t\t\t\t\treturn resources[i] = assets;\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises).then(() => resources);\r\n\t}\r\n\t\r\n\tdefineVars(data: IVariableDictionary) {\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._vars[i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic registerLoader<T>(key: string, delegate: IAssetLoaderDelegate<T>) {\r\n\t\t_assetLoaders[key] = delegate;\r\n\t}\r\n}\r\n\r\nContent.registerLoader<THREE.Texture>('textures', loadTexturesAsync);\r\nContent.registerLoader<GLTF>('glbs', loadGLTFsAsync);","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Mesh extends Object3D<THREE.Mesh> implements IMesh {\r\n\tprivate _anchor: Anchor;\r\n\t\r\n\tconstructor(geometry: THREE.BufferGeometry, material: THREE.Material) {\r\n\t\tsuper(new THREE.Mesh(geometry, material));\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\tmaterial.transparent = true;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis.updateBoundingBox();\r\n\t\tthis._three.geometry.translate(this._size.x * (0.5 - this._anchor.x), this._size.y * (0.5 - this._anchor.y), this._size.z * (0.5 - this._anchor.z))\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n}","declare namespace OIMO {\r\n\tclass CommonConstructor {\r\n\t\tconstructor(...args: any[]);\r\n\t\t[key: string]: any;\r\n\t}\r\n\t\r\n\texport class World extends CommonConstructor {}\r\n\t\r\n\texport class RigidBody extends CommonConstructor {}\r\n\t\r\n\texport class Shape extends CommonConstructor {}\r\n\t\r\n\texport class ContactCallback extends CommonConstructor {}\r\n\t\r\n\texport class AabbTestCallback extends CommonConstructor {}\r\n\t\r\n\texport class Vec3 extends CommonConstructor {}\r\n}\r\n\r\nexport default OIMO;","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport OIMO from './OIMO';\r\nimport { BodyPosition } from './BodyPosition';\r\nimport { BodyRotation } from './BodyRotation';\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst event = { hit: null, originalEvent: null };\r\n\r\nexport class PhysicsObject3D extends Object3D<THREE.Object3D> {\r\n\tprotected _body: OIMO.RigidBody;\r\n\tprotected _contactEnabled: boolean = false;\r\n\tprotected _position: BodyPosition;\r\n\tprotected _rotation: BodyRotation;\r\n\t\r\n\tprotected _collisionGroup: number = 1;\r\n\tprotected _collisionMask: number = 1;\r\n\tprotected _contactCallback: OIMO.ContactCallback;\r\n\tprotected _isSensor: boolean = false;\r\n\tprotected _aabbTestCallback: OIMO.AabbTestCallback;\r\n\tprotected _touchedShapes: OIMO.Shape[] = [];\r\n\tprotected _touchShapes: OIMO.Shape[] = [];\r\n\tprotected _sensorEnabled: boolean = false;\r\n\t\r\n\tconstructor(three: THREE.Object3D, body: OIMO.RigidBody) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthis._body = body;\r\n\t\tthis._position = new BodyPosition(this);\r\n\t\tthis._rotation = new BodyRotation(this);\r\n\t\t\r\n\t\tbody.userData = {};\r\n\t\tbody.userData.ref = this;\r\n\t\t\r\n\t\tconst contactCallback = new OIMO.ContactCallback();\r\n\t\t\r\n\t\tcontactCallback.beginContact = (e: any) => {\r\n\t\t\tevent.hit = e.getShape2().getRigidBody().userData.ref;\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tthis.emit('beginContact', event);\r\n\t\t};\r\n\t\tcontactCallback.endContact = (e: any) => {\r\n\t\t\tevent.hit = e.getShape2().getRigidBody().userData.ref;\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tthis.emit('endContact', event);\r\n\t\t};\r\n\t\tcontactCallback.preSolve = (e: any) => {\r\n\t\t\tevent.hit = e.getShape2().getRigidBody().userData.ref;\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tthis.emit('preSolve', event);\r\n\t\t};\r\n\t\tcontactCallback.postSolve = (e: any) => {\r\n\t\t\tevent.hit = e.getShape2().getRigidBody().userData.ref;\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tthis.emit('postSolve', event);\r\n\t\t};\r\n\t\t\r\n\t\tthis._contactCallback = contactCallback;\r\n\t\t\r\n\t\tconst aabbTestCallback = new OIMO.AabbTestCallback();\r\n\t\t\r\n\t\taabbTestCallback.process = (shape: OIMO.Shape) => {\r\n\t\t\tconst object = shape.getRigidBody().userData.ref;\r\n\t\t\t\r\n\t\t\tif ((this._collisionMask & object.collisionGroup) === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.hit = object;\r\n\t\t\tevent.originalEvent = null;\r\n\t\t\t\r\n\t\t\tconst idx = this._touchedShapes.indexOf(shape);\r\n\t\t\tif (idx === -1) {\r\n\t\t\t\tthis.emit('beginContact', event);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._touchedShapes.splice(idx, 1);\r\n\t\t\tthis._touchShapes.push(shape);\r\n\t\t};\r\n\t\t\r\n\t\tthis._aabbTestCallback = aabbTestCallback;\r\n\t}\r\n\t\r\n\tget body() {\r\n\t\treturn this._body;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._position.z = value;\r\n\t}\r\n\t\r\n\tget position() {\r\n\t\treturn this._position;\r\n\t}\r\n\t\r\n\t// @ts-ignore\r\n\tget rotation() {\r\n\t\treturn this._rotation;\r\n\t}\r\n\t\r\n\tget sensorEnabled() {\r\n\t\treturn this._sensorEnabled;\r\n\t}\r\n\t\r\n\tget isSensor() {\r\n\t\treturn this._isSensor;\r\n\t}\r\n\t\r\n\tset isSensor(value) {\r\n\t\tthis._isSensor = value;\r\n\t\tthis._sensorEnabled = value && this._contactEnabled;\r\n\t\t\r\n\t\tthis.contactEnabled = this._contactEnabled;\r\n\t\tthis.collisionGroup = this._collisionGroup;\r\n\t\tthis.collisionMask = this._collisionMask;\r\n\t}\r\n\t\r\n\tget contactEnabled() {\r\n\t\treturn this._contactEnabled;\r\n\t}\r\n\t\r\n\tset contactEnabled(value) {\r\n\t\tthis._contactEnabled = value;\r\n\t\tthis._sensorEnabled = value && this._isSensor;\r\n\t\t\r\n\t\tconst callback = (!value || this._isSensor) ? null : this._contactCallback;\r\n\t\t\r\n\t\tlet shape = this._body.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tshape.setContactCallback(callback);\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tget collisionGroup() {\r\n\t\treturn this._collisionGroup;\r\n\t}\r\n\t\r\n\tset collisionGroup(value) {\r\n\t\tconst v = this._isSensor ? 0 : value;\r\n\t\tthis._collisionGroup = value;\r\n\t\t\r\n\t\tlet shape = this._body.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tshape.setCollisionGroup(v);\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tget collisionMask() {\r\n\t\treturn this._collisionMask;\r\n\t}\r\n\t\r\n\tset collisionMask(value) {\r\n\t\tconst v = this._isSensor ? 0 : value;\r\n\t\tthis._collisionMask = value;\r\n\t\t\r\n\t\tlet shape = this._body.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tshape.setCollisionMask(v);\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\taabbTest(world: OIMO.World) {\r\n\t\tthis._touchedShapes = this._touchShapes;\r\n\t\tthis._touchShapes = [];\r\n\t\t\r\n\t\tlet shape = this._body.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tworld.aabbTest(shape.getAabb(), this._aabbTestCallback);\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < this._touchedShapes.length; i++) {\r\n\t\t\tconst shape = this._touchedShapes[i];\r\n\t\t\tevent.hit = shape.getRigidBody().userData.ref;\r\n\t\t\tevent.originalEvent = null;\r\n\t\t\tthis.emit('endContact', event);\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._three.position.copy(this._body.getPosition());\r\n\t\tthis._three.quaternion.copy(this._body.getOrientation());\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Camera } from './Camera';\r\nimport { IInteractionEvent, ITickerData } from './DisplayObject';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport class View extends Object3D<THREE.Scene> {\r\n\tprivate _cameras: Camera[] = [];\r\n\t\r\n\tconstructor($?: IDeliverData) {\r\n\t\tsuper(new THREE.Scene());\r\n\t\t\r\n\t\tthis.interactive = true;\r\n\t}\r\n\t\r\n\tget scene() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\taddCamera(camera: Camera) {\r\n\t\tif (camera.parent) {\r\n\t\t\tcamera.parent.removeChild(camera);\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.push(camera);\r\n\t\tthis._three.add(camera.three);\r\n\t\tcamera.three.userData.parent = this;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tremoveCamera(camera: Camera) {\r\n\t\tif (camera.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._cameras.indexOf(camera);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.splice(index, 1);\r\n\t\tthis._three.remove(camera.three);\r\n\t\tcamera.three.userData.parent = null;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tadd(three: THREE.Object3D) {\r\n\t\tthis._three.add(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tremove(three: THREE.Object3D) {\r\n\t\tthis._three.remove(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer) {\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\trenderer.clearDepth();\r\n\t\t\tc[i].render(renderer, this._three);\r\n\t\t}\r\n\t}\r\n\t\r\n\tonInteraction(event: IInteractionEvent, raycaster: THREE.Raycaster, mouse: THREE.Vector2) {\r\n\t\tif (!this.interactive) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\traycaster.setFromCamera(mouse, c[i].camera);\r\n\t\t\t\r\n\t\t\tconst f: (p: THREE.Object3D) => THREE.Object3D[] = (p: THREE.Object3D) => {\r\n\t\t\t\treturn p.children.map(p => {\r\n\t\t\t\t\tif (p instanceof THREE.Mesh) {\r\n\t\t\t\t\t\treturn p;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn f(p);\r\n\t\t\t\t}).flat();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst meshes = f(this._three);\r\n\t\t\t\r\n\t\t\tconst intersects = raycaster.intersectObjects(meshes);\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < intersects.length; i++) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet p = intersects[i].object;\r\n\t\t\t\twhile (p !== this._three) {\r\n\t\t\t\t\tp.dispatchEvent(event);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!p.parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tp = p.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { View } from './View';\r\nimport { ITickerData } from './DisplayObject';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport OIMO from './OIMO';\r\n\r\nexport class PhysicsView extends View {\r\n\tprivate _world: any;\r\n\tphysicsEnabled: boolean = true;\r\n\t\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._world = new OIMO.World();\r\n\t\tthis._world.setGravity(new OIMO.Vec3(0, -9.8, 0));\r\n\t}\r\n\t\r\n\tget world() {\r\n\t\treturn this._world;\r\n\t}\r\n\t\r\n\taddChild(object: PhysicsObject3D) {\r\n\t\tsuper.addChild(object);\r\n\t\t\r\n\t\tthis._world.addRigidBody(object.body);\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: PhysicsObject3D) {\r\n\t\tconst o = super.removeChild(object);\r\n\t\t\r\n\t\tif (!o) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._world.removeRigidBody(object.body);\r\n\t\t\r\n\t\treturn o;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tif (this.physicsEnabled) {\r\n\t\t\tthis._world.step(1 / 60);\r\n\t\t\t\r\n\t\t\tlet body = this._world.getRigidBodyList();\r\n\t\t\twhile (body) {\r\n\t\t\t\tconst object = body.userData.ref;\r\n\t\t\t\tif (object.sensorEnabled) {\r\n\t\t\t\t\tobject.aabbTest(this._world);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tbody = body.getNext();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Sprite extends Object2D<THREE.Mesh> implements IMesh {\r\n\tprivate _texture: THREE.Texture;\r\n\tprivate _anchor: Anchor;\r\n\tprivate _material: THREE.MeshBasicMaterial;\r\n\tprivate _width: number = 0;\r\n\tprivate _height: number = 0;\r\n\t\r\n\tconstructor(texture: THREE.Texture) {\r\n\t\tsuper(new THREE.Mesh());\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\t\r\n\t\tthis._material = new THREE.MeshBasicMaterial();\r\n\t\tthis._material.transparent = true;\r\n\t\t\r\n\t\tthis._three.material = this._material;\r\n\t\t\r\n\t\tthis._texture = texture;\r\n\t\tthis.texture = texture;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this._texture;\r\n\t}\r\n\t\r\n\tset texture(texture) {\r\n\t\tthis._texture = texture;\r\n\t\tthis._material.needsUpdate = true;\r\n\t\tthis._material.map = texture;\r\n\t\t\r\n\t\tif (texture && texture.image) {\r\n\t\t\tthis._updateGeometry(texture.image.width, texture.image.height);\r\n\t\t} else {\r\n\t\t\tthis._updateGeometry(0, 0);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\t_updateGeometry(width: number, height: number) {\r\n\t\tthis._three.geometry = new THREE.PlaneGeometry(width, height);\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis._three.geometry.translate(this._width * (0.5 - this._anchor.x), this._height * (0.5 - this._anchor.y), 0)\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\tstatic from(url: string, callback: (sprite: Sprite) => void) {\r\n\t\tconst sprite = new Sprite(new THREE.TextureLoader().load(url, texture => {\r\n\t\t\tsprite.texture = texture;\r\n\t\t\tcallback && callback(sprite);\r\n\t\t}));\r\n\t\t\r\n\t\treturn sprite;\r\n\t}\r\n}"],"names":["Anchor","x","y","z","mesh","this","_x","_y","_z","_mesh","prototypeAccessors","value","updateGeometryPosition","set","undefined","appleIphone","appleIpod","appleTablet","appleUniversal","androidPhone","androidTablet","amazonPhone","amazonTablet","windowsPhone","windowsTablet","otherBlackBerry","otherBlackBerry10","otherOpera","otherChrome","otherFirefox","isAppleTabletOnIos13","navigator","platform","maxTouchPoints","MSStream","Application","options","const","canvas","container","document","body","rendererOptions","alpha","transparent","antialias","renderer","THREE.WebGLRenderer","width","height","resolution","backgroundColor","autoAdjust","basepath","version","setClearColor","setSize","setPixelRatio","autoClear","_container","_renderer","_rendererSize","THREE.Vector2","_basepath","_version","dom","domElement","style","position","isSP","param","nav","userAgent","tmp","split","match","regex","test","createMatch","result","apple","phone","ipod","tablet","universal","device","amazon","android","windows","other","blackberry","blackberry10","opera","firefox","chrome","any","isMobile","raycaster","THREE.Raycaster","mouse","event","type","emitted","originalEvent","down","over","cast","e","w","offsetWidth","h","offsetHeight","c","_views","i","length","onInteraction","dispatch","targets","let","emit","separate","_first","_emitted","first","concat","both","p","index","indexOf","splice","push","startHandler","interactionDown","moveHandler","interactionMove","saparated","endHandler","interactionUp","addEventListener","touches","clientX","offsetLeft","clientY","offsetTop","changedTouches","offsetX","offsetY","window","_lastTime","timeStamp","step","timestamp","delta","_playing","update","requestAnimationFrame","autoAdjuster","fullScreen","attachAsync","content","loadAssetsAsync","then","resources","vars","$","viewClasses","addView","element","view","removeView","play","appendChild","start","stop","render","setViewport","clear","_autoAdjuster","removeEventListener","rect","r","innerWidth","innerHeight","adjustHeight","toCenter","toTop","adjustWidth","toMiddle","toLeft","horizontal","hol","left","_getViewRect","toRight","vertical","ver","top","toBottom","parseInt","replace","BodyPosition","object","_object","getPosition","setPosition","updateTransform","BodyRotation","getRotation","toEulerXyz","rotation","setRotationXyz","Emitter","_events","_on","callback","once","events","on","off","_emit","context","apply","args","cemit","_emitAll","emitAll","cemitAll","Task","callbacks","_taskData","enabled","add","Array","isArray","list","Function","done","task","_to","Number","prev","next","to","finish","reset","destroy","_box","THREE.Box3","DisplayObject","three","super","THREE.Vector3","_three","_sub","interactive","_task","parent","userData","children","_children","updateTask","updateBoundingBox","_size","depth","scale","pivot","_pivot","remove","setFromObject","getSize","multiply","addChild","removeChild","Object3D","Camera","camera","viewport","_viewport","scene","Object2D","matrixAutoUpdate","skew","_skew","_updateMatrix","scaleX","scaleY","skewX","skewY","pivotX","pivotY","a","Math","cos","b","sin","d","tx","ty","matrix","Container2D","THREE.Group","_updateOrder","Container3D","resolvePath","path","resolveVersion","url","_assetLoaders","Content","_viewClasses","Object","assign","_vars","defineViews","forEach","viewClass","defineAssets","key","data","_assetDefines","defineTextures","defineGLBs","promises","assets","Promise","all","defineVars","registerLoader","delegate","loader","THREE.TextureLoader","textures","resolve","reject","load","texture","GLTFLoader","models","model","Mesh","geometry","material","THREE.Mesh","_anchor","anchor","center","translate","computeBoundingBox","boundingBox","OIMO","hit","PhysicsObject3D","_body","_position","_rotation","ref","contactCallback","ContactCallback","beginContact","getShape2","getRigidBody","endContact","preSolve","postSolve","_contactCallback","aabbTestCallback","AabbTestCallback","process","shape","_collisionMask","collisionGroup","idx","_touchedShapes","_touchShapes","_aabbTestCallback","sensorEnabled","_sensorEnabled","isSensor","_isSensor","_contactEnabled","contactEnabled","_collisionGroup","collisionMask","getShapeList","setContactCallback","getNext","v","setCollisionGroup","setCollisionMask","aabbTest","world","getAabb","copy","quaternion","getOrientation","View","THREE.Scene","addCamera","_cameras","removeCamera","clearDepth","setFromCamera","f","map","flat","meshes","intersects","intersectObjects","dispatchEvent","PhysicsView","_world","World","setGravity","Vec3","addRigidBody","o","removeRigidBody","physicsEnabled","getRigidBodyList","Sprite","_material","THREE.MeshBasicMaterial","_texture","needsUpdate","image","_updateGeometry","THREE.PlaneGeometry","_width","_height","from","sprite"],"mappings":"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"}
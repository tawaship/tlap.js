/*!
 * tlap.js - v0.3.0
 * 
 * @require three.js v0.127.0
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */
!function(t,e,i){"use strict";var o=function(t,e,i,o){this._x=t,this._y=e,this._z=i,this._mesh=o},n={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0}};n.x.get=function(){return this._x},n.x.set=function(t){this._x=t,this._mesh.updateGeometryPosition()},n.y.get=function(){return this._y},n.y.set=function(t){this._y=t,this._mesh.updateGeometryPosition()},n.z.get=function(){return this._z},n.z.set=function(t){this._z=t,this._mesh.updateGeometryPosition()},o.prototype.set=function(t,e,i){void 0===e&&(e=t),void 0===i&&(i=e),this._x=t,this._y=e,this._z=i,this._mesh.updateGeometryPosition()},Object.defineProperties(o.prototype,n);
/*!
 * @tawaship/emitter - v3.1.1
 * 
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */
var r=function(){this._events={}};r.prototype._on=function(t,e,i){if(!t||!e)return this;for(var o=this._events[t]=this._events[t]||[],n=0;n<o.length;n++)if(o[n].callback===e)return this;return o.push({callback:e,once:i}),this},r.prototype.on=function(t,e){return this._on(t,e,!1)},r.prototype.once=function(t,e){return this._on(t,e,!0)},r.prototype.off=function(t,e){if(!t||!e)return this;for(var i=this._events[t]||[],o=0;o<i.length;o++)if(i[o].callback===e)return i.splice(o,1),this;return this},r.prototype._emit=function(t,e){for(var i=[],o=arguments.length-2;o-- >0;)i[o]=arguments[o+2];if(!t)return this;for(var n=this._events[t]||[],r=[],s=n.length-1;s>=0;s--){var a=n[s];a.once&&n.splice(s,1),r.push(a)}for(var h=r.length-1;h>=0;h--)r[h].callback.apply(e,i);return this},r.prototype.emit=function(t){for(var e,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];return(e=this)._emit.apply(e,[t,this].concat(i))},r.prototype.cemit=function(t,e){for(var i,o=[],n=arguments.length-2;n-- >0;)o[n]=arguments[n+2];return(i=this)._emit.apply(i,[t,e].concat(o))},r.prototype._emitAll=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];if(null==t)return this;var o=[];for(var n in this._events)for(var r=this._events[n]||[],s=r.length-1;s>=0;s--){var a=r[s];a.once&&r.splice(s,1),o.push(a)}for(var h=o.length-1;h>=0;h--)o[h].callback.apply(t,e);return this},r.prototype.emitAll=function(){for(var t,e=[],i=arguments.length;i--;)e[i]=arguments[i];return(t=this)._emitAll.apply(t,[this].concat(e))},r.prototype.cemitAll=function(t){for(var e,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];return(e=this)._emitAll.apply(e,[t].concat(i))},r.prototype.clear=function(t){return void 0===t&&(t=""),t?delete this._events[t]:this._events={},this};var s=function(t){function e(e){t.call(this),this._views=[],this._id=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={id:{configurable:!0}};return i.id.get=function(){return this._id},e.prototype.addView=function(t){return this.removeView(t),this._views.push(t),t},e.prototype.addViewAt=function(t,e){return this.removeView(t),this._views.splice(e,0,t),t},e.prototype.removeView=function(t){var e=this._views.indexOf(t);if(-1!==e)return this._views.splice(e,1),t},e.prototype.removeAllViews=function(){this._views=[]},e.prototype.onInteraction=function(t,e,i){for(var o=this._views,n=o.length-1;n>=0;n--){if(t.emitted.length>0)return;o[n].onInteraction(t,e,i)}},e.prototype.update=function(t){for(var e=this._views,i=0;i<e.length;i++)e[i].update(t,!1)},e.prototype.render=function(t){for(var e=this._views,i=0;i<e.length;i++)e[i].render(t)},Object.defineProperties(e.prototype,i),e}(r),a=/iPhone/i,h=/iPod/i,p=/iPad/i,c=/\biOS-universal(?:.+)Mac\b/i,u=/\bAndroid(?:.+)Mobile\b/i,l=/Android/i,d=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,f=/Silk/i,_=/Windows Phone/i,y=/\bWindows(?:.+)ARM\b/i,v=/BlackBerry/i,g=/BB10/i,b=/Opera Mini/i,m=/\b(CriOS|Chrome)(?:.+)Mobile/i,w=/Mobile(?:.+)Firefox\b/i,x=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var C=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,o=i.split("[FBAN");void 0!==o[1]&&(i=o[0]),void 0!==(o=i.split("Twitter"))[1]&&(i=o[0]);var n=function(t){return function(e){return e.test(t)}}(i),r={apple:{phone:n(a)&&!n(_),ipod:n(h),tablet:!n(a)&&(n(p)||x(e))&&!n(_),universal:n(c),device:(n(a)||n(h)||n(p)||n(c)||x(e))&&!n(_)},amazon:{phone:n(d),tablet:!n(d)&&n(f),device:n(d)||n(f)},android:{phone:!n(_)&&n(d)||!n(_)&&n(u),tablet:!n(_)&&!n(d)&&!n(u)&&(n(f)||n(l)),device:!n(_)&&(n(d)||n(f)||n(u)||n(l))||n(/\bokhttp\b/i)},windows:{phone:n(_),tablet:n(y),device:n(_)||n(y)},other:{blackberry:n(v),blackberry10:n(g),opera:n(b),firefox:n(w),chrome:n(m),device:n(v)||n(g)||n(b)||n(w)||n(m)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}(navigator.userAgent).any;function k(t,e){for(var i=t.concat([]),o=e.concat([]),n=[],r=i.length-1;r>=0;r--){var s=i[r],a=o.indexOf(s);a>-1&&(i.splice(r,1),o.splice(a,1),n.push(s))}return{both:n,first:i,emitted:o}}function j(t,e,i){for(var o=0;o<t.length;o++)t[o].emit(e,i)}var S=function(t){function i(){t.apply(this,arguments),this._mouse=new e.Vector2,this._event={type:"",emitted:[],originalEvent:null},this._down=[],this._over=[],this.interactive=!0,this.interactiveDown=!0,this.interactiveMove=!1,this.interactiveUp=!0}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._cast=function(t,e,i,o,n){this._event.originalEvent=t,this._event.emitted=[],this._mouse.x=e/o*2-1,this._mouse.y=-i/n*2+1,this.emit("cast",this._event,this._mouse)},i.prototype.onDown=function(t,e,i,o,n){this._down=[],this.interactive&&this.interactiveDown&&(this._event.type="system:interaction:pointerdown",this._cast(t,e,i,o,n),0!==this._event.emitted.length&&(j(this._event.emitted,"pointerdown",this._event),this._down=this._event.emitted))},i.prototype.onMove=function(t,e,i,o,n){if(this.interactive&&this.interactiveMove)if(this._event.type="system:interaction:pointermove",this._cast(t,e,i,o,n),0!==this._over.length){if(0===this._event.emitted.length)return j(this._over,"pointerout",this._event),void(this._over=[]);var r=k(this._over,this._event.emitted);j(r.emitted,"pointerover",this._event),j(r.first,"pointerout",this._event),this._over=this._event.emitted,j(r.both,"pointermove",this._event)}else this._event.emitted.length>0&&(j(this._event.emitted,"pointerover",this._event),this._over=this._event.emitted)},i.prototype.onUp=function(t,e,i,o,n){if(this.interactive&&this.interactiveUp)if(this._event.type="system:interaction:pointerup",this._cast(t,e,i,o,n),0!==this._down.length){if(0===this._event.emitted.length)return j(this._down,"pointerupoutside",this._event),void(this._down=[]);var r=k(this._down,this._event.emitted);j(r.emitted,"pointerup",this._event),j(r.first,"pointerupoutside",this._event),j(r.both,"pointerup",this._event),j(r.both,"pointertap",this._event),this._down=[]}else this._event.emitted.length>0&&j(this._event.emitted,"pointerup",this._event)},i.prototype.addCanvas=function(t){var e=this;C?(t.addEventListener("touchstart",(function(i){e.onDown(i,i.touches[0].clientX-t.offsetLeft,i.touches[0].clientY-t.offsetTop,t.offsetWidth,t.offsetHeight)})),t.addEventListener("touchmove",(function(i){e.onMove(i,i.touches[0].clientX-t.offsetLeft,i.touches[0].clientY-t.offsetTop,t.offsetWidth,t.offsetHeight)})),t.addEventListener("touchend",(function(i){e.onUp(i,i.changedTouches[0].clientX-t.offsetLeft,i.changedTouches[0].clientY-t.offsetTop,t.offsetWidth,t.offsetHeight)}))):(t.addEventListener("mousedown",(function(i){e.onDown(i,i.offsetX,i.offsetY,t.offsetWidth,t.offsetHeight)})),t.addEventListener("mousemove",(function(i){e.onMove(i,i.offsetX,i.offsetY,t.offsetWidth,t.offsetHeight)})),t.addEventListener("mouseup",(function(i){e.onUp(i,i.offsetX,i.offsetY,t.offsetWidth,t.offsetHeight)})))},i}(r),M=function(t){var i=this;void 0===t&&(t={}),this._contents={},this._viewFrames=[],this._lastTime=0,this._playing=!1,this._autoAdjuster=null,this._basepath="",this._version="",this._interactionManager=new S;var o=t.canvas||void 0,n=t.container||document.body,r={canvas:o,alpha:t.transparent||!1,antialias:t.antialias||!1},s=new e.WebGLRenderer(r),a=t.width||600,h=t.height||400,p=t.resolution||1,c=t.backgroundColor||0,u=t.autoAdjust||!1,l=t.basepath||"./",d=t.version||"";s.setClearColor(c,0),s.setSize(a,h),s.setPixelRatio(p),s.autoClear=!1,this._container=n,this._renderer=s,this._rendererSize=new e.Vector2(a,h),this._basepath=l,this._version=d,s.domElement.style.position="absolute";var f=new e.Raycaster;this._interactionManager.addCanvas(s.domElement),this._interactionManager.on("cast",(function(t,e){for(var o=0;o<i._viewFrames.length;o++)i._viewFrames[o].onInteraction(t,f,e)})),window.addEventListener("visibilitychange",(function(t){i._lastTime=t.timeStamp}));var _={delta:1},y=function(t){var e=.06*(t-i._lastTime);i._lastTime=t,i._playing?(_.delta=e,i.update(_),i.render(),requestAnimationFrame(y)):requestAnimationFrame(y)};requestAnimationFrame(y),u&&(this.autoAdjuster=!0===u?function(){i.fullScreen()}:function(){u(i)})},E={renderer:{configurable:!0},interactionManager:{configurable:!0},element:{configurable:!0},width:{configurable:!0},height:{configurable:!0},autoAdjuster:{configurable:!0}};M.prototype.attachAsync=function(t){var e=this;return this.detach(t),t.loadAssetsAsync(this._basepath,this._version).then((function(i){return{width:e._rendererSize.width,height:e._rendererSize.height,resources:i,vars:t.vars}})).then((function(i){var o=new s(t.id);return t.onAttach(o,i),e._viewFrames.push(o),e}))},M.prototype.detach=function(t){for(var e=0;e<this._viewFrames.length;e++)if(this._viewFrames[e].id===t.id){this._viewFrames.splice(e,1);break}},E.renderer.get=function(){return this._renderer},E.interactionManager.get=function(){return this._interactionManager},E.element.get=function(){return this._renderer.domElement},E.width.get=function(){return this._rendererSize.x},E.height.get=function(){return this._rendererSize.y},M.prototype.play=function(){return this._container.appendChild(this._renderer.domElement),this.start()},M.prototype.start=function(){return this._playing=!0,this},M.prototype.stop=function(){return this._playing=!1,this},M.prototype.update=function(t){for(var e=this._viewFrames,i=0;i<e.length;i++)e[i].update(t)},M.prototype.render=function(){this._renderer.setViewport(0,0,this._rendererSize.x,this._rendererSize.y),this._renderer.clear();for(var t=this._viewFrames,e=0;e<t.length;e++)t[e].render(this._renderer)},E.autoAdjuster.get=function(){return this._autoAdjuster},E.autoAdjuster.set=function(t){this._autoAdjuster&&window.removeEventListener("resize",this._autoAdjuster),t?(this._autoAdjuster=t,window.addEventListener("resize",t),t()):this._autoAdjuster=null},M.prototype.fullScreen=function(t){var e=this._renderer.domElement,i=t||{x:0,y:0,width:this._container.offsetWidth||window.innerWidth,height:this._container.offsetHeight||window.innerHeight};return i.width/i.height>e.width/e.height?this.adjustHeight(i.height).toCenter(i).toTop(i):this.adjustWidth(i.width).toMiddle(i).toLeft(i)},M.prototype.adjustWidth=function(t){var e=this._renderer.domElement,i=t||this._container.offsetWidth||window.innerWidth,o=i/e.width*e.height;return e.style.width=i+"px",e.style.height=o+"px",this},M.prototype.adjustHeight=function(t){var e=this._renderer.domElement,i=t||this._container.offsetHeight||window.innerHeight,o=i/e.height*e.width;return e.style.height=i+"px",e.style.width=o+"px",this},M.prototype.toLeft=function(t){var e=this._renderer.domElement,i=t||{x:0,width:this._container.offsetWidth||window.innerWidth};return e.style.left=i.x+"px",this},M.prototype.toCenter=function(t){var e=this._renderer.domElement,i=t||{x:0,width:this._container.offsetWidth||window.innerWidth};return e.style.left=(i.width-this._getViewRect().width)/2+i.x+"px",this},M.prototype.toRight=function(t){var e=this._renderer.domElement,i=t||{x:0,width:this._container.offsetWidth||window.innerWidth};return e.style.left=i.width-this._getViewRect().width+i.x+"px",this},M.prototype.toTop=function(t){var e=this._renderer.domElement,i=t||{y:0,height:this._container.offsetHeight||window.innerHeight};return e.style.top=i.y+"px",this},M.prototype.toMiddle=function(t){var e=this._renderer.domElement,i=t||{y:0,height:this._container.offsetHeight||window.innerHeight};return e.style.top=(i.height-this._getViewRect().height)/2+i.y+"px",this},M.prototype.toBottom=function(t){var e=this._renderer.domElement,i=t||{y:0,height:this._container.offsetHeight||window.innerHeight};return e.style.top=i.height-this._getViewRect().height+i.y+"px",this},M.prototype._getViewRect=function(){var t=this._renderer.domElement;return{x:parseInt(t.style.left.replace("px","")),y:parseInt(t.style.top.replace("px","")),width:parseInt(t.style.width.replace("px","")),height:parseInt(t.style.height.replace("px",""))}},Object.defineProperties(M.prototype,E);var z=function(t){this._object=t},G={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0}};G.x.get=function(){return this._object.body.getPosition().x},G.x.set=function(t){var e=this._object.body.getPosition();e.x=t,this._object.body.setPosition(e),this._object.updateTransform()},G.y.get=function(){return this._object.body.getPosition().y},G.y.set=function(t){var e=this._object.body.getPosition();e.y=t,this._object.body.setPosition(e),this._object.updateTransform()},G.z.get=function(){return this._object.body.getPosition().z},G.z.set=function(t){var e=this._object.body.getPosition();e.z=t,this._object.body.setPosition(e),this._object.updateTransform()},z.prototype.set=function(t,e,i){void 0===e&&(e=t),void 0===i&&(i=e);var o=this._object.body.getPosition();o.x=t,o.y=e,o.z=i,this._object.body.setPosition(o),this._object.updateTransform()},Object.defineProperties(z.prototype,G);var A=function(t){this._object=t},O={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0}};O.x.get=function(){return this._object.body.getRotation().toEulerXyz().x},O.x.set=function(t){var e=this._object.body.getRotation().toEulerXyz();e.x=t,this._object.body.setRotationXyz(e),this._object.updateTransform()},O.y.get=function(){return this._object.body.getRotation().toEulerXyz().y},O.y.set=function(t){var e=this._object.body.getRotation().toEulerXyz();e.y=t,this._object.body.setRotationXyz(e),this._object.updateTransform()},O.z.get=function(){return this._object.body.getRotation().toEulerXyz().z},O.z.set=function(t){var e=this._object.body.getRotation().toEulerXyz();e.z=t,this._object.body.setRotationXyz(e),this._object.updateTransform()},A.prototype.set=function(t,e,i){void 0===e&&(e=t),void 0===i&&(i=e);var o=this._object.body.getRotation().toEulerXyz();o.x=t,o.y=e,o.z=i,this._object.body.setRotationXyz(o),this._object.updateTransform()},Object.defineProperties(A.prototype,O);
/*!
 * @tawaship/task - v1.1.0
 * 
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */
var P=function(t,e){this._taskData={context:null==e?this:e,enabled:!0,index:-1,callbacks:[],value:null},this.add(t)},T={enabled:{configurable:!0},value:{configurable:!0}};T.enabled.get=function(){return this._taskData.enabled},T.enabled.set=function(t){this._taskData.enabled=t},P.prototype.add=function(t){Array.isArray(t)||(t=[t]);for(var e=this._taskData.callbacks,i=(e.length,0);i<t.length;i++)t[i]instanceof Function&&e.push(t[i]);return this},P.prototype.done=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(this._taskData.enabled){var i=this._taskData.callbacks[this._taskData.index];if(i)return this._taskData.value=i.apply(this._taskData.context,t)}},P.prototype._to=function(t){return this._taskData.index=Number(t),this},P.prototype.first=function(){return this._to(0)},P.prototype.prev=function(){return this._to(this._taskData.index-1)},P.prototype.next=function(){return this._to(this._taskData.index+1)},P.prototype.to=function(t){return this._to(t)},P.prototype.finish=function(){return this._taskData.index=-1,this},P.prototype.reset=function(){return this._taskData.callbacks=[],this._taskData.index=-1,this._taskData.value=null,this},P.prototype.destroy=function(){this.reset()},T.value.get=function(){return this._taskData.value},Object.defineProperties(P.prototype,T);var B=new e.Box3,D=function(t){function i(i){var o=this;t.call(this),this._size=new e.Vector3,this._pivot=new e.Vector3,this._children=[],this.interactive=!1,this.taskEnabledChildren=!0,this._three=this._sub=i,i.addEventListener("system:interaction:pointerdown",(function(t){o.interactive&&t.emitted.push(o)})),i.addEventListener("system:interaction:pointerup",(function(t){o.interactive&&t.emitted.push(o)})),i.addEventListener("system:interaction:pointermove",(function(t){o.interactive&&t.emitted.push(o)})),i.addEventListener("system:interaction:pointerupoutside",(function(t){o.interactive&&t.emitted.push(o)})),this._task=new P([],this),this._task.first()}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var o={three:{configurable:!0},task:{configurable:!0},taskEnabled:{configurable:!0},parent:{configurable:!0},children:{configurable:!0},width:{configurable:!0},height:{configurable:!0},depth:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0}};return o.three.get=function(){return this._three},o.task.get=function(){return this._task},o.taskEnabled.get=function(){return this._task.enabled},o.taskEnabled.set=function(t){this._task.enabled=t},o.parent.get=function(){return this._three.userData.parent},o.children.get=function(){return this._children},i.prototype.updateTask=function(t){this._task.done(t)},o.width.get=function(){return this.updateBoundingBox(),this._size.x},o.height.get=function(){return this.updateBoundingBox(),this._size.y},o.depth.get=function(){return this.updateBoundingBox(),this._size.z*this.scale.z},o.x.get=function(){return this._three.position.x},o.x.set=function(t){this._three.position.x=t},o.y.get=function(){return this._three.position.y},o.y.set=function(t){this._three.position.y=t},o.z.get=function(){return this._three.position.z},o.z.set=function(t){this._three.position.z=t},o.scale.get=function(){return this._three.scale},o.pivot.get=function(){return this._pivot},i.prototype.update=function(t,e){this.updateTransform(),!e&&this.updateTask(t),e=e||!this.taskEnabledChildren;for(var i=this._children,o=0;o<i.length;o++)i[o].update(t,e)},i.prototype.updateBoundingBox=function(){this.updateTransform(),B.setFromObject(this._sub),B.getSize(this._size),this._size.multiply(this.scale)},i.prototype.addChild=function(t){return t.parent&&t.parent.removeChild(t),this._children.push(t),this._sub.add(t.three),t.three.userData.parent=this,t},i.prototype.removeChild=function(t){if(t.parent===this){var e=this._children.indexOf(t);if(-1!==e)return this._children.splice(e,1),this._sub.remove(t.three),t.three.userData.parent=null,t}},Object.defineProperties(i.prototype,o),i}(r),L=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={rotation:{configurable:!0}};return i.rotation.get=function(){return this._three.rotation},e.prototype.updateTransform=function(){},Object.defineProperties(e.prototype,i),e}(D),R=function(t){function e(e,i){t.call(this,e),this._viewport=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={camera:{configurable:!0},viewport:{configurable:!0}};return i.camera.get=function(){return this._three},i.viewport.get=function(){return this._viewport},e.prototype.render=function(t,e){t.setViewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),t.render(e,this._three)},e.prototype.updateTransform=function(){},e.prototype.updateBoundingBox=function(){},Object.defineProperties(e.prototype,i),e}(L),H=function(t){function i(i){t.call(this,i),this._skew=new e.Vector2,i.matrixAutoUpdate=!1}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var o={skew:{configurable:!0},rotation:{configurable:!0}};return o.skew.get=function(){return this._skew},o.rotation.get=function(){return this._three.rotation.z},o.rotation.set=function(t){this._three.rotation.z=t},i.prototype.updateTransform=function(){this._updateMatrix()},i.prototype._updateMatrix=function(){var t=this.x,e=this.y,i=this._three.position.z,o=this.scale.x,n=this.scale.y,r=this.skew.x,s=this.skew.y,a=this.rotation,h=this.pivot.x,p=this.pivot.y,c=Math.cos(a+s)*o,u=Math.sin(a+s)*o,l=-Math.sin(a-r)*n,d=Math.cos(a-r)*n,f=t-(h*c+p*l),_=e-(h*u+p*d);this._three.matrix.set(c,l,0,f,u,d,0,_,0,0,1,i,0,0,0,1)},Object.defineProperties(i.prototype,o),i}(D),V=function(t){function i(){t.call(this,new e.Group),this._sub=new e.Group,this._three.add(this._sub)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._updateOrder=function(){for(var t=this._children,e=0;e<t.length;e++)t[e].three.position.z=1e-7*e},i.prototype.updateBoundingBox=function(){this._three.remove(this._sub);for(var e=0;e<this._children.length;e++)this._children[e].updateTransform();t.prototype.updateBoundingBox.call(this),this._three.add(this._sub)},i}(H),W=function(t){function i(){t.call(this,new e.Group),this._sub=new e.Group,this._three.add(this._sub)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.updateTransform=function(){this._sub.position.x=-this._pivot.x,this._sub.position.y=-this._pivot.y,this._sub.position.z=-this._pivot.z},i.prototype.updateBoundingBox=function(){this._three.remove(this._sub),t.prototype.updateBoundingBox.call(this),this._three.add(this._sub)},i}(L);function F(t,e){return 0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("//")||0===t.indexOf("/")?t:e.replace(/^(.+)\/$/,"$1")+"/"+t}function X(t,e){return e?t+(t.match(/\?/)?"&":"?")+"_fv="+e:t}var I={},N=0,U=function(){this._assetDefines={},this._vars={},this._attachHandler=function(t,e){},this._id=++N},Y={id:{configurable:!0},vars:{configurable:!0}};Y.id.get=function(){return this._id},Y.vars.get=function(){return Object.assign({},this._vars)},U.prototype.onAttach=function(t,e){this._attachHandler(t,e)},U.prototype.defineAttachHandler=function(t){this._attachHandler=t},U.prototype.defineAssets=function(t,e){for(var i in this._assetDefines[t]=this._assetDefines[t]||{},e)this._assetDefines[t][i]=e[i]},U.prototype.defineTextures=function(t){this.defineAssets("textures",t)},U.prototype.defineGLBs=function(t){this.defineAssets("glbs",t)},U.prototype.loadAssetsAsync=function(t,e){var i=this,o=[],n={},r=function(r){r in I&&o.push(I[r](i._assetDefines[r],t,e).then((function(t){return n[r]=t})))};for(var s in i._assetDefines)r(s);return Promise.all(o).then((function(){return n}))},U.prototype.defineVars=function(t){for(var e in t)this._vars[e]=t[e]},U.registerLoader=function(t,e){I[t]=e},Object.defineProperties(U.prototype,Y),U.registerLoader("textures",(function(t,i,o){var n=new e.TextureLoader,r=[],s={},a=function(e){r.push(new Promise((function(r,a){var h=X(F(t[e],i),o);n.load(h,(function(t){s[e]=t,r()}),void 0,(function(t){a(t)}))})))};for(var h in t)a(h);return Promise.all(r).then((function(){return s}))})),U.registerLoader("glbs",(function(t,e,o){var n=new i.GLTFLoader,r=[],s={},a=function(i){r.push(new Promise((function(r,a){var h=X(F(t[i],e),o);n.load(h,(function(t){s[i]=t,r()}),void 0,(function(t){a(t)}))})))};for(var h in t)a(h);return Promise.all(r).then((function(){return s}))}));var q=function(t){function i(i,n){t.call(this,new e.Mesh(i,n)),this._anchor=new o(0,0,0,this),n.transparent=!0,this.updateGeometryPosition()}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var n={anchor:{configurable:!0}};return n.anchor.get=function(){return this._anchor},i.prototype.updateGeometryPosition=function(){this._three.geometry.center(),this.updateBoundingBox(),this._three.geometry.translate(this._size.x*(.5-this._anchor.x),this._size.y*(.5-this._anchor.y),this._size.z*(.5-this._anchor.z))},i.prototype.updateBoundingBox=function(){this._three.geometry.computeBoundingBox(),this._three.geometry.boundingBox&&this._three.geometry.boundingBox.getSize(this._size),this._size.multiply(this.scale)},Object.defineProperties(i.prototype,n),i}(L),K=function(t){function e(e,i){t.call(this,e),this._contactEnabled=!1,this._body=i,this._position=new z(this),this._rotation=new A(this),i.userData.ref=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={body:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},position:{configurable:!0},rotation:{configurable:!0}};return i.body.get=function(){return this._body},i.x.get=function(){return this._position.x},i.x.set=function(t){this._position.x=t},i.y.get=function(){return this._position.y},i.y.set=function(t){this._position.y=t},i.z.get=function(){return this._position.z},i.z.set=function(t){this._position.z=t},i.position.get=function(){return this._position},i.rotation.get=function(){return this._rotation},e.prototype.updateTransform=function(){this._three.position.copy(this._body.getPosition()),this._three.quaternion.copy(this._body.getOrientation())},e.prototype.setCollisionGroup=function(t){this._body.setCollisionGroup(t)},e.prototype.addCollisionGroup=function(t){this._body.addCollisionGroup(t)},e.prototype.removeCollisionGroup=function(t){this._body.removeCollisionGroup(t)},e.prototype.setCollisionMask=function(t){this._body.setCollisionMask(t)},e.prototype.addCollisionMask=function(t){this._body.addCollisionMask(t)},e.prototype.removeCollisionMask=function(t){this._body.removeCollisionMask(t)},Object.defineProperties(e.prototype,i),e}(L),$=function(t){function i(){t.call(this,new e.Scene),this._cameras=[],this.interactive=!0}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var o={scene:{configurable:!0}};return o.scene.get=function(){return this._three},i.prototype.addCamera=function(t){return t.parent&&t.parent.removeChild(t),this._cameras.push(t),this._three.add(t.three),t.three.userData.parent=this,t},i.prototype.removeCamera=function(t){if(t.parent===this){var e=this._cameras.indexOf(t);if(-1!==e)return this._cameras.splice(e,1),this._three.remove(t.three),t.three.userData.parent=null,t}},i.prototype.add=function(t){return this._three.add(t),t},i.prototype.remove=function(t){return this._three.remove(t),t},i.prototype.render=function(t){for(var e=this._cameras,i=0;i<e.length;i++)t.clearDepth(),e[i].render(t,this._three)},i.prototype.onInteraction=function(t,i,o){var n=this;if(this.interactive)for(var r=this._cameras,s=function(s){if(t.emitted.length>0)return{};i.setFromCamera(o,r[s].camera);for(var a=function(t){return t.children.map((function(t){return t instanceof e.Mesh?t:a(t)})).flat()},h=a(n._three),p=i.intersectObjects(h),c=0;c<p.length;c++){if(t.emitted.length>0)return;for(var u=p[c].object;u!==n._three&&(u.dispatchEvent(t),u.parent);)u=u.parent}},a=0;a<r.length;a++){var h=s(a);if(h)return h.v}},i.prototype.updateTransform=function(){},Object.defineProperties(i.prototype,o),i}(L),J=OIMO,Q=function(t){function e(){var e=this;t.call(this),this._sensoredShapes=[],this.physicsEnabled=!0,this._world=new J.World,this._world.setGravity(new J.Vec3(0,-9.8,0)),this._onShapeAdded=function(t){-1===e._sensoredShapes.indexOf(t)&&e._sensoredShapes.push(t)},this._onShapeRemoved=function(t){var i=e._sensoredShapes.indexOf(t);i>-1&&e._sensoredShapes.splice(i,1)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={world:{configurable:!0},children:{configurable:!0}};return i.world.get=function(){return this._world},i.children.get=function(){return this._children},e.prototype.addChild=function(e){t.prototype.addChild.call(this,e),this._world.addRigidBody(e.body);for(var i=e.body.getSensoredShapeList(),o=0;o<i.length;o++)this._onShapeAdded(i[o]);return e.body.on("sensoredShapeAdded",this._onShapeAdded),e.body.on("sensoredShapeRemoved",this._onShapeRemoved),e},e.prototype.removeChild=function(e){var i=t.prototype.removeChild.call(this,e);if(i){this._world.removeRigidBody(e.body);for(var o=e.body.getSensoredShapeList(),n=0;n<o.length;n++)this._onShapeRemoved(o[n]);return e.body.off("sensoredShapeAdded",this._onShapeAdded),e.body.off("sensoredShapeRemoved",this._onShapeRemoved),i}},e.prototype.update=function(e,i){if(this.physicsEnabled){this._world.step(1/60);for(var o=0;o<this._sensoredShapes.length;o++)this._sensoredShapes[o].aabbTest(this._world)}t.prototype.update.call(this,e,i)},Object.defineProperties(e.prototype,i),e}($),Z=new J.ContactCallback;function tt(t,e){var i=e.getShape1(),o=e.getShape2();it.originalEvent=e,it.hit=o,i.emit(t,it)}Z.beginContact=function(t){tt("beginContact",t)},Z.endContact=function(t){tt("endContact",t)},Z.preSolve=function(t){tt("preSolve",t)},Z.postSolve=function(t){tt("postSolve",t)};var et=function(t){function e(e){t.call(this,e),this._collisionEnabled=!0,this._contactEnabled=!1,this._emitter=new r,this._collisionGroup=this.getCollisionGroup(),this._collisionMask=this.getCollisionMask(),this._updateCollisionGroup(),this._updateCollisionMask()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={collisionGroup:{configurable:!0},collisionMask:{configurable:!0},collisionEnabled:{configurable:!0},contectEnabled:{configurable:!0},contactEnabled:{configurable:!0}};return e.prototype.on=function(t,e){this._emitter.on(t,e)},e.prototype.off=function(t,e){this._emitter.off(t,e)},e.prototype.emit=function(t){for(var e,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];(e=this._emitter).cemit.apply(e,[t,this].concat(i))},i.collisionGroup.get=function(){return this._collisionGroup},i.collisionMask.get=function(){return this._collisionMask},i.collisionEnabled.get=function(){return this._collisionEnabled},i.collisionEnabled.set=function(t){this._collisionEnabled=t,this._updateCollisionGroup(),this._updateCollisionMask()},i.contectEnabled.get=function(){return this._contactEnabled},i.contactEnabled.set=function(t){this._contactEnabled=t,t?this.setContactCallback(Z):this.setContactCallback(null)},e.prototype.setCollisionGroup=function(t){this._collisionGroup=t,this._updateCollisionGroup()},e.prototype.addCollisionGroup=function(t){this._collisionGroup|=t,this._updateCollisionGroup()},e.prototype.removeCollisionGroup=function(t){this._collisionGroup^=this._collisionGroup&t,this._updateCollisionGroup()},e.prototype.setCollisionMask=function(t){this._collisionMask=t,this._updateCollisionMask()},e.prototype.addCollisionMask=function(t){this._collisionMask|=t,this._updateCollisionMask()},e.prototype.removeCollisionMask=function(t){this._collisionMask^=this._collisionMask&t,this._updateCollisionMask()},e.prototype._setCollisionGroup=function(e){t.prototype.setCollisionGroup.call(this,e)},e.prototype._setCollisionMask=function(e){t.prototype.setCollisionMask.call(this,e)},e.prototype._updateCollisionGroup=function(){this._collisionEnabled?this._setCollisionMask(this._collisionGroup):this._setCollisionGroup(0)},e.prototype._updateCollisionMask=function(){this._collisionEnabled?this._setCollisionMask(this._collisionMask):this._setCollisionMask(0)},e.prototype.getObject=function(){var t=this.getRigidBody();if(t)return t.getObject()},Object.defineProperties(e.prototype,i),e}(J.Shape),it={hit:new et(new J.ShapeConfig),originalEvent:null};function ot(t,e,i){it.originalEvent=null,it.hit=i,e.emit(t,it)}var nt=function(t){function e(e){var i=this;t.call(this,e),this._sensorEnabled=!0,this._aabbTestCallback=new J.AabbTestCallback,this._touchedShapes=[],this._touchShapes=[],this.contactEnabled=!0,this._updateCollisionGroup(),this._updateCollisionMask(),this._aabbTestCallback.process=function(t){if(0!=(i._collisionMask&t.collisionGroup)&&0!=(i._collisionGroup&t.collisionMask)){var e=i._touchedShapes.indexOf(t);-1===e?ot("beginContact",i,t):i._touchedShapes.splice(e,1),i._touchShapes.push(t)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={sensorEnabled:{configurable:!0},isSensor:{configurable:!0}};return i.sensorEnabled.get=function(){return this._sensorEnabled},i.sensorEnabled.set=function(t){this._sensorEnabled=t,this._updateCollisionGroup(),this._updateCollisionMask()},i.isSensor.get=function(){return this._collisionEnabled&&this._contactEnabled&&this._sensorEnabled},e.prototype.aabbTest=function(t){if(this.isSensor){this._touchedShapes=this._touchShapes,this._touchShapes=[],t.aabbTest(this.getAabb(),this._aabbTestCallback);for(var e=0;e<this._touchedShapes.length;e++)ot("endContact",this,this._touchedShapes[e])}},e.prototype._updateCollisionGroup=function(){this._collisionEnabled?this._sensorEnabled?this._setCollisionGroup(0):this._setCollisionGroup(this._collisionGroup):this._setCollisionGroup(0)},e.prototype._updateCollisionMask=function(){this._collisionEnabled?this._sensorEnabled?this._setCollisionMask(0):this._setCollisionMask(this._collisionMask):this._setCollisionMask(0)},Object.defineProperties(e.prototype,i),e}(et),rt=function(t){function e(e){t.call(this,e),this._emitter=new r,this.userData={ref:null}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getObject=function(){return this.userData.ref},e.prototype.on=function(t,e){this._emitter.on(t,e)},e.prototype.off=function(t,e){this._emitter.off(t,e)},e.prototype.emit=function(t){for(var e,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];(e=this._emitter).cemit.apply(e,[t,this].concat(i))},e.prototype.getSensoredShapeList=function(){for(var t=[],e=this.getShapeList();e;)e instanceof nt&&t.push(e),e=e.getNext();return t},e.prototype.addShape=function(e){t.prototype.addShape.call(this,e),e instanceof nt&&this.emit("sensoredShapeAdded",e)},e.prototype.removeShape=function(e){t.prototype.removeShape.call(this,e),e instanceof nt&&this.emit("sensoredShapeRemoved",e)},e.prototype.setCollisionGroup=function(t){for(var e=this.getShapeList();e;)e.setCollisionGroup(t),e=e.getNext()},e.prototype.addCollisionGroup=function(t){for(var e=this.getShapeList();e;){var i=e.getCollisionGroup();i|=t,e.setCollisionGroup(i),e=e.getNext()}},e.prototype.removeCollisionGroup=function(t){for(var e=this.getShapeList();e;){var i=e.getCollisionGroup();i^=i&t,e.setCollisionGroup(i),e=e.getNext()}},e.prototype.setCollisionMask=function(t){for(var e=this.getShapeList();e;)e.setCollisionMask(t),e=e.getNext()},e.prototype.addCollisionMask=function(t){for(var e=this.getShapeList();e;){var i=e.getCollisionMask();i|=t,e.setCollisionMask(i),e=e.getNext()}},e.prototype.removeCollisionMask=function(t){for(var e=this.getShapeList();e;){var i=e.getCollisionMask();i^=i&t,e.setCollisionMask(i),e=e.getNext()}},e.createStatic=function(){var t=new J.RigidBodyConfig;return t.type=J.RigidBodyType.STATIC,new e(t)},e.createDynamic=function(){var t=new J.RigidBodyConfig;return t.type=J.RigidBodyType.DYNAMIC,new e(t)},e.createKinematic=function(){var t=new J.RigidBodyConfig;return t.type=J.RigidBodyType.KINEMATIC,new e(t)},e}(J.RigidBody),st=function(t){function i(i){t.call(this,new e.Mesh),this._width=0,this._height=0,this._anchor=new o(0,0,0,this),this._material=new e.MeshBasicMaterial,this._material.transparent=!0,this._three.material=this._material,this._texture=i,this.texture=i}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var n={texture:{configurable:!0},anchor:{configurable:!0}};return n.texture.get=function(){return this._texture},n.texture.set=function(t){this._texture=t,this._material.needsUpdate=!0,this._material.map=t,t&&t.image?this._updateGeometry(t.image.width,t.image.height):this._updateGeometry(0,0)},n.anchor.get=function(){return this._anchor},i.prototype._updateGeometry=function(t,i){this._three.geometry=new e.PlaneGeometry(t,i),this._width=t,this._height=i,this.updateGeometryPosition()},i.prototype.updateGeometryPosition=function(){this._three.geometry.center(),this._three.geometry.translate(this._width*(.5-this._anchor.x),this._height*(.5-this._anchor.y),0)},i.prototype.updateBoundingBox=function(){this._three.geometry.computeBoundingBox(),this._three.geometry.boundingBox&&this._three.geometry.boundingBox.getSize(this._size),this._size.multiply(this.scale)},i.from=function(t,o){var n=new i((new e.TextureLoader).load(t,(function(t){n.texture=t,o&&o(n)})));return n},Object.defineProperties(i.prototype,n),i}(H);t.Anchor=o,t.Application=M,t.BodyPosition=z,t.BodyRotation=A,t.Camera=R,t.Container2D=V,t.Container3D=W,t.Content=U,t.DisplayObject=D,t.InteractionManager=S,t.Mesh=q,t.Object2D=H,t.Object3D=L,t.PhysicsObject3D=K,t.PhysicsView=Q,t.RigidBody=rt,t.SensoredShape=nt,t.Shape=et,t.Sprite=st,t.View=$}(this.TLAP=this.TLAP||{},THREE,{GLTFLoader:THREE.GLTFLoader});//# sourceMappingURL=tlap.min.js.map

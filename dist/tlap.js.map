{"version":3,"file":"tlap.js","sources":["../src/Anchor.ts","../node_modules/ismobilejs/esm/isMobile.js","../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../src/InteractionManager.ts","../src/Application.ts","../src/BodyPosition.ts","../src/BodyRotation.ts","../node_modules/@tawaship/task/dist/Task.esm.js","../src/DisplayObject.ts","../src/Object3D.ts","../src/Camera.ts","../src/Object2D.ts","../src/Container2D.ts","../src/Container3D.ts","../src/Content.ts","../src/Mesh.ts","../src/PhysicsObject3D.ts","../src/View.ts","../src/OIMO.ts","../src/PhysicsView.ts","../src/Shape.ts","../src/RigidBody.ts","../src/Sprite.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport { IMesh } from './IMesh';\r\n\r\nexport class Anchor {\r\n\tprivate _x: number;\r\n\tprivate _y: number;\r\n\tprivate _z: number;\r\n\tprivate _mesh: IMesh;\r\n\t\r\n\tconstructor(x: number, y: number, z: number, mesh: IMesh) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._mesh = mesh;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._x = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._y = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._z = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\t\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n}","var appleIphone = /iPhone/i;\nvar appleIpod = /iPod/i;\nvar appleTablet = /iPad/i;\nvar appleUniversal = /\\biOS-universal(?:.+)Mac\\b/i;\nvar androidPhone = /\\bAndroid(?:.+)Mobile\\b/i;\nvar androidTablet = /Android/i;\nvar amazonPhone = /(?:SD4930UR|\\bSilk(?:.+)Mobile\\b)/i;\nvar amazonTablet = /Silk/i;\nvar windowsPhone = /Windows Phone/i;\nvar windowsTablet = /\\bWindows(?:.+)ARM\\b/i;\nvar otherBlackBerry = /BlackBerry/i;\nvar otherBlackBerry10 = /BB10/i;\nvar otherOpera = /Opera Mini/i;\nvar otherChrome = /\\b(CriOS|Chrome)(?:.+)Mobile/i;\nvar otherFirefox = /Mobile(?:.+)Firefox\\b/i;\nvar isAppleTabletOnIos13 = function (navigator) {\n    return (typeof navigator !== 'undefined' &&\n        navigator.platform === 'MacIntel' &&\n        typeof navigator.maxTouchPoints === 'number' &&\n        navigator.maxTouchPoints > 1 &&\n        typeof MSStream === 'undefined');\n};\nfunction createMatch(userAgent) {\n    return function (regex) { return regex.test(userAgent); };\n}\nexport default function isMobile(param) {\n    var nav = {\n        userAgent: '',\n        platform: '',\n        maxTouchPoints: 0\n    };\n    if (!param && typeof navigator !== 'undefined') {\n        nav = {\n            userAgent: navigator.userAgent,\n            platform: navigator.platform,\n            maxTouchPoints: navigator.maxTouchPoints || 0\n        };\n    }\n    else if (typeof param === 'string') {\n        nav.userAgent = param;\n    }\n    else if (param && param.userAgent) {\n        nav = {\n            userAgent: param.userAgent,\n            platform: param.platform,\n            maxTouchPoints: param.maxTouchPoints || 0\n        };\n    }\n    var userAgent = nav.userAgent;\n    var tmp = userAgent.split('[FBAN');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    tmp = userAgent.split('Twitter');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    var match = createMatch(userAgent);\n    var result = {\n        apple: {\n            phone: match(appleIphone) && !match(windowsPhone),\n            ipod: match(appleIpod),\n            tablet: !match(appleIphone) &&\n                (match(appleTablet) || isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone),\n            universal: match(appleUniversal),\n            device: (match(appleIphone) ||\n                match(appleIpod) ||\n                match(appleTablet) ||\n                match(appleUniversal) ||\n                isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone)\n        },\n        amazon: {\n            phone: match(amazonPhone),\n            tablet: !match(amazonPhone) && match(amazonTablet),\n            device: match(amazonPhone) || match(amazonTablet)\n        },\n        android: {\n            phone: (!match(windowsPhone) && match(amazonPhone)) ||\n                (!match(windowsPhone) && match(androidPhone)),\n            tablet: !match(windowsPhone) &&\n                !match(amazonPhone) &&\n                !match(androidPhone) &&\n                (match(amazonTablet) || match(androidTablet)),\n            device: (!match(windowsPhone) &&\n                (match(amazonPhone) ||\n                    match(amazonTablet) ||\n                    match(androidPhone) ||\n                    match(androidTablet))) ||\n                match(/\\bokhttp\\b/i)\n        },\n        windows: {\n            phone: match(windowsPhone),\n            tablet: match(windowsTablet),\n            device: match(windowsPhone) || match(windowsTablet)\n        },\n        other: {\n            blackberry: match(otherBlackBerry),\n            blackberry10: match(otherBlackBerry10),\n            opera: match(otherOpera),\n            firefox: match(otherFirefox),\n            chrome: match(otherChrome),\n            device: match(otherBlackBerry) ||\n                match(otherBlackBerry10) ||\n                match(otherOpera) ||\n                match(otherFirefox) ||\n                match(otherChrome)\n        },\n        any: false,\n        phone: false,\n        tablet: false\n    };\n    result.any =\n        result.apple.device ||\n            result.android.device ||\n            result.windows.device ||\n            result.other.device;\n    result.phone =\n        result.apple.phone || result.android.phone || result.windows.phone;\n    result.tablet =\n        result.apple.tablet || result.android.tablet || result.windows.tablet;\n    return result;\n}\n//# sourceMappingURL=isMobile.js.map","/*!\n * @tawaship/emitter - v3.1.1\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    _on(type, callback, once) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ callback, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    on(type, callback) {\r\n        return this._on(type, callback, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    once(type, callback) {\r\n        return this._on(type, callback, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Registered callback.\r\n     */\r\n    off(type, callback) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    _emit(type, context, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const targets = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const event = events[i];\r\n            if (event.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            targets.push(event);\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emit(type, ...args) {\r\n        return this._emit(type, this, ...args);\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        return this._emit(type, context, ...args);\r\n    }\r\n    _emitAll(context, ...args) {\r\n        if (context == null) {\r\n            return this;\r\n        }\r\n        const targets = [];\r\n        for (let type in this._events) {\r\n            const events = this._events[type] || [];\r\n            for (let i = events.length - 1; i >= 0; i--) {\r\n                const event = events[i];\r\n                if (event.once) {\r\n                    events.splice(i, 1);\r\n                }\r\n                targets.push(event);\r\n            }\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit all events.\r\n     *\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emitAll(...args) {\r\n        return this._emitAll(this, ...args);\r\n    }\r\n    /**\r\n     * Emit all events with specifying a context.\r\n     *\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemitAll(context, ...args) {\r\n        return this._emitAll(context, ...args);\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove. If it is empty, removes all events.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","import * as THREE from 'three';\r\nimport isMobile from 'ismobilejs';\r\nimport { DisplayObject } from './DisplayObject';\r\nimport { Emitter } from '@tawaship/emitter';\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst isSP = isMobile(navigator.userAgent).any;\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction separate(_first: DisplayObject[], _emitted: DisplayObject[]) {\r\n\tconst first: DisplayObject[] = _first.concat([]);\r\n\tconst emitted: DisplayObject[] = _emitted.concat([]);\r\n\tconst both: DisplayObject[] = [];\r\n\t\r\n\tfor (let i = first.length - 1; i >= 0; i--) {\r\n\t\tconst p = first[i];\r\n\t\tconst index = emitted.indexOf(p);\r\n\t\t\r\n\t\tif (index > -1) {\r\n\t\t\tfirst.splice(i, 1);\r\n\t\t\temitted.splice(index, 1);\r\n\t\t\tboth.push(p);\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn { both, first, emitted };\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction dispatch(targets: DisplayObject[], type: string, event: IInteractionEvent) {\r\n\tfor (let i = 0; i < targets.length; i++) {\r\n\t\ttargets[i].emit(type, event);\r\n\t}\r\n};\r\n\r\nexport interface IInteractionEvent extends THREE.Event {\r\n\ttype: string;\r\n\temitted: DisplayObject[];\r\n\toriginalEvent: Event | null;\r\n};\r\n\r\nexport class InteractionManager extends Emitter {\r\n\tprotected _mouse: THREE.Vector2 = new THREE.Vector2();\r\n\tprotected _event: IInteractionEvent = { type: '', emitted: [], originalEvent: null };\r\n\tprotected _down: DisplayObject[] = [];\r\n\tprotected _over: DisplayObject[] = [];\r\n\t\r\n\tinteractive: boolean = true;\r\n\tinteractiveDown: boolean = true;\r\n\tinteractiveMove: boolean = false;\r\n\tinteractiveUp: boolean = true;\r\n\t\r\n\t/**\r\n\t * @fire cast\r\n\t */\r\n\tprotected _cast(e: Event, x: number, y: number, width: number, height: number) {\r\n\t\tthis._event.originalEvent = e;\r\n\t\tthis._event.emitted = [];\r\n\t\t\r\n\t\tthis._mouse.x = (x / width) * 2 - 1;\r\n\t\tthis._mouse.y = -(y / height) * 2 + 1;\r\n\t\t\r\n\t\tthis.emit('cast', this._event, this._mouse);\r\n\t}\r\n\t\r\n\tonDown(e: Event, x: number, y: number, width: number, height: number) {\r\n\t\tthis._down = [];\r\n\t\tif (!this.interactive || !this.interactiveDown) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._event.type = 'system:interaction:pointerdown';\r\n\t\tthis._cast(e, x, y, width, height);\r\n\t\t\r\n\t\tif (this._event.emitted.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdispatch(this._event.emitted, 'pointerdown', this._event);\r\n\t\tthis._down = this._event.emitted;\r\n\t}\r\n\t\r\n\tonMove(e: Event, x: number, y: number, width: number, height: number) {\r\n\t\tif (!this.interactive || !this.interactiveMove) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._event.type = 'system:interaction:pointermove';\r\n\t\tthis._cast(e, x, y, width, height);\r\n\t\t\r\n\t\tif (this._over.length === 0) {\r\n\t\t\tif (this._event.emitted.length > 0) {\r\n\t\t\t\tdispatch(this._event.emitted, 'pointerover', this._event);\r\n\t\t\t\tthis._over = this._event.emitted;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (this._event.emitted.length === 0) {\r\n\t\t\tdispatch(this._over, 'pointerout', this._event);\r\n\t\t\tthis._over = [];\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst saparated = separate(this._over, this._event.emitted);\r\n\t\t\r\n\t\tdispatch(saparated.emitted, 'pointerover', this._event);\r\n\t\tdispatch(saparated.first, 'pointerout', this._event);\r\n\t\tthis._over = this._event.emitted;\r\n\t\t\r\n\t\tdispatch(saparated.both, 'pointermove', this._event);\r\n\t}\r\n\t\r\n\tonUp(e: Event, x: number, y: number, width: number, height: number) {\r\n\t\tif (!this.interactive || !this.interactiveUp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._event.type = 'system:interaction:pointerup';\r\n\t\tthis._cast(e, x, y, width, height);\r\n\t\t\r\n\t\tif (this._down.length === 0) {\r\n\t\t\tif (this._event.emitted.length > 0) {\r\n\t\t\t\tdispatch(this._event.emitted, 'pointerup', this._event);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (this._event.emitted.length === 0) {\r\n\t\t\tdispatch(this._down, 'pointerupoutside', this._event);\r\n\t\t\tthis._down = [];\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst saparated = separate(this._down, this._event.emitted);\r\n\t\t\r\n\t\tdispatch(saparated.emitted, 'pointerup', this._event);\r\n\t\tdispatch(saparated.first, 'pointerupoutside', this._event);\r\n\t\t\r\n\t\tdispatch(saparated.both, 'pointerup', this._event);\r\n\t\tdispatch(saparated.both, 'pointertap', this._event);\r\n\t\tthis._down = [];\r\n\t}\r\n\t\r\n\taddCanvas(canvas: HTMLCanvasElement) {\r\n\t\tif (isSP) {\r\n\t\t\tcanvas.addEventListener('touchstart', (e: TouchEvent) => {\r\n\t\t\t\tthis.onDown(e, e.touches[0].clientX - canvas.offsetLeft, e.touches[0].clientY - canvas.offsetTop, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcanvas.addEventListener('touchmove', (e: TouchEvent) => {\r\n\t\t\t\tthis.onMove(e, e.touches[0].clientX - canvas.offsetLeft, e.touches[0].clientY - canvas.offsetTop, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcanvas.addEventListener('touchend', (e: TouchEvent) => {\r\n\t\t\t\tthis.onUp(e, e.changedTouches[0].clientX - canvas.offsetLeft, e.changedTouches[0].clientY - canvas.offsetTop, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tcanvas.addEventListener('mousedown', (e: MouseEvent) => {\r\n\t\t\t\tthis.onDown(e, e.offsetX, e.offsetY, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcanvas.addEventListener('mousemove', (e: MouseEvent) => {\r\n\t\t\t\tthis.onMove(e, e.offsetX, e.offsetY, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcanvas.addEventListener('mouseup', (e: MouseEvent) => {\r\n\t\t\t\tthis.onUp(e, e.offsetX, e.offsetY, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport isMobile from 'ismobilejs';\r\nimport { View } from './View';\r\nimport { DisplayObject, ITickerData } from './DisplayObject';\r\nimport { InteractionManager, IInteractionEvent } from './InteractionManager';\r\nimport { Content } from './Content';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport interface IApplicationOption {\r\n\tcanvas?: HTMLCanvasElement;\r\n\tcontainer?: HTMLElement;\r\n\twidth?: number;\r\n\theight?: number;\r\n\ttransparent?: boolean;\r\n\tresolution?: number;\r\n\tbackgroundColor?: number;\r\n\tantialias?: boolean;\r\n\tautoAdjust?: TAutoAdjust;\r\n\tbasepath?: string;\r\n\tversion?: string;\r\n\tinteractionCanvas?: HTMLCanvasElement;\r\n}\r\n\r\nexport interface IAdjustDelegate {\r\n\t(app: Application): void;\r\n}\r\n\r\nexport type TAutoAdjust = boolean | IAdjustDelegate;\r\n\r\nexport interface IAutoAdjustDelegate {\r\n\t(): void;\r\n}\r\n\r\nexport type TAutoAdjuster = IAutoAdjustDelegate | null;\r\n\r\nexport interface ISize {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IPosition {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport interface IHorizontal {\r\n\tx: number;\r\n\twidth: number;\r\n}\r\n\r\nexport interface IVertical {\r\n\ty: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IRect extends ISize, IPosition {}\r\n\r\nexport class Application {\r\n\tprivate _container: HTMLElement;\r\n\tprivate _renderer: THREE.WebGLRenderer;\r\n\tprivate _views: View[] = [];\r\n\tprivate _lastTime: number = 0;\r\n\tprivate _playing: boolean = false;\r\n\tprivate _rendererSize: THREE.Vector2;\r\n\tprivate _autoAdjuster: TAutoAdjuster = null;\r\n\tprivate _basepath: string = '';\r\n\tprivate _version: string = '';\r\n\tprivate _interactionManager = new InteractionManager();\r\n\t\r\n\tconstructor(options: IApplicationOption = {}) {\r\n\t\tconst canvas = options.canvas || undefined;\r\n\t\tconst container = options.container || document.body;\r\n\t\tconst transparent = options.transparent || false;\r\n\t\tconst antialias = options.antialias || false;\r\n\t\tconst rendererOptions = {\r\n\t\t\tcanvas, alpha: transparent, antialias\r\n\t\t}\r\n\t\t\r\n\t\tconst renderer = new THREE.WebGLRenderer(rendererOptions);\r\n\t\t\r\n\t\tconst width = options.width || 600;\r\n\t\tconst height = options.height || 400;\r\n\t\tconst resolution = options.resolution || 1;\r\n\t\tconst backgroundColor = options.backgroundColor || 0;\r\n\t\tconst opacity = transparent ? 0 : 1;\r\n\t\tconst autoAdjust = options.autoAdjust || false;\r\n\t\tconst basepath = options.basepath || './';\r\n\t\tconst version = options.version || '';\r\n\t\t\r\n\t\trenderer.setClearColor(backgroundColor, 0);\r\n\t\trenderer.setSize(width, height);\r\n\t\trenderer.setPixelRatio(resolution);\r\n\t\trenderer.autoClear = false;\r\n\t\t\r\n\t\tthis._container = container;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._rendererSize = new THREE.Vector2(width, height);\r\n\t\tthis._basepath = basepath;\r\n\t\tthis._version = version;\r\n\t\t\r\n\t\trenderer.domElement.style.position = 'absolute';\r\n\t\t\r\n\t\tconst raycaster = new THREE.Raycaster();\r\n\t\t\r\n\t\tthis._interactionManager.addCanvas(renderer.domElement);\r\n\t\t\r\n\t\tthis._interactionManager.on('cast', (event: IInteractionEvent, mouse: THREE.Vector2) => {\r\n\t\t\tconst c = this._views;\r\n\t\t\tfor (let i = c.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tc[i].onInteraction(event, raycaster, mouse);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\twindow.addEventListener('visibilitychange', e => {\r\n\t\t\tthis._lastTime = e.timeStamp;\r\n\t\t});\r\n\t\t\r\n\t\tconst step = (timestamp: number) => {\r\n\t\t\tconst delta = (timestamp - this._lastTime) * 0.06;\r\n\t\t\tthis._lastTime = timestamp;\r\n\t\t\t\r\n\t\t\tif (!this._playing) {\r\n\t\t\t\trequestAnimationFrame(step);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.update(delta);\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t};\r\n\t\t\r\n\t\trequestAnimationFrame(step);\r\n\t\t\r\n\t\tif (autoAdjust) {\r\n\t\t\tif (autoAdjust === true) {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tthis.fullScreen()\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tautoAdjust(this);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tattachAsync(content: Content) {\r\n\t\treturn content.loadAssetsAsync(this._basepath, this._version)\r\n\t\t\t.then(resources => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: this._rendererSize.width,\r\n\t\t\t\t\theight: this._rendererSize.height,\r\n\t\t\t\t\tresources,\r\n\t\t\t\t\tvars: content.vars\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.then(($: IDeliverData) => {\r\n\t\t\t\tconst viewClasses = content.viewClasses;\r\n\t\t\t\tfor (let i = 0; i < viewClasses.length; i++) {\r\n\t\t\t\t\tthis.addView(new viewClasses[i]($));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn this;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tget renderer() {\r\n\t\treturn this._renderer;\r\n\t}\r\n\t\r\n\tget interactionManager() {\r\n\t\treturn this._interactionManager;\r\n\t}\r\n\t\r\n\tget element() {\r\n\t\treturn this._renderer.domElement;\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\treturn this._rendererSize.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\treturn this._rendererSize.y;\r\n\t}\r\n\t\r\n\taddView(view: View) {\r\n\t\tthis._views.push(view);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tremoveView(view: View) {\r\n\t\tconst index = this._views.indexOf(view);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._views.splice(index, 1);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tplay() {\r\n\t\tthis._container.appendChild(this._renderer.domElement);\r\n\t\t\r\n\t\treturn this.start();\r\n\t}\r\n\t\r\n\tstart() {\r\n\t\tthis._playing = true;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tstop() {\r\n\t\tthis._playing = false;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tupdate(delta: number) {\r\n\t\tconst c = this._views;\r\n\t\tconst e: ITickerData = { delta };\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t\t\r\n\t\tthis.render();\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tthis._renderer.setViewport(0, 0, this._rendererSize.x, this._rendererSize.y);\r\n\t\tthis._renderer.clear();\r\n\t\t\r\n\t\tconst c = this._views;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].render(this._renderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget autoAdjuster() {\r\n\t\treturn this._autoAdjuster;\r\n\t}\r\n\t\r\n\tset autoAdjuster(autoAdjuster: TAutoAdjuster) {\r\n\t\tif (this._autoAdjuster) {\r\n\t\t\twindow.removeEventListener('resize', this._autoAdjuster);\r\n\t\t}\r\n\t\t\r\n\t\tif (!autoAdjuster) {\r\n\t\t\tthis._autoAdjuster = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._autoAdjuster = autoAdjuster;\r\n\t\twindow.addEventListener('resize', autoAdjuster);\r\n\t\tautoAdjuster();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified rectangle.\r\n\t * \r\n\t * @param rect Rectangle to adjust.\r\n\t */\r\n\tfullScreen(rect?: IRect) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst r: IRect = rect || {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tif (r.width / r.height > view.width / view.height) {\r\n\t\t\treturn this.adjustHeight(r.height).toCenter(r).toTop(r);\r\n\t\t}\r\n\t\t\r\n\t\treturn this.adjustWidth(r.width).toMiddle(r).toLeft(r);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified width.\r\n\t * \r\n\t * @param width Width to adjust.\r\n\t */\r\n\tadjustWidth(width?: number) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst w: number = width || this._container.offsetWidth || window.innerWidth;\r\n\t\t\r\n\t\tconst h: number = w / view.width * view.height;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.width = `${w}px`;\r\n\t\tview.style.height = `${h}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified height.\r\n\t * \r\n\t * @param height Height to adjust.\r\n\t */\r\n\tadjustHeight(height?: number) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst h: number = height || this._container.offsetHeight || window.innerHeight;\r\n\t\t\r\n\t\tconst w = h / view.height * view.width;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.height = `${h}px`;\r\n\t\tview.style.width = `${w}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Left justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoLeft(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Center justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoCenter(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${(hol.width - this._getViewRect().width) / 2 + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Right justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoRight(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.width - this._getViewRect().width + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Top justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoTop(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Middle justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoMiddle(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${(ver.height - this._getViewRect().height) / 2 + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Bottom justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoBottom(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.height - this._getViewRect().height + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tprivate _getViewRect(): IRect {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: parseInt(view.style.left.replace('px', '')),\r\n\t\t\ty: parseInt(view.style.top.replace('px', '')),\r\n\t\t\twidth: parseInt(view.style.width.replace('px', '')),\r\n\t\t\theight: parseInt(view.style.height.replace('px', ''))\r\n\t\t};\r\n\t}\r\n}\r\n","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyPosition {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getPosition().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getPosition().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.y = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getPosition().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.z = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = x;\r\n\t\tposition.y = y;\r\n\t\tposition.z = z;\r\n\t\t\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyRotation {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.y = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.z = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = x;\r\n\t\trotation.y = y;\r\n\t\trotation.z = z;\r\n\t\t\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","/*!\n * @tawaship/task - v1.1.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Task {\r\n    constructor(callbacks, context) {\r\n        this._taskData = {\r\n            context: context == null ? this : context,\r\n            enabled: true,\r\n            index: -1,\r\n            callbacks: [],\r\n            value: null\r\n        };\r\n        this.add(callbacks);\r\n    }\r\n    /**\r\n     * Whether the task works.\r\n     */\r\n    get enabled() {\r\n        return this._taskData.enabled;\r\n    }\r\n    set enabled(enabled) {\r\n        this._taskData.enabled = enabled;\r\n    }\r\n    /**\r\n     * Add the task to the end of the list.\r\n     */\r\n    add(callbacks) {\r\n        if (!Array.isArray(callbacks)) {\r\n            callbacks = [callbacks];\r\n        }\r\n        const list = this._taskData.callbacks;\r\n        const flag = list.length === 0;\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (!(callbacks[i] instanceof Function)) {\r\n                continue;\r\n            }\r\n            list.push(callbacks[i]);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Execute the current task.\r\n     */\r\n    done(...args) {\r\n        if (!this._taskData.enabled) {\r\n            return;\r\n        }\r\n        const task = this._taskData.callbacks[this._taskData.index];\r\n        if (!task) {\r\n            return;\r\n        }\r\n        return this._taskData.value = task.apply(this._taskData.context, args);\r\n    }\r\n    _to(index) {\r\n        this._taskData.index = Number(index);\r\n        return this;\r\n    }\r\n    /**\r\n     * Change the current task to the first task.\r\n     */\r\n    first() {\r\n        return this._to(0);\r\n    }\r\n    /**\r\n     * Change the current task to the previos task.\r\n     */\r\n    prev() {\r\n        return this._to(this._taskData.index - 1);\r\n    }\r\n    /**\r\n     * Change the current task to the next task.\r\n     */\r\n    next() {\r\n        return this._to(this._taskData.index + 1);\r\n    }\r\n    /**\r\n     * Change the current task to the specified task.\r\n     */\r\n    to(index) {\r\n        return this._to(index);\r\n    }\r\n    /**\r\n     * Skips all tasks and changes to the finished state.\r\n     */\r\n    finish() {\r\n        this._taskData.index = -1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Cancel all task and leave them unregistered.\r\n     */\r\n    reset() {\r\n        this._taskData.callbacks = [];\r\n        this._taskData.index = -1;\r\n        this._taskData.value = null;\r\n        return this;\r\n    }\r\n    /**\r\n     * Destroy instance.\r\n     */\r\n    destroy() {\r\n        this.reset();\r\n    }\r\n    /**\r\n     * The value returned by the last task executed.\r\n     */\r\n    get value() {\r\n        return this._taskData.value;\r\n    }\r\n}\n\nexport { Task };\n//# sourceMappingURL=Task.esm.js.map\n","import * as THREE from 'three';\r\nimport { Emitter } from '@tawaship/emitter';\r\nimport { Task } from '@tawaship/task';\r\n\r\nexport interface ITickerData {\r\n\tdelta: number;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _box = new THREE.Box3();\r\n\r\nexport abstract class DisplayObject<T extends THREE.Object3D = THREE.Object3D> extends Emitter {\r\n\tprotected _three: T;\r\n\tprotected _sub: T;\r\n\tprotected _size: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _pivot: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _children: DisplayObject[] = [];\r\n\tprotected _task: Task;\r\n\t\r\n\tinteractive: boolean = false;\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._three = this._sub = three;\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerdown', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerup', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointermove', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerupoutside', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthis._task = new Task([], this);\r\n\t\tthis._task.first();\r\n\t}\r\n\t\r\n\tget three() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget task() {\r\n\t\treturn this._task;\r\n\t}\r\n\t\r\n\tget parent(): DisplayObject | null {\r\n\t\treturn this._three.userData.parent;\r\n\t}\r\n\t\r\n\tget children() {\r\n\t\treturn this._children;\r\n\t}\r\n\t\r\n\tupdateTask(e: ITickerData) {\r\n\t\tthis._task.done(e);\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.y;\r\n\t}\r\n\t\r\n\tget depth() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.z * this.scale.z;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._three.position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._three.position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._three.position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._three.position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._three.position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._three.position.z = value;\r\n\t}\r\n\t\r\n\t/*\r\n\tget position() {\r\n\t\treturn this._three.position;\r\n\t}\r\n\t*/\r\n\t\r\n\tget scale() {\r\n\t\treturn this._three.scale;\r\n\t}\r\n\t\r\n\tget pivot() {\r\n\t\treturn this._pivot;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTransform();\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\tabstract updateTransform(): void;\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis.updateTransform();\r\n\t\t\r\n\t\t_box.setFromObject(this._sub);\r\n\t\t_box.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\taddChild(object: DisplayObject) {\r\n\t\tif (object.parent) {\r\n\t\t\tobject.parent.removeChild(object);\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.push(object);\r\n\t\tthis._sub.add(object.three);\r\n\t\tobject.three.userData.parent = this;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: DisplayObject) {\r\n\t\tif (object.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._children.indexOf(object);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.splice(index, 1);\r\n\t\tthis._sub.remove(object.three);\r\n\t\tobject.three.userData.parent = null;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object3D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tget rotation() {\r\n\t\treturn this._three.rotation;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { IRect } from './Application';\r\n\r\nexport class Camera extends Object3D<THREE.Camera> {\r\n\tprivate _viewport: IRect;\r\n\t\r\n\tconstructor(camera: THREE.Camera, viewport: IRect) {\r\n\t\tsuper(camera);\r\n\t\t\r\n\t\tthis._viewport = viewport;\r\n\t}\r\n\t\r\n\tget camera() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget viewport() {\r\n\t\treturn this._viewport;\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer, scene: THREE.Scene) {\r\n\t\trenderer.setViewport(this._viewport.x, this._viewport.y, this._viewport.width, this._viewport.height);\r\n\t\trenderer.render(scene, this._three);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object2D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tprotected _skew: THREE.Vector2 = new THREE.Vector2();\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthree.matrixAutoUpdate = false;\r\n\t}\r\n\t\r\n\tget skew() {\r\n\t\treturn this._skew;\r\n\t}\r\n\t\r\n\tget rotation() {\r\n\t\treturn this._three.rotation.z;\r\n\t}\r\n\t\r\n\tset rotation(value) {\r\n\t\tthis._three.rotation.z = value;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._updateMatrix();\r\n\t}\r\n\t\r\n\t_updateMatrix() {\r\n\t\tconst x = this.x;\r\n\t\tconst y = this.y;\r\n\t\tconst z = this._three.position.z;\r\n\t\tconst scaleX = this.scale.x;\r\n\t\tconst scaleY = this.scale.y;\r\n\t\tconst skewX = this.skew.x;\r\n\t\tconst skewY = this.skew.y;\r\n\t\tconst rotation = this.rotation;\r\n\t\tconst pivotX = this.pivot.x;\r\n\t\tconst pivotY = this.pivot.y;\r\n\t\t\r\n\t\tconst a = Math.cos(rotation + skewY) * scaleX;\r\n\t\tconst b = Math.sin(rotation + skewY) * scaleX;\r\n\t\tconst c = -Math.sin(rotation - skewX) * scaleY;\r\n\t\tconst d = Math.cos(rotation - skewX) * scaleY;\r\n\t\tconst tx = x - ((pivotX * a) + (pivotY * c));\r\n\t\tconst ty = y - ((pivotX * b) + (pivotY * d));\r\n\t\t\r\n\t\tthis._three.matrix.set(\r\n\t\t\ta, c, 0, tx, \r\n\t\t\tb, d, 0, ty,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\t\t);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\n\r\nexport class Container2D extends Object2D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\t_updateOrder() {\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].three.position.z = i * 0.0000001;\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.remove(this._sub);\r\n\t\tfor (let i = 0; i < this._children.length; i++) {\r\n\t\t\tthis._children[i].updateTransform();\r\n\t\t}\r\n\t\tsuper.updateBoundingBox();\r\n\t\tthis._three.add(this._sub)\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\n\r\nexport class Container3D extends Object3D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._sub.position.x = -this._pivot.x;\r\n\t\tthis._sub.position.y = -this._pivot.y;\r\n\t\tthis._sub.position.z = -this._pivot.z;\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.remove(this._sub);\r\n\t\tsuper.updateBoundingBox();\r\n\t\tthis._three.add(this._sub)\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { GLTFLoader, GLTF } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { View } from './View';\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolvePath(path: string, basepath: string) {\r\n\tif (path.indexOf('http://') === 0 || path.indexOf('https://') === 0 || path.indexOf('//') === 0 || path.indexOf('/') === 0) {\r\n\t\treturn path;\r\n\t} else {\r\n\t\treturn basepath.replace(/^(.+)\\/$/, '$1') + '/' + path;\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolveVersion(url: string, version: string) {\r\n\tif (!version) {\r\n\t\treturn url;\r\n\t}\r\n\t\r\n\treturn `${url}${url.match(/\\?/) ? '&' : '?'}_fv=${version}`;\r\n}\r\n\r\nexport interface IAssetDefinitionDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface IAssetDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface ITextureDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface ITextureDictionary extends IAssetDictionary<THREE.Texture> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadTexturesAsync(data: ITextureDefinitionDictionary, basepath: string, version: string): Promise<ITextureDictionary> {\r\n\tconst loader = new THREE.TextureLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst textures: ITextureDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, texture => {\r\n\t\t\t\t\ttextures[i] = texture;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => textures);\r\n}\r\n\r\nexport interface IGLTFDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface IGLTFDictionary extends IAssetDictionary<GLTF> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadGLTFsAsync(data: IGLTFDefinitionDictionary, basepath: string, version: string): Promise<IGLTFDictionary> {\r\n\tconst loader = new GLTFLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst models: IGLTFDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, model => {\r\n\t\t\t\t\tmodels[i] = model;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => models);\r\n}\r\n\r\nexport interface IAssetLoaderDelegate<T> {\r\n\t(data: { [key: string]: any }, basepath: string, version: string): Promise<IAssetDictionary<T>>;\r\n}\r\n\r\nexport interface IResourceDictionary {\r\n\t[key: string]: IAssetDictionary<any>;\r\n}\r\n\r\nexport interface IVariableDictionary {\r\n\t[key: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _assetLoaders: { [key: string]: IAssetLoaderDelegate<any> } = {};\r\n\r\nexport class Content {\r\n\tprivate _assetDefines: { [ley: string]: IAssetDictionary<any> } = {};\r\n\tprivate _viewClasses: typeof View[] = [];\r\n\tprivate _vars: IVariableDictionary = {};\r\n\t\r\n\tget viewClasses() {\r\n\t\treturn this._viewClasses;\r\n\t}\r\n\t\r\n\tget vars() {\r\n\t\treturn Object.assign({}, this._vars);\r\n\t}\r\n\t\r\n\tdefineViews(viewClasses: typeof View | typeof View[]) {\r\n\t\tif (!Array.isArray(viewClasses)) {\r\n\t\t\tviewClasses = [ viewClasses ];\r\n\t\t}\r\n\t\t\r\n\t\tviewClasses.forEach(viewClass => {\r\n\t\t\tthis._viewClasses.push(viewClass);\r\n\t\t});\r\n\t}\r\n\t\r\n\tdefineAssets<T>(key: string, data: IAssetDefinitionDictionary<T>) {\r\n\t\tthis._assetDefines[key] = this._assetDefines[key] || {};\r\n\t\t\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._assetDefines[key][i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tdefineTextures(data: ITextureDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('textures', data);\r\n\t}\r\n\t\r\n\tdefineGLBs(data: IGLTFDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('glbs', data);\r\n\t}\r\n\t\r\n\tloadAssetsAsync(basepath: string, version: string) {\r\n\t\tconst promises: Promise<IAssetDictionary<any>>[] = [];\r\n\t\tconst resources: IResourceDictionary = {};\r\n\t\t\r\n\t\tfor (let i in this._assetDefines) {\r\n\t\t\tif (!(i in _assetLoaders)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpromises.push(\r\n\t\t\t\t_assetLoaders[i](this._assetDefines[i], basepath, version)\r\n\t\t\t\t\t.then((assets: IAssetDictionary<any>) => {\r\n\t\t\t\t\t\treturn resources[i] = assets;\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises).then(() => resources);\r\n\t}\r\n\t\r\n\tdefineVars(data: IVariableDictionary) {\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._vars[i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic registerLoader<T>(key: string, delegate: IAssetLoaderDelegate<T>) {\r\n\t\t_assetLoaders[key] = delegate;\r\n\t}\r\n}\r\n\r\nContent.registerLoader<THREE.Texture>('textures', loadTexturesAsync);\r\nContent.registerLoader<GLTF>('glbs', loadGLTFsAsync);","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Mesh extends Object3D<THREE.Mesh> implements IMesh {\r\n\tprivate _anchor: Anchor;\r\n\t\r\n\tconstructor(geometry: THREE.BufferGeometry, material: THREE.Material) {\r\n\t\tsuper(new THREE.Mesh(geometry, material));\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\tmaterial.transparent = true;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis.updateBoundingBox();\r\n\t\tthis._three.geometry.translate(this._size.x * (0.5 - this._anchor.x), this._size.y * (0.5 - this._anchor.y), this._size.z * (0.5 - this._anchor.z))\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport OIMO from './OIMO';\r\nimport { BodyPosition } from './BodyPosition';\r\nimport { BodyRotation } from './BodyRotation';\r\n\r\nexport class PhysicsObject3D extends Object3D<THREE.Object3D> {\r\n\tprotected _body: OIMO.RigidBody;\r\n\tprotected _contactEnabled: boolean = false;\r\n\tprotected _position: BodyPosition;\r\n\tprotected _rotation: BodyRotation;\r\n\t\r\n\tconstructor(three: THREE.Object3D, body: OIMO.RigidBody) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthis._body = body;\r\n\t\tthis._position = new BodyPosition(this);\r\n\t\tthis._rotation = new BodyRotation(this);\r\n\t\t\r\n\t\tbody.userData.ref = this;\r\n\t}\r\n\t\r\n\tget body() {\r\n\t\treturn this._body;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._position.z = value;\r\n\t}\r\n\t\r\n\tget position() {\r\n\t\treturn this._position;\r\n\t}\r\n\t\r\n\t// @ts-ignore\r\n\tget rotation() {\r\n\t\treturn this._rotation;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._three.position.copy(this._body.getPosition());\r\n\t\tthis._three.quaternion.copy(this._body.getOrientation());\r\n\t}\r\n\t\r\n\tsetCollisionGroup(collisionGroup: number) {\r\n\t\tthis._body.setCollisionGroup(collisionGroup);\r\n\t}\r\n\t\r\n\taddCollisionGroup(collisionGroup: number) {\r\n\t\tthis._body.addCollisionGroup(collisionGroup);\r\n\t}\r\n\t\r\n\tremoveCollisionGroup(collisionGroup: number) {\r\n\t\tthis._body.removeCollisionGroup(collisionGroup);\r\n\t}\r\n\t\r\n\tsetCollisionMask(collisionMask: number) {\r\n\t\tthis._body.setCollisionMask(collisionMask);\r\n\t}\r\n\t\r\n\taddCollisionMask(collisionMask: number) {\r\n\t\tthis._body.addCollisionMask(collisionMask);\r\n\t}\r\n\t\r\n\tremoveCollisionMask(collisionMask: number) {\r\n\t\tthis._body.removeCollisionMask(collisionMask);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Camera } from './Camera';\r\nimport { IInteractionEvent } from './InteractionManager';\r\nimport { ITickerData } from './DisplayObject';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport class View extends Object3D<THREE.Scene> {\r\n\tprivate _cameras: Camera[] = [];\r\n\t\r\n\tconstructor($?: IDeliverData) {\r\n\t\tsuper(new THREE.Scene());\r\n\t\t\r\n\t\tthis.interactive = true;\r\n\t}\r\n\t\r\n\tget scene() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\taddCamera(camera: Camera) {\r\n\t\tif (camera.parent) {\r\n\t\t\tcamera.parent.removeChild(camera);\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.push(camera);\r\n\t\tthis._three.add(camera.three);\r\n\t\tcamera.three.userData.parent = this;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tremoveCamera(camera: Camera) {\r\n\t\tif (camera.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._cameras.indexOf(camera);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.splice(index, 1);\r\n\t\tthis._three.remove(camera.three);\r\n\t\tcamera.three.userData.parent = null;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tadd(three: THREE.Object3D) {\r\n\t\tthis._three.add(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tremove(three: THREE.Object3D) {\r\n\t\tthis._three.remove(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer) {\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\trenderer.clearDepth();\r\n\t\t\tc[i].render(renderer, this._three);\r\n\t\t}\r\n\t}\r\n\t\r\n\tonInteraction(event: IInteractionEvent, raycaster: THREE.Raycaster, mouse: THREE.Vector2) {\r\n\t\tif (!this.interactive) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\traycaster.setFromCamera(mouse, c[i].camera);\r\n\t\t\t\r\n\t\t\tconst f: (p: THREE.Object3D) => THREE.Object3D[] = (p: THREE.Object3D) => {\r\n\t\t\t\treturn p.children.map(p => {\r\n\t\t\t\t\tif (p instanceof THREE.Mesh) {\r\n\t\t\t\t\t\treturn p;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn f(p);\r\n\t\t\t\t}).flat();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst meshes = f(this._three);\r\n\t\t\t\r\n\t\t\tconst intersects = raycaster.intersectObjects(meshes);\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < intersects.length; i++) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet p = intersects[i].object;\r\n\t\t\t\twhile (p !== this._three) {\r\n\t\t\t\t\tp.dispatchEvent(event);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!p.parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tp = p.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n}\r\n","declare namespace OIMO {\r\n\tclass CommonConstructor {\r\n\t\tconstructor(...args: any[]);\r\n\t\t[key: string]: any;\r\n\t}\r\n\t\r\n\texport class World extends CommonConstructor {}\r\n\t\r\n\texport class RigidBody extends CommonConstructor {}\r\n\t\r\n\texport class RigidBodyConfig extends CommonConstructor {}\r\n\t\r\n\texport class Shape extends CommonConstructor {}\r\n\t\r\n\texport class ShapeConfig extends CommonConstructor {}\r\n\t\r\n\texport class ContactCallback extends CommonConstructor {}\r\n\t\r\n\texport class AabbTestCallback extends CommonConstructor {}\r\n\t\r\n\texport class Vec3 extends CommonConstructor {}\r\n\t\r\n\texport namespace RigidBodyType {\r\n\t\texport const STATIC: number;\r\n\t\texport const DYNAMIC: number;\r\n\t\texport const KINEMATIC: number;\r\n\t}\r\n}\r\n\r\nexport default OIMO;","import * as THREE from 'three';\r\nimport { View } from './View';\r\nimport { ITickerData } from './DisplayObject';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { Shape, SensoredShape } from './Shape';\r\nimport OIMO from './OIMO';\r\n\r\nexport class PhysicsView extends View {\r\n\tprivate _world: any;\r\n\tprivate _sensoredShapes: SensoredShape[] = [];\r\n\tprivate _onShapeAdded: (shape: SensoredShape) => void;\r\n\tprivate _onShapeRemoved: (shape: SensoredShape) => void;\r\n\tdeclare protected _children: PhysicsObject3D[];\r\n\tphysicsEnabled: boolean = true;\r\n\t\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._world = new OIMO.World();\r\n\t\tthis._world.setGravity(new OIMO.Vec3(0, -9.8, 0));\r\n\t\t\r\n\t\tthis._onShapeAdded = (shape: SensoredShape) => {\r\n\t\t\tconst index = this._sensoredShapes.indexOf(shape);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tthis._sensoredShapes.push(shape);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._onShapeRemoved = (shape: SensoredShape) => {\r\n\t\t\tconst index = this._sensoredShapes.indexOf(shape);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tthis._sensoredShapes.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tget world() {\r\n\t\treturn this._world;\r\n\t}\r\n\t\r\n\tget children() {\r\n\t\treturn this._children;\r\n\t}\r\n\t\r\n\taddChild(object: PhysicsObject3D) {\r\n\t\tsuper.addChild(object);\r\n\t\t\r\n\t\tthis._world.addRigidBody(object.body);\r\n\t\t\r\n\t\tconst sensoredShapes = object.body.getSensoredShapeList();\r\n\t\tfor (let i = 0; i < sensoredShapes.length; i++) {\r\n\t\t\tthis._onShapeAdded(sensoredShapes[i]);\r\n\t\t}\r\n\t\t\r\n\t\tobject.body.on('sensoredShapeAdded', this._onShapeAdded);\r\n\t\tobject.body.on('sensoredShapeRemoved', this._onShapeRemoved);\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: PhysicsObject3D) {\r\n\t\tconst o = super.removeChild(object);\r\n\t\t\r\n\t\tif (!o) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._world.removeRigidBody(object.body);\r\n\t\t\r\n\t\tconst sensoredShapes = object.body.getSensoredShapeList();\r\n\t\tfor (let i = 0; i < sensoredShapes.length; i++) {\r\n\t\t\tthis._onShapeRemoved(sensoredShapes[i]);\r\n\t\t}\r\n\t\t\r\n\t\tobject.body.off('sensoredShapeAdded', this._onShapeAdded);\r\n\t\tobject.body.off('sensoredShapeRemoved', this._onShapeRemoved);\r\n\t\t\r\n\t\treturn o;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tif (this.physicsEnabled) {\r\n\t\t\tthis._world.step(1 / 60);\r\n\t\t\t\r\n\t\t\t/*\r\n\t\t\tlet body = this._world.getRigidBodyList();\r\n\t\t\twhile (body) {\r\n\t\t\t\tconst object = body.userData.ref;\r\n\t\t\t\tif (object.sensorEnabled) {\r\n\t\t\t\t\tobject.aabbTest(this._world);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tbody = body.getNext();\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < this._sensoredShapes.length; i++) {\r\n\t\t\t\tthis._sensoredShapes[i].aabbTest(this._world);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n}\r\n","import OIMO from './OIMO';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { RigidBody } from './RigidBody';\r\nimport { Emitter, IEmitterDelegate } from '@tawaship/emitter';\r\n\r\nexport interface IContactData {\r\n\thit: Shape;\r\n\toriginalEvent: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst contactCallback = new OIMO.ContactCallback();\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction contactHandler(type: string, e: any) {\r\n\tconst selfShape: Shape = e.getShape1();\r\n\tconst opponentShape: Shape = e.getShape2();\r\n\t\r\n\tevent.originalEvent = e;\r\n\tevent.hit = opponentShape;\r\n\tselfShape.emit(type, event);\r\n}\r\n\r\ncontactCallback.beginContact = (e: any) => {\r\n\tcontactHandler('beginContact', e);\r\n};\r\ncontactCallback.endContact = (e: any) => {\r\n\tcontactHandler('endContact', e);\r\n};\r\ncontactCallback.preSolve = (e: any) => {\r\n\tcontactHandler('preSolve', e);\r\n};\r\ncontactCallback.postSolve = (e: any) => {\r\n\tcontactHandler('postSolve', e);\r\n};\r\n\r\nexport class Shape extends OIMO.Shape {\r\n\tprotected _collisionGroup: number;\r\n\tprotected _collisionMask: number;\r\n\tprotected _collisionEnabled: boolean = true;\r\n\tprotected _contactEnabled: boolean = false;\r\n\tprivate _emitter: Emitter = new Emitter();\r\n\t\r\n\tconstructor(shapeConfig: OIMO.ShapeConfig) {\r\n\t\tsuper(shapeConfig);\r\n\t\t\r\n\t\tthis._collisionGroup = this.getCollisionGroup();\r\n\t\tthis._collisionMask = this.getCollisionMask();\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\ton(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.on(type, callback);\r\n\t}\r\n\t\r\n\toff(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.off(type, callback);\r\n\t}\r\n\t\r\n\temit(type: string, ...args: any[]) {\r\n\t\tthis._emitter.cemit(type, this, ...args);\r\n\t}\r\n\t\r\n\tget collisionGroup() {\r\n\t\treturn this._collisionGroup;\r\n\t}\r\n\t\r\n\tget collisionMask() {\r\n\t\treturn this._collisionMask;\r\n\t}\r\n\t\r\n\tget collisionEnabled() {\r\n\t\treturn this._collisionEnabled;\r\n\t}\r\n\t\r\n\tset collisionEnabled(value: boolean) {\r\n\t\tthis._collisionEnabled = value;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tget contectEnabled() {\r\n\t\treturn this._contactEnabled;\r\n\t}\r\n\t\r\n\tset contactEnabled(value: boolean) {\r\n\t\tthis._contactEnabled = value;\r\n\t\t\r\n\t\tif (value) {\r\n\t\t\tthis.setContactCallback(contactCallback);\r\n\t\t} else {\r\n\t\t\tthis.setContactCallback(null);\r\n\t\t}\r\n\t}\r\n\t\r\n\tsetCollisionGroup(collisionGroup: number) {\r\n\t\tthis._collisionGroup = collisionGroup;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t}\r\n\t\r\n\taddCollisionGroup(collisionGroup: number) {\r\n\t\tthis._collisionGroup |= collisionGroup;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t}\r\n\t\r\n\tremoveCollisionGroup(collisionGroup: number) {\r\n\t\tthis._collisionGroup ^= this._collisionGroup & collisionGroup;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t}\r\n\t\r\n\tsetCollisionMask(collisionMask: number) {\r\n\t\tthis._collisionMask = collisionMask;\r\n\t\t\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\taddCollisionMask(collisionMask: number) {\r\n\t\tthis._collisionMask |= collisionMask;\r\n\t\t\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tremoveCollisionMask(collisionMask: number) {\r\n\t\tthis._collisionMask ^= this._collisionMask & collisionMask;\r\n\t\t\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tprotected _setCollisionGroup(collisionGroup: number) {\r\n\t\tsuper.setCollisionGroup(collisionGroup);\r\n\t}\r\n\t\r\n\tprotected _setCollisionMask(collisionMask: number) {\r\n\t\tsuper.setCollisionMask(collisionMask);\r\n\t}\r\n\t\r\n\tprotected _updateCollisionGroup() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionGroup);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionMask() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionMask);\r\n\t\t}\r\n\t}\r\n\t\r\n\tgetObject() {\r\n\t\tconst body = this.getRigidBody();\r\n\t\tif (!body) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\treturn body.getObject();\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst event: IContactData = { hit: new Shape(new OIMO.ShapeConfig()), originalEvent: null };\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction sensorHandler(type: string, selfShape: SensoredShape, opponentShape: Shape) {\r\n\tevent.originalEvent = null;\r\n\tevent.hit = opponentShape;\r\n\tselfShape.emit(type, event);\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction getObject(shape: SensoredShape) {\r\n\tconst body = shape.getRigidBody();\r\n\tif (!body) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\treturn body.getObject();\r\n}\r\n\r\nexport class SensoredShape extends Shape {\r\n\tprivate _sensorEnabled: boolean = true;\r\n\tprotected _aabbTestCallback: OIMO.AabbTestCallback = new OIMO.AabbTestCallback();\r\n\tprotected _touchedShapes: Shape[] = [];\r\n\tprotected _touchShapes: Shape[] = [];\r\n\t\r\n\tconstructor(shapeConfig: OIMO.ShapeConfig) {\r\n\t\tsuper(shapeConfig);\r\n\t\t\r\n\t\tthis.contactEnabled = true;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t\t\r\n\t\tthis._aabbTestCallback.process = (shape: Shape) => {\r\n\t\t\tif ((this._collisionMask & shape.collisionGroup) === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif ((this._collisionGroup & shape.collisionMask) === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst index = this._touchedShapes.indexOf(shape);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tsensorHandler('beginContact', this, shape);\r\n\t\t\t} else {\r\n\t\t\t\tthis._touchedShapes.splice(index, 1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._touchShapes.push(shape);\r\n\t\t};\r\n\t}\r\n\t\r\n\tget sensorEnabled() {\r\n\t\treturn this._sensorEnabled;\r\n\t}\r\n\t\r\n\tset sensorEnabled(value: boolean) {\r\n\t\tthis._sensorEnabled = value;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tget isSensor() {\r\n\t\treturn this._collisionEnabled && this._contactEnabled && this._sensorEnabled;\r\n\t}\r\n\t\r\n\taabbTest(world: OIMO.World) {\r\n\t\tif (!this.isSensor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._touchedShapes = this._touchShapes;\r\n\t\tthis._touchShapes = [];\r\n\t\t\r\n\t\tworld.aabbTest(this.getAabb(), this._aabbTestCallback);\r\n\t\t\r\n\t\tfor (let i = 0; i < this._touchedShapes.length; i++) {\r\n\t\t\tsensorHandler('endContact', this, this._touchedShapes[i]);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionGroup() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else if (this._sensorEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionGroup(this._collisionGroup);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionMask() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else if (this._sensorEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionMask);\r\n\t\t}\r\n\t}\r\n}","import OIMO from './OIMO';\r\nimport { Shape, SensoredShape } from './Shape';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { Emitter, IEmitterDelegate } from '@tawaship/emitter';\r\n\r\nexport class RigidBody extends OIMO.RigidBody {\r\n\tprivate _emitter: Emitter = new Emitter();\r\n\t\r\n\tdeclare userData: { ref: PhysicsObject3D | null };\r\n\t\r\n\tconstructor(rigidBodyConfig: OIMO.RigidBodyConfig) {\r\n\t\tsuper(rigidBodyConfig);\r\n\t\t\r\n\t\tthis.userData = { ref: null };\r\n\t}\r\n\t\r\n\tgetObject(): PhysicsObject3D | null {\r\n\t\treturn this.userData.ref;\r\n\t}\r\n\t\r\n\ton(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.on(type, callback);\r\n\t}\r\n\t\r\n\toff(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.off(type, callback);\r\n\t}\r\n\t\r\n\temit(type: string, ...args: any[]) {\r\n\t\tthis._emitter.cemit(type, this, ...args);\r\n\t}\r\n\t\r\n\tgetSensoredShapeList(): SensoredShape[] {\r\n\t\tconst res: SensoredShape[] = [];\r\n\t\t\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tif (shape instanceof SensoredShape) {\r\n\t\t\t\tres.push(shape);\r\n\t\t\t}\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t\t\r\n\t\treturn res;\r\n\t}\r\n\t\r\n\taddShape(shape: Shape | SensoredShape) {\r\n\t\tsuper.addShape(shape);\r\n\t\t\r\n\t\tif (shape instanceof SensoredShape) {\r\n\t\t\tthis.emit('sensoredShapeAdded', shape);\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveShape(shape: Shape | SensoredShape) {\r\n\t\tsuper.removeShape(shape);\r\n\t\t\r\n\t\tif (shape instanceof SensoredShape) {\r\n\t\t\tthis.emit('sensoredShapeRemoved', shape);\r\n\t\t}\r\n\t}\r\n\t\r\n\tsetCollisionGroup(collisionGroup: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tshape.setCollisionGroup(collisionGroup);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\taddCollisionGroup(collisionGroup: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tlet t = shape.getCollisionGroup();\r\n\t\t\tt |= collisionGroup;\r\n\t\t\tshape.setCollisionGroup(t);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveCollisionGroup(collisionGroup: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tlet t = shape.getCollisionGroup();\r\n\t\t\tt ^= t & collisionGroup;\r\n\t\t\tshape.setCollisionGroup(t);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tsetCollisionMask(collisionMask: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tshape.setCollisionMask(collisionMask);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\taddCollisionMask(collisionMask: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tlet t = shape.getCollisionMask();\r\n\t\t\tt |= collisionMask;\r\n\t\t\tshape.setCollisionMask(t);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveCollisionMask(collisionMask: number) {\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tlet t = shape.getCollisionMask();\r\n\t\t\tt ^= t & collisionMask;\r\n\t\t\tshape.setCollisionMask(t);\r\n\t\t\t\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic createStatic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.STATIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n\t\r\n\tstatic createDynamic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.DYNAMIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n\t\r\n\tstatic createKinematic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.KINEMATIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Sprite extends Object2D<THREE.Mesh> implements IMesh {\r\n\tprivate _texture: THREE.Texture;\r\n\tprivate _anchor: Anchor;\r\n\tprivate _material: THREE.MeshBasicMaterial;\r\n\tprivate _width: number = 0;\r\n\tprivate _height: number = 0;\r\n\t\r\n\tconstructor(texture: THREE.Texture) {\r\n\t\tsuper(new THREE.Mesh());\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\t\r\n\t\tthis._material = new THREE.MeshBasicMaterial();\r\n\t\tthis._material.transparent = true;\r\n\t\t\r\n\t\tthis._three.material = this._material;\r\n\t\t\r\n\t\tthis._texture = texture;\r\n\t\tthis.texture = texture;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this._texture;\r\n\t}\r\n\t\r\n\tset texture(texture) {\r\n\t\tthis._texture = texture;\r\n\t\tthis._material.needsUpdate = true;\r\n\t\tthis._material.map = texture;\r\n\t\t\r\n\t\tif (texture && texture.image) {\r\n\t\t\tthis._updateGeometry(texture.image.width, texture.image.height);\r\n\t\t} else {\r\n\t\t\tthis._updateGeometry(0, 0);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\t_updateGeometry(width: number, height: number) {\r\n\t\tthis._three.geometry = new THREE.PlaneGeometry(width, height);\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis._three.geometry.translate(this._width * (0.5 - this._anchor.x), this._height * (0.5 - this._anchor.y), 0)\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\tstatic from(url: string, callback: (sprite: Sprite) => void) {\r\n\t\tconst sprite = new Sprite(new THREE.TextureLoader().load(url, texture => {\r\n\t\t\tsprite.texture = texture;\r\n\t\t\tcallback && callback(sprite);\r\n\t\t}));\r\n\t\t\r\n\t\treturn sprite;\r\n\t}\r\n}"],"names":["Anchor","x","y","z","mesh","this","_x","_y","_z","_mesh","prototypeAccessors","value","updateGeometryPosition","set","undefined","appleIphone","appleIpod","appleTablet","appleUniversal","androidPhone","androidTablet","amazonPhone","amazonTablet","windowsPhone","windowsTablet","otherBlackBerry","otherBlackBerry10","otherOpera","otherChrome","otherFirefox","isAppleTabletOnIos13","navigator","platform","maxTouchPoints","MSStream","Emitter","_events","_on","type","callback","once","const","events","i","length","push","on","off","splice","_emit","context","targets","event","let","apply","args","emit","cemit","_emitAll","emitAll","cemitAll","clear","isSP","param","nav","userAgent","tmp","split","match","regex","test","createMatch","result","apple","phone","ipod","tablet","universal","device","amazon","android","windows","other","blackberry","blackberry10","opera","firefox","chrome","any","isMobile","separate","_first","_emitted","first","concat","emitted","both","p","index","indexOf","dispatch","InteractionManager","THREE.Vector2","originalEvent","_cast","e","width","height","_event","_mouse","onDown","_down","interactive","interactiveDown","onMove","interactiveMove","_over","saparated","onUp","interactiveUp","addCanvas","canvas","addEventListener","touches","clientX","offsetLeft","clientY","offsetTop","offsetWidth","offsetHeight","changedTouches","offsetX","offsetY","Application","options","container","document","body","rendererOptions","alpha","transparent","antialias","renderer","THREE.WebGLRenderer","resolution","backgroundColor","autoAdjust","basepath","version","setClearColor","setSize","setPixelRatio","autoClear","_container","_renderer","_rendererSize","_basepath","_version","domElement","style","position","raycaster","THREE.Raycaster","_interactionManager","mouse","c","_views","onInteraction","window","_lastTime","timeStamp","step","timestamp","delta","_playing","update","requestAnimationFrame","autoAdjuster","fullScreen","attachAsync","content","loadAssetsAsync","then","resources","vars","$","viewClasses","addView","interactionManager","element","view","removeView","play","appendChild","start","stop","render","setViewport","_autoAdjuster","removeEventListener","rect","r","innerWidth","innerHeight","adjustHeight","toCenter","toTop","adjustWidth","toMiddle","toLeft","w","h","horizontal","hol","left","_getViewRect","toRight","vertical","ver","top","toBottom","parseInt","replace","BodyPosition","object","_object","getPosition","setPosition","updateTransform","BodyRotation","getRotation","toEulerXyz","rotation","setRotationXyz","Task","callbacks","_taskData","enabled","add","Array","isArray","list","Function","done","task","_to","Number","prev","next","to","finish","reset","destroy","_box","THREE.Box3","DisplayObject","three","super","THREE.Vector3","_three","_sub","_task","parent","userData","children","_children","updateTask","updateBoundingBox","_size","depth","scale","pivot","_pivot","setFromObject","getSize","multiply","addChild","removeChild","remove","Object3D","Camera","camera","viewport","_viewport","scene","Object2D","matrixAutoUpdate","skew","_skew","_updateMatrix","scaleX","scaleY","skewX","skewY","pivotX","pivotY","a","Math","cos","b","sin","d","tx","ty","matrix","Container2D","THREE.Group","_updateOrder","Container3D","resolvePath","path","resolveVersion","url","_assetLoaders","Content","_viewClasses","Object","assign","_vars","defineViews","forEach","viewClass","defineAssets","key","data","_assetDefines","defineTextures","defineGLBs","promises","assets","Promise","all","defineVars","registerLoader","delegate","loader","THREE.TextureLoader","textures","resolve","reject","load","texture","GLTFLoader","models","model","Mesh","geometry","material","THREE.Mesh","_anchor","anchor","center","translate","computeBoundingBox","boundingBox","PhysicsObject3D","_body","_position","_rotation","ref","copy","quaternion","getOrientation","setCollisionGroup","collisionGroup","addCollisionGroup","removeCollisionGroup","setCollisionMask","collisionMask","addCollisionMask","removeCollisionMask","View","THREE.Scene","addCamera","_cameras","removeCamera","clearDepth","setFromCamera","f","map","flat","meshes","intersects","intersectObjects","dispatchEvent","OIMO","PhysicsView","_world","World","setGravity","Vec3","_onShapeAdded","shape","_sensoredShapes","_onShapeRemoved","world","addRigidBody","sensoredShapes","getSensoredShapeList","o","removeRigidBody","physicsEnabled","aabbTest","contactCallback","ContactCallback","contactHandler","selfShape","getShape1","opponentShape","getShape2","hit","beginContact","endContact","preSolve","postSolve","Shape","shapeConfig","_collisionGroup","getCollisionGroup","_collisionMask","getCollisionMask","_updateCollisionGroup","_updateCollisionMask","_emitter","collisionEnabled","_collisionEnabled","contectEnabled","_contactEnabled","contactEnabled","setContactCallback","_setCollisionGroup","_setCollisionMask","getObject","getRigidBody","ShapeConfig","sensorHandler","SensoredShape","AabbTestCallback","_aabbTestCallback","process","_touchedShapes","_touchShapes","prototypeAccessors$1","sensorEnabled","_sensorEnabled","isSensor","getAabb","RigidBody","rigidBodyConfig","res","getShapeList","getNext","addShape","removeShape","t","createStatic","RigidBodyConfig","RigidBodyType","STATIC","createDynamic","DYNAMIC","createKinematic","KINEMATIC","Sprite","_material","THREE.MeshBasicMaterial","_texture","needsUpdate","image","_updateGeometry","THREE.PlaneGeometry","_width","_height","from","sprite"],"mappings":"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"}
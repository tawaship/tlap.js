{"version":3,"file":"tlap.js","sources":["../src/Anchor.ts","../node_modules/ismobilejs/esm/isMobile.js","../src/Application.ts","../src/BodyPosition.ts","../src/BodyRotation.ts","../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../node_modules/@tawaship/task/dist/Task.esm.js","../src/DisplayObject.ts","../src/Object3D.ts","../src/Camera.ts","../src/Object2D.ts","../src/Container2D.ts","../src/Container3D.ts","../src/Content.ts","../src/Mesh.ts","../src/PhysicsObject3D.ts","../src/View.ts","../src/OIMO.ts","../src/PhysicsView.ts","../src/Shape.ts","../src/RigidBody.ts","../src/Sprite.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport { IMesh } from './IMesh';\r\n\r\nexport class Anchor {\r\n\tprivate _x: number;\r\n\tprivate _y: number;\r\n\tprivate _z: number;\r\n\tprivate _mesh: IMesh;\r\n\t\r\n\tconstructor(x: number, y: number, z: number, mesh: IMesh) {\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._mesh = mesh;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._x = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._y = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._z = value;\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\t\r\n\t\tthis._mesh.updateGeometryPosition();\r\n\t}\r\n}","var appleIphone = /iPhone/i;\nvar appleIpod = /iPod/i;\nvar appleTablet = /iPad/i;\nvar appleUniversal = /\\biOS-universal(?:.+)Mac\\b/i;\nvar androidPhone = /\\bAndroid(?:.+)Mobile\\b/i;\nvar androidTablet = /Android/i;\nvar amazonPhone = /(?:SD4930UR|\\bSilk(?:.+)Mobile\\b)/i;\nvar amazonTablet = /Silk/i;\nvar windowsPhone = /Windows Phone/i;\nvar windowsTablet = /\\bWindows(?:.+)ARM\\b/i;\nvar otherBlackBerry = /BlackBerry/i;\nvar otherBlackBerry10 = /BB10/i;\nvar otherOpera = /Opera Mini/i;\nvar otherChrome = /\\b(CriOS|Chrome)(?:.+)Mobile/i;\nvar otherFirefox = /Mobile(?:.+)Firefox\\b/i;\nvar isAppleTabletOnIos13 = function (navigator) {\n    return (typeof navigator !== 'undefined' &&\n        navigator.platform === 'MacIntel' &&\n        typeof navigator.maxTouchPoints === 'number' &&\n        navigator.maxTouchPoints > 1 &&\n        typeof MSStream === 'undefined');\n};\nfunction createMatch(userAgent) {\n    return function (regex) { return regex.test(userAgent); };\n}\nexport default function isMobile(param) {\n    var nav = {\n        userAgent: '',\n        platform: '',\n        maxTouchPoints: 0\n    };\n    if (!param && typeof navigator !== 'undefined') {\n        nav = {\n            userAgent: navigator.userAgent,\n            platform: navigator.platform,\n            maxTouchPoints: navigator.maxTouchPoints || 0\n        };\n    }\n    else if (typeof param === 'string') {\n        nav.userAgent = param;\n    }\n    else if (param && param.userAgent) {\n        nav = {\n            userAgent: param.userAgent,\n            platform: param.platform,\n            maxTouchPoints: param.maxTouchPoints || 0\n        };\n    }\n    var userAgent = nav.userAgent;\n    var tmp = userAgent.split('[FBAN');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    tmp = userAgent.split('Twitter');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    var match = createMatch(userAgent);\n    var result = {\n        apple: {\n            phone: match(appleIphone) && !match(windowsPhone),\n            ipod: match(appleIpod),\n            tablet: !match(appleIphone) &&\n                (match(appleTablet) || isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone),\n            universal: match(appleUniversal),\n            device: (match(appleIphone) ||\n                match(appleIpod) ||\n                match(appleTablet) ||\n                match(appleUniversal) ||\n                isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone)\n        },\n        amazon: {\n            phone: match(amazonPhone),\n            tablet: !match(amazonPhone) && match(amazonTablet),\n            device: match(amazonPhone) || match(amazonTablet)\n        },\n        android: {\n            phone: (!match(windowsPhone) && match(amazonPhone)) ||\n                (!match(windowsPhone) && match(androidPhone)),\n            tablet: !match(windowsPhone) &&\n                !match(amazonPhone) &&\n                !match(androidPhone) &&\n                (match(amazonTablet) || match(androidTablet)),\n            device: (!match(windowsPhone) &&\n                (match(amazonPhone) ||\n                    match(amazonTablet) ||\n                    match(androidPhone) ||\n                    match(androidTablet))) ||\n                match(/\\bokhttp\\b/i)\n        },\n        windows: {\n            phone: match(windowsPhone),\n            tablet: match(windowsTablet),\n            device: match(windowsPhone) || match(windowsTablet)\n        },\n        other: {\n            blackberry: match(otherBlackBerry),\n            blackberry10: match(otherBlackBerry10),\n            opera: match(otherOpera),\n            firefox: match(otherFirefox),\n            chrome: match(otherChrome),\n            device: match(otherBlackBerry) ||\n                match(otherBlackBerry10) ||\n                match(otherOpera) ||\n                match(otherFirefox) ||\n                match(otherChrome)\n        },\n        any: false,\n        phone: false,\n        tablet: false\n    };\n    result.any =\n        result.apple.device ||\n            result.android.device ||\n            result.windows.device ||\n            result.other.device;\n    result.phone =\n        result.apple.phone || result.android.phone || result.windows.phone;\n    result.tablet =\n        result.apple.tablet || result.android.tablet || result.windows.tablet;\n    return result;\n}\n//# sourceMappingURL=isMobile.js.map","import * as THREE from 'three';\r\nimport isMobile from 'ismobilejs';\r\nimport { View } from './View';\r\nimport { DisplayObject, IInteractionEvent, ITickerData } from './DisplayObject';\r\nimport { Content } from './Content';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport interface IApplicationOption {\r\n\tcanvas?: HTMLCanvasElement;\r\n\tcontainer?: HTMLElement;\r\n\twidth?: number;\r\n\theight?: number;\r\n\ttransparent?: boolean;\r\n\tresolution?: number;\r\n\tbackgroundColor?: number;\r\n\tantialias?: boolean;\r\n\tautoAdjust?: TAutoAdjust;\r\n\tbasepath?: string;\r\n\tversion?: string;\r\n}\r\n\r\nexport interface IAdjustDelegate {\r\n\t(app: Application): void;\r\n}\r\n\r\nexport type TAutoAdjust = boolean | IAdjustDelegate;\r\n\r\nexport interface IAutoAdjustDelegate {\r\n\t(): void;\r\n}\r\n\r\nexport type TAutoAdjuster = IAutoAdjustDelegate | null;\r\n\r\nexport interface ISize {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IPosition {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport interface IHorizontal {\r\n\tx: number;\r\n\twidth: number;\r\n}\r\n\r\nexport interface IVertical {\r\n\ty: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IRect extends ISize, IPosition {}\r\n\r\nexport class Application {\r\n\tprivate _container: HTMLElement;\r\n\tprivate _renderer: THREE.WebGLRenderer;\r\n\tprivate _views: View[] = [];\r\n\tprivate _lastTime: number = 0;\r\n\tprivate _playing: boolean = false;\r\n\tprivate _rendererSize: THREE.Vector2;\r\n\tprivate _autoAdjuster: TAutoAdjuster = null;\r\n\tprivate _basepath: string = '';\r\n\tprivate _version: string = '';\r\n\t\r\n\tinteractionDown: boolean = true;\r\n\tinteractionMove: boolean = false;\r\n\tinteractionUp: boolean = true;\r\n\t\r\n\tconstructor(options: IApplicationOption = {}) {\r\n\t\tconst canvas = options.canvas || undefined;\r\n\t\tconst container = options.container || document.body;\r\n\t\tconst transparent = options.transparent || false;\r\n\t\tconst antialias = options.antialias || false;\r\n\t\tconst rendererOptions = {\r\n\t\t\tcanvas, alpha: transparent, antialias\r\n\t\t}\r\n\t\t\r\n\t\tconst renderer = new THREE.WebGLRenderer(rendererOptions);\r\n\t\t\r\n\t\tconst width = options.width || 600;\r\n\t\tconst height = options.height || 400;\r\n\t\tconst resolution = options.resolution || 1;\r\n\t\tconst backgroundColor = options.backgroundColor || 0;\r\n\t\tconst opacity = transparent ? 0 : 1;\r\n\t\tconst autoAdjust = options.autoAdjust || false;\r\n\t\tconst basepath = options.basepath || './';\r\n\t\tconst version = options.version || '';\r\n\t\t\r\n\t\trenderer.setClearColor(backgroundColor, 0);\r\n\t\trenderer.setSize(width, height);\r\n\t\trenderer.setPixelRatio(resolution);\r\n\t\trenderer.autoClear = false;\r\n\t\t\r\n\t\tthis._container = container;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._rendererSize = new THREE.Vector2(width, height);\r\n\t\tthis._basepath = basepath;\r\n\t\tthis._version = version;\r\n\t\t\r\n\t\tconst dom = renderer.domElement;\r\n\t\tdom.style.position = 'absolute';\r\n\t\tconst isSP = isMobile(navigator.userAgent).any;\r\n\t\t\r\n\t\tconst raycaster = new THREE.Raycaster();\r\n\t\tconst mouse = new THREE.Vector2();\r\n\t\tconst event: IInteractionEvent = { type: '', emitted: [], originalEvent: null };\r\n\t\tlet down: DisplayObject[] = [];\r\n\t\tlet over: DisplayObject[] = [];\r\n\t\t\r\n\t\tconst cast = (e: Event, x: number, y: number) => {\r\n\t\t\tevent.originalEvent = e;\r\n\t\t\tevent.emitted = [];\r\n\t\t\t\r\n\t\t\tconst w = dom.offsetWidth;\r\n\t\t\tconst h = dom.offsetHeight;\r\n\t\t\t\r\n\t\t\tmouse.x = (x / w) * 2 - 1;\r\n\t\t\tmouse.y = -(y / h) * 2 + 1;\r\n\t\t\t\r\n\t\t\tconst c = this._views;\r\n\t\t\tfor (let i = c.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tc[i].onInteraction(event, raycaster, mouse);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tconst dispatch = (targets: DisplayObject[], type: string) => {\r\n\t\t\tfor (let i = 0; i < targets.length; i++) {\r\n\t\t\t\ttargets[i].emit(type, event);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tconst separate = (_first: DisplayObject[], _emitted: DisplayObject[]) => {\r\n\t\t\tconst first: DisplayObject[] = _first.concat([]);\r\n\t\t\tconst emitted: DisplayObject[] = _emitted.concat([]);\r\n\t\t\tconst both: DisplayObject[] = [];\r\n\t\t\t\r\n\t\t\tfor (let i = first.length - 1; i >= 0; i--) {\r\n\t\t\t\tconst p = first[i];\r\n\t\t\t\tconst index = emitted.indexOf(p);\r\n\t\t\t\t\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tfirst.splice(i, 1);\r\n\t\t\t\t\temitted.splice(index, 1);\r\n\t\t\t\t\tboth.push(p);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn { both, first, emitted };\r\n\t\t}\r\n\t\t\r\n\t\tconst startHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tdown = [];\r\n\t\t\tif (!this.interactionDown) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointerdown';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdispatch(event.emitted, 'pointerdown');\r\n\t\t\tdown = event.emitted;\r\n\t\t};\r\n\t\t\r\n\t\tconst moveHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tif (!this.interactionMove) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointermove';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (over.length === 0) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\tdispatch(event.emitted, 'pointerover');\r\n\t\t\t\t\tover = event.emitted;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\tdispatch(over, 'pointerout');\r\n\t\t\t\tover = [];\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst saparated = separate(over, event.emitted);\r\n\t\t\t\r\n\t\t\tdispatch(saparated.emitted, 'pointerover');\r\n\t\t\tdispatch(saparated.first, 'pointerout');\r\n\t\t\tover = event.emitted;\r\n\t\t\t\r\n\t\t\tdispatch(saparated.both, 'pointermove');\r\n\t\t}\r\n\t\t\r\n\t\tconst endHandler = (e: Event, x: number, y: number) => {\r\n\t\t\tif (!this.interactionUp) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.type = 'system:interaction:pointerup';\r\n\t\t\tcast(e, x, y);\r\n\t\t\t\r\n\t\t\tif (down.length === 0) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\tdispatch(event.emitted, 'pointerup');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (event.emitted.length === 0) {\r\n\t\t\t\tdispatch(down, 'pointerupoutside');\r\n\t\t\t\tdown = [];\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst saparated = separate(down, event.emitted);\r\n\t\t\t\r\n\t\t\tdispatch(saparated.emitted, 'pointerup');\r\n\t\t\tdispatch(saparated.first, 'pointerupoutside');\r\n\t\t\t\r\n\t\t\tdispatch(saparated.both, 'pointerup');\r\n\t\t\tdispatch(saparated.both, 'pointertap');\r\n\t\t\tdown = [];\r\n\t\t}\r\n\t\t\r\n\t\tif (isSP) {\r\n\t\t\tdom.addEventListener('touchstart', e => {\r\n\t\t\t\tstartHandler(e, e.touches[0].clientX - dom.offsetLeft, e.touches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('touchmove', e => {\r\n\t\t\t\tmoveHandler(e, e.touches[0].clientX - dom.offsetLeft, e.touches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('touchend', e => {\r\n\t\t\t\tendHandler(e, e.changedTouches[0].clientX - dom.offsetLeft, e.changedTouches[0].clientY - dom.offsetTop);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdom.addEventListener('mousedown', e => {\r\n\t\t\t\tstartHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('mousemove', e => {\r\n\t\t\t\tmoveHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tdom.addEventListener('mouseup', e => {\r\n\t\t\t\tendHandler(e, e.offsetX, e.offsetY);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\twindow.addEventListener('visibilitychange', e => {\r\n\t\t\tthis._lastTime = e.timeStamp;\r\n\t\t});\r\n\t\t\r\n\t\tconst step = (timestamp: number) => {\r\n\t\t\tconst delta = (timestamp - this._lastTime) * 0.06;\r\n\t\t\tthis._lastTime = timestamp;\r\n\t\t\t\r\n\t\t\tif (!this._playing) {\r\n\t\t\t\trequestAnimationFrame(step);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.update(delta);\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t};\r\n\t\t\r\n\t\trequestAnimationFrame(step);\r\n\t\t\r\n\t\tif (autoAdjust) {\r\n\t\t\tif (autoAdjust === true) {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tthis.fullScreen()\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tautoAdjust(this);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tattachAsync(content: Content) {\r\n\t\treturn content.loadAssetsAsync(this._basepath, this._version)\r\n\t\t\t.then(resources => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: this._rendererSize.width,\r\n\t\t\t\t\theight: this._rendererSize.height,\r\n\t\t\t\t\tresources,\r\n\t\t\t\t\tvars: content.vars\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.then(($: IDeliverData) => {\r\n\t\t\t\tconst viewClasses = content.viewClasses;\r\n\t\t\t\tfor (let i = 0; i < viewClasses.length; i++) {\r\n\t\t\t\t\tthis.addView(new viewClasses[i]($));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn this;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tget element() {\r\n\t\treturn this._renderer.domElement;\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\treturn this._rendererSize.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\treturn this._rendererSize.y;\r\n\t}\r\n\t\r\n\taddView(view: View) {\r\n\t\tthis._views.push(view);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tremoveView(view: View) {\r\n\t\tconst index = this._views.indexOf(view);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._views.splice(index, 1);\r\n\t\t\r\n\t\treturn view;\r\n\t}\r\n\t\r\n\tplay() {\r\n\t\tthis._container.appendChild(this._renderer.domElement);\r\n\t\t\r\n\t\treturn this.start();\r\n\t}\r\n\t\r\n\tstart() {\r\n\t\tthis._playing = true;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tstop() {\r\n\t\tthis._playing = false;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tupdate(delta: number) {\r\n\t\tconst c = this._views;\r\n\t\tconst e: ITickerData = { delta };\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t\t\r\n\t\tthis.render();\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tthis._renderer.setViewport(0, 0, this._rendererSize.x, this._rendererSize.y);\r\n\t\tthis._renderer.clear();\r\n\t\t\r\n\t\tconst c = this._views;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].render(this._renderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget autoAdjuster() {\r\n\t\treturn this._autoAdjuster;\r\n\t}\r\n\t\r\n\tset autoAdjuster(autoAdjuster: TAutoAdjuster) {\r\n\t\tif (this._autoAdjuster) {\r\n\t\t\twindow.removeEventListener('resize', this._autoAdjuster);\r\n\t\t}\r\n\t\t\r\n\t\tif (!autoAdjuster) {\r\n\t\t\tthis._autoAdjuster = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._autoAdjuster = autoAdjuster;\r\n\t\twindow.addEventListener('resize', autoAdjuster);\r\n\t\tautoAdjuster();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified rectangle.\r\n\t * \r\n\t * @param rect Rectangle to adjust.\r\n\t */\r\n\tfullScreen(rect?: IRect) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst r: IRect = rect || {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tif (r.width / r.height > view.width / view.height) {\r\n\t\t\treturn this.adjustHeight(r.height).toCenter(r).toTop(r);\r\n\t\t}\r\n\t\t\r\n\t\treturn this.adjustWidth(r.width).toMiddle(r).toLeft(r);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified width.\r\n\t * \r\n\t * @param width Width to adjust.\r\n\t */\r\n\tadjustWidth(width?: number) {\r\n\t\tconst view: HTMLCanvasElement = this._renderer.domElement;\r\n\t\tconst w: number = width || this._container.offsetWidth || window.innerWidth;\r\n\t\t\r\n\t\tconst h: number = w / view.width * view.height;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.width = `${w}px`;\r\n\t\tview.style.height = `${h}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified height.\r\n\t * \r\n\t * @param height Height to adjust.\r\n\t */\r\n\tadjustHeight(height?: number) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst h: number = height || this._container.offsetHeight || window.innerHeight;\r\n\t\t\r\n\t\tconst w = h / view.height * view.width;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.height = `${h}px`;\r\n\t\tview.style.width = `${w}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Left justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoLeft(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Center justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoCenter(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${(hol.width - this._getViewRect().width) / 2 + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Right justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoRight(horizontal?: IHorizontal) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.width - this._getViewRect().width + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Top justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoTop(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Middle justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoMiddle(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${(ver.height - this._getViewRect().height) / 2 + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Bottom justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoBottom(vertical?: IVertical) {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.height - this._getViewRect().height + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tprivate _getViewRect(): IRect {\r\n\t\tconst view = this._renderer.domElement;\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: parseInt(view.style.left.replace('px', '')),\r\n\t\t\ty: parseInt(view.style.top.replace('px', '')),\r\n\t\t\twidth: parseInt(view.style.width.replace('px', '')),\r\n\t\t\theight: parseInt(view.style.height.replace('px', ''))\r\n\t\t};\r\n\t}\r\n}\r\n","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyPosition {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getPosition().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getPosition().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.y = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getPosition().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.z = value;\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst position = this._object.body.getPosition();\r\n\t\tposition.x = x;\r\n\t\tposition.y = y;\r\n\t\tposition.z = z;\r\n\t\t\r\n\t\tthis._object.body.setPosition(position);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","import { PhysicsObject3D } from './PhysicsObject3D';\r\n\r\nexport class BodyRotation {\r\n\tprivate _object: PhysicsObject3D;\r\n\t\r\n\tconstructor(object: PhysicsObject3D) {\r\n\t\tthis._object = object;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.y = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._object.body.getRotation().toEulerXyz().z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.z = value;\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n\t\r\n\tset(x: number, y?: number, z?: number) {\r\n\t\tif (y === undefined) {\r\n\t\t\ty = x;\r\n\t\t}\r\n\t\t\r\n\t\tif (z === undefined) {\r\n\t\t\tz = y;\r\n\t\t}\r\n\t\t\r\n\t\tconst rotation = this._object.body.getRotation().toEulerXyz();\r\n\t\trotation.x = x;\r\n\t\trotation.y = y;\r\n\t\trotation.z = z;\r\n\t\t\r\n\t\tthis._object.body.setRotationXyz(rotation);\r\n\t\tthis._object.updateTransform();\r\n\t}\r\n}","/*!\n * @tawaship/emitter - v3.1.1\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    _on(type, callback, once) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ callback, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    on(type, callback) {\r\n        return this._on(type, callback, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    once(type, callback) {\r\n        return this._on(type, callback, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Registered callback.\r\n     */\r\n    off(type, callback) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    _emit(type, context, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const targets = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const event = events[i];\r\n            if (event.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            targets.push(event);\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emit(type, ...args) {\r\n        return this._emit(type, this, ...args);\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        return this._emit(type, context, ...args);\r\n    }\r\n    _emitAll(context, ...args) {\r\n        if (context == null) {\r\n            return this;\r\n        }\r\n        const targets = [];\r\n        for (let type in this._events) {\r\n            const events = this._events[type] || [];\r\n            for (let i = events.length - 1; i >= 0; i--) {\r\n                const event = events[i];\r\n                if (event.once) {\r\n                    events.splice(i, 1);\r\n                }\r\n                targets.push(event);\r\n            }\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit all events.\r\n     *\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emitAll(...args) {\r\n        return this._emitAll(this, ...args);\r\n    }\r\n    /**\r\n     * Emit all events with specifying a context.\r\n     *\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemitAll(context, ...args) {\r\n        return this._emitAll(context, ...args);\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove. If it is empty, removes all events.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","/*!\n * @tawaship/task - v1.1.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Task {\r\n    constructor(callbacks, context) {\r\n        this._taskData = {\r\n            context: context == null ? this : context,\r\n            enabled: true,\r\n            index: -1,\r\n            callbacks: [],\r\n            value: null\r\n        };\r\n        this.add(callbacks);\r\n    }\r\n    /**\r\n     * Whether the task works.\r\n     */\r\n    get enabled() {\r\n        return this._taskData.enabled;\r\n    }\r\n    set enabled(enabled) {\r\n        this._taskData.enabled = enabled;\r\n    }\r\n    /**\r\n     * Add the task to the end of the list.\r\n     */\r\n    add(callbacks) {\r\n        if (!Array.isArray(callbacks)) {\r\n            callbacks = [callbacks];\r\n        }\r\n        const list = this._taskData.callbacks;\r\n        const flag = list.length === 0;\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (!(callbacks[i] instanceof Function)) {\r\n                continue;\r\n            }\r\n            list.push(callbacks[i]);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Execute the current task.\r\n     */\r\n    done(...args) {\r\n        if (!this._taskData.enabled) {\r\n            return;\r\n        }\r\n        const task = this._taskData.callbacks[this._taskData.index];\r\n        if (!task) {\r\n            return;\r\n        }\r\n        return this._taskData.value = task.apply(this._taskData.context, args);\r\n    }\r\n    _to(index) {\r\n        this._taskData.index = Number(index);\r\n        return this;\r\n    }\r\n    /**\r\n     * Change the current task to the first task.\r\n     */\r\n    first() {\r\n        return this._to(0);\r\n    }\r\n    /**\r\n     * Change the current task to the previos task.\r\n     */\r\n    prev() {\r\n        return this._to(this._taskData.index - 1);\r\n    }\r\n    /**\r\n     * Change the current task to the next task.\r\n     */\r\n    next() {\r\n        return this._to(this._taskData.index + 1);\r\n    }\r\n    /**\r\n     * Change the current task to the specified task.\r\n     */\r\n    to(index) {\r\n        return this._to(index);\r\n    }\r\n    /**\r\n     * Skips all tasks and changes to the finished state.\r\n     */\r\n    finish() {\r\n        this._taskData.index = -1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Cancel all task and leave them unregistered.\r\n     */\r\n    reset() {\r\n        this._taskData.callbacks = [];\r\n        this._taskData.index = -1;\r\n        this._taskData.value = null;\r\n        return this;\r\n    }\r\n    /**\r\n     * Destroy instance.\r\n     */\r\n    destroy() {\r\n        this.reset();\r\n    }\r\n    /**\r\n     * The value returned by the last task executed.\r\n     */\r\n    get value() {\r\n        return this._taskData.value;\r\n    }\r\n}\n\nexport { Task };\n//# sourceMappingURL=Task.esm.js.map\n","import * as THREE from 'three';\r\nimport { Emitter } from '@tawaship/emitter';\r\nimport { Task } from '@tawaship/task';\r\n\r\nexport interface IInteractionEvent extends THREE.Event {\r\n\ttype: string;\r\n\temitted: DisplayObject[];\r\n\toriginalEvent: Event | null;\r\n};\r\n\r\nexport interface ITickerData {\r\n\tdelta: number;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _box = new THREE.Box3();\r\n\r\nexport abstract class DisplayObject<T extends THREE.Object3D = THREE.Object3D> extends Emitter {\r\n\tprotected _three: T;\r\n\tprotected _sub: T;\r\n\tprotected _size: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _pivot: THREE.Vector3 = new THREE.Vector3();\r\n\tprotected _children: DisplayObject[] = [];\r\n\tprotected _task: Task;\r\n\t\r\n\tinteractive: boolean = false;\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._three = this._sub = three;\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerdown', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerup', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointermove', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthree.addEventListener('system:interaction:pointerupoutside', event => {\r\n\t\t\tif (!this.interactive) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tevent.emitted.push(this);\r\n\t\t});\r\n\t\t\r\n\t\tthis._task = new Task([], this);\r\n\t\tthis._task.first();\r\n\t}\r\n\t\r\n\tget three() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget task() {\r\n\t\treturn this._task;\r\n\t}\r\n\t\r\n\tget parent(): DisplayObject | null {\r\n\t\treturn this._three.userData.parent;\r\n\t}\r\n\t\r\n\tget children() {\r\n\t\treturn this._children;\r\n\t}\r\n\t\r\n\tupdateTask(e: ITickerData) {\r\n\t\tthis._task.done(e);\r\n\t}\r\n\t\r\n\tget width() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.x;\r\n\t}\r\n\t\r\n\tget height() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.y;\r\n\t}\r\n\t\r\n\tget depth() {\r\n\t\tthis.updateBoundingBox();\r\n\t\treturn this._size.z * this.scale.z;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._three.position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._three.position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._three.position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._three.position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._three.position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._three.position.z = value;\r\n\t}\r\n\t\r\n\t/*\r\n\tget position() {\r\n\t\treturn this._three.position;\r\n\t}\r\n\t*/\r\n\t\r\n\tget scale() {\r\n\t\treturn this._three.scale;\r\n\t}\r\n\t\r\n\tget pivot() {\r\n\t\treturn this._pivot;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTransform();\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\tabstract updateTransform(): void;\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis.updateTransform();\r\n\t\t\r\n\t\t_box.setFromObject(this._sub);\r\n\t\t_box.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\taddChild(object: DisplayObject) {\r\n\t\tif (object.parent) {\r\n\t\t\tobject.parent.removeChild(object);\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.push(object);\r\n\t\tthis._sub.add(object.three);\r\n\t\tobject.three.userData.parent = this;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: DisplayObject) {\r\n\t\tif (object.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._children.indexOf(object);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._children.splice(index, 1);\r\n\t\tthis._sub.remove(object.three);\r\n\t\tobject.three.userData.parent = null;\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object3D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tget rotation() {\r\n\t\treturn this._three.rotation;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { IRect } from './Application';\r\n\r\nexport class Camera extends Object3D<THREE.Camera> {\r\n\tprivate _viewport: IRect;\r\n\t\r\n\tconstructor(camera: THREE.Camera, viewport: IRect) {\r\n\t\tsuper(camera);\r\n\t\t\r\n\t\tthis._viewport = viewport;\r\n\t}\r\n\t\r\n\tget camera() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\tget viewport() {\r\n\t\treturn this._viewport;\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer, scene: THREE.Scene) {\r\n\t\trenderer.setViewport(this._viewport.x, this._viewport.y, this._viewport.width, this._viewport.height);\r\n\t\trenderer.render(scene, this._three);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { DisplayObject } from './DisplayObject';\r\n\r\nexport abstract class Object2D<T extends THREE.Object3D = THREE.Object3D> extends DisplayObject<T> {\r\n\tprotected _skew: THREE.Vector2 = new THREE.Vector2();\r\n\t\r\n\tconstructor(three: T) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthree.matrixAutoUpdate = false;\r\n\t}\r\n\t\r\n\tget skew() {\r\n\t\treturn this._skew;\r\n\t}\r\n\t\r\n\tget rotation() {\r\n\t\treturn this._three.rotation.z;\r\n\t}\r\n\t\r\n\tset rotation(value) {\r\n\t\tthis._three.rotation.z = value;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._updateMatrix();\r\n\t}\r\n\t\r\n\t_updateMatrix() {\r\n\t\tconst x = this.x;\r\n\t\tconst y = this.y;\r\n\t\tconst z = this._three.position.z;\r\n\t\tconst scaleX = this.scale.x;\r\n\t\tconst scaleY = this.scale.y;\r\n\t\tconst skewX = this.skew.x;\r\n\t\tconst skewY = this.skew.y;\r\n\t\tconst rotation = this.rotation;\r\n\t\tconst pivotX = this.pivot.x;\r\n\t\tconst pivotY = this.pivot.y;\r\n\t\t\r\n\t\tconst a = Math.cos(rotation + skewY) * scaleX;\r\n\t\tconst b = Math.sin(rotation + skewY) * scaleX;\r\n\t\tconst c = -Math.sin(rotation - skewX) * scaleY;\r\n\t\tconst d = Math.cos(rotation - skewX) * scaleY;\r\n\t\tconst tx = x - ((pivotX * a) + (pivotY * c));\r\n\t\tconst ty = y - ((pivotX * b) + (pivotY * d));\r\n\t\t\r\n\t\tthis._three.matrix.set(\r\n\t\t\ta, c, 0, tx, \r\n\t\t\tb, d, 0, ty,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\t\t);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\n\r\nexport class Container2D extends Object2D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\t_updateOrder() {\r\n\t\tconst c = this._children;\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tc[i].three.position.z = i * 0.0000001;\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.remove(this._sub);\r\n\t\tfor (let i = 0; i < this._children.length; i++) {\r\n\t\t\tthis._children[i].updateTransform();\r\n\t\t}\r\n\t\tsuper.updateBoundingBox();\r\n\t\tthis._three.add(this._sub)\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\n\r\nexport class Container3D extends Object3D<THREE.Group> {\r\n\tconstructor() {\r\n\t\tsuper(new THREE.Group());\r\n\t\t\r\n\t\tthis._sub = new THREE.Group();\r\n\t\tthis._three.add(this._sub);\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._sub.position.x = -this._pivot.x;\r\n\t\tthis._sub.position.y = -this._pivot.y;\r\n\t\tthis._sub.position.z = -this._pivot.z;\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.remove(this._sub);\r\n\t\tsuper.updateBoundingBox();\r\n\t\tthis._three.add(this._sub)\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { GLTFLoader, GLTF } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { View } from './View';\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolvePath(path: string, basepath: string) {\r\n\tif (path.indexOf('http://') === 0 || path.indexOf('https://') === 0 || path.indexOf('//') === 0 || path.indexOf('/') === 0) {\r\n\t\treturn path;\r\n\t} else {\r\n\t\treturn basepath.replace(/^(.+)\\/$/, '$1') + '/' + path;\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction resolveVersion(url: string, version: string) {\r\n\tif (!version) {\r\n\t\treturn url;\r\n\t}\r\n\t\r\n\treturn `${url}${url.match(/\\?/) ? '&' : '?'}_fv=${version}`;\r\n}\r\n\r\nexport interface IAssetDefinitionDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface IAssetDictionary<T> {\r\n\t[key: string]: T;\r\n}\r\n\r\nexport interface ITextureDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface ITextureDictionary extends IAssetDictionary<THREE.Texture> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadTexturesAsync(data: ITextureDefinitionDictionary, basepath: string, version: string): Promise<ITextureDictionary> {\r\n\tconst loader = new THREE.TextureLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst textures: ITextureDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, texture => {\r\n\t\t\t\t\ttextures[i] = texture;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => textures);\r\n}\r\n\r\nexport interface IGLTFDefinitionDictionary extends IAssetDefinitionDictionary<string> {\r\n\r\n}\r\n\r\nexport interface IGLTFDictionary extends IAssetDictionary<GLTF> {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadGLTFsAsync(data: IGLTFDefinitionDictionary, basepath: string, version: string): Promise<IGLTFDictionary> {\r\n\tconst loader = new GLTFLoader();\r\n\tconst promises: Promise<void>[] = [];\r\n\tconst models: IGLTFDictionary = {};\r\n\t\r\n\tfor (let i in data) {\r\n\t\tpromises.push(\r\n\t\t\tnew Promise<void>((resolve, reject) => {\r\n\t\t\t\tconst url = resolveVersion(resolvePath(data[i], basepath), version);\r\n\t\t\t\tloader.load(url, model => {\r\n\t\t\t\t\tmodels[i] = model;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, undefined, e => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises).then(() => models);\r\n}\r\n\r\nexport interface IAssetLoaderDelegate<T> {\r\n\t(data: { [key: string]: any }, basepath: string, version: string): Promise<IAssetDictionary<T>>;\r\n}\r\n\r\nexport interface IResourceDictionary {\r\n\t[key: string]: IAssetDictionary<any>;\r\n}\r\n\r\nexport interface IVariableDictionary {\r\n\t[key: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _assetLoaders: { [key: string]: IAssetLoaderDelegate<any> } = {};\r\n\r\nexport class Content {\r\n\tprivate _assetDefines: { [ley: string]: IAssetDictionary<any> } = {};\r\n\tprivate _viewClasses: typeof View[] = [];\r\n\tprivate _vars: IVariableDictionary = {};\r\n\t\r\n\tget viewClasses() {\r\n\t\treturn this._viewClasses;\r\n\t}\r\n\t\r\n\tget vars() {\r\n\t\treturn Object.assign({}, this._vars);\r\n\t}\r\n\t\r\n\tdefineViews(viewClasses: typeof View | typeof View[]) {\r\n\t\tif (!Array.isArray(viewClasses)) {\r\n\t\t\tviewClasses = [ viewClasses ];\r\n\t\t}\r\n\t\t\r\n\t\tviewClasses.forEach(viewClass => {\r\n\t\t\tthis._viewClasses.push(viewClass);\r\n\t\t});\r\n\t}\r\n\t\r\n\tdefineAssets<T>(key: string, data: IAssetDefinitionDictionary<T>) {\r\n\t\tthis._assetDefines[key] = this._assetDefines[key] || {};\r\n\t\t\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._assetDefines[key][i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tdefineTextures(data: ITextureDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('textures', data);\r\n\t}\r\n\t\r\n\tdefineGLBs(data: IGLTFDefinitionDictionary) {\r\n\t\tthis.defineAssets<string>('glbs', data);\r\n\t}\r\n\t\r\n\tloadAssetsAsync(basepath: string, version: string) {\r\n\t\tconst promises: Promise<IAssetDictionary<any>>[] = [];\r\n\t\tconst resources: IResourceDictionary = {};\r\n\t\t\r\n\t\tfor (let i in this._assetDefines) {\r\n\t\t\tif (!(i in _assetLoaders)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpromises.push(\r\n\t\t\t\t_assetLoaders[i](this._assetDefines[i], basepath, version)\r\n\t\t\t\t\t.then((assets: IAssetDictionary<any>) => {\r\n\t\t\t\t\t\treturn resources[i] = assets;\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises).then(() => resources);\r\n\t}\r\n\t\r\n\tdefineVars(data: IVariableDictionary) {\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._vars[i] = data[i];\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic registerLoader<T>(key: string, delegate: IAssetLoaderDelegate<T>) {\r\n\t\t_assetLoaders[key] = delegate;\r\n\t}\r\n}\r\n\r\nContent.registerLoader<THREE.Texture>('textures', loadTexturesAsync);\r\nContent.registerLoader<GLTF>('glbs', loadGLTFsAsync);","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Mesh extends Object3D<THREE.Mesh> implements IMesh {\r\n\tprivate _anchor: Anchor;\r\n\t\r\n\tconstructor(geometry: THREE.BufferGeometry, material: THREE.Material) {\r\n\t\tsuper(new THREE.Mesh(geometry, material));\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\tmaterial.transparent = true;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis.updateBoundingBox();\r\n\t\tthis._three.geometry.translate(this._size.x * (0.5 - this._anchor.x), this._size.y * (0.5 - this._anchor.y), this._size.z * (0.5 - this._anchor.z))\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport OIMO from './OIMO';\r\nimport { BodyPosition } from './BodyPosition';\r\nimport { BodyRotation } from './BodyRotation';\r\n\r\nexport class PhysicsObject3D extends Object3D<THREE.Object3D> {\r\n\tprotected _body: OIMO.RigidBody;\r\n\tprotected _contactEnabled: boolean = false;\r\n\tprotected _position: BodyPosition;\r\n\tprotected _rotation: BodyRotation;\r\n\t\r\n\tconstructor(three: THREE.Object3D, body: OIMO.RigidBody) {\r\n\t\tsuper(three);\r\n\t\t\r\n\t\tthis._body = body;\r\n\t\tthis._position = new BodyPosition(this);\r\n\t\tthis._rotation = new BodyRotation(this);\r\n\t\t\r\n\t\tbody.userData.ref = this;\r\n\t}\r\n\t\r\n\tget body() {\r\n\t\treturn this._body;\r\n\t}\r\n\t\r\n\tget x() {\r\n\t\treturn this._position.x;\r\n\t}\r\n\t\r\n\tset x(value) {\r\n\t\tthis._position.x = value;\r\n\t}\r\n\t\r\n\tget y() {\r\n\t\treturn this._position.y;\r\n\t}\r\n\t\r\n\tset y(value) {\r\n\t\tthis._position.y = value;\r\n\t}\r\n\t\r\n\tget z() {\r\n\t\treturn this._position.z;\r\n\t}\r\n\t\r\n\tset z(value) {\r\n\t\tthis._position.z = value;\r\n\t}\r\n\t\r\n\tget position() {\r\n\t\treturn this._position;\r\n\t}\r\n\t\r\n\t// @ts-ignore\r\n\tget rotation() {\r\n\t\treturn this._rotation;\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\tthis._three.position.copy(this._body.getPosition());\r\n\t\tthis._three.quaternion.copy(this._body.getOrientation());\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object3D } from './Object3D';\r\nimport { Camera } from './Camera';\r\nimport { IInteractionEvent, ITickerData } from './DisplayObject';\r\nimport { IDeliverData } from './IDeliverData';\r\n\r\nexport class View extends Object3D<THREE.Scene> {\r\n\tprivate _cameras: Camera[] = [];\r\n\t\r\n\tconstructor($?: IDeliverData) {\r\n\t\tsuper(new THREE.Scene());\r\n\t\t\r\n\t\tthis.interactive = true;\r\n\t}\r\n\t\r\n\tget scene() {\r\n\t\treturn this._three;\r\n\t}\r\n\t\r\n\taddCamera(camera: Camera) {\r\n\t\tif (camera.parent) {\r\n\t\t\tcamera.parent.removeChild(camera);\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.push(camera);\r\n\t\tthis._three.add(camera.three);\r\n\t\tcamera.three.userData.parent = this;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tremoveCamera(camera: Camera) {\r\n\t\tif (camera.parent !== this) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst index = this._cameras.indexOf(camera);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._cameras.splice(index, 1);\r\n\t\tthis._three.remove(camera.three);\r\n\t\tcamera.three.userData.parent = null;\r\n\t\t\r\n\t\treturn camera;\r\n\t}\r\n\t\r\n\tadd(three: THREE.Object3D) {\r\n\t\tthis._three.add(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tremove(three: THREE.Object3D) {\r\n\t\tthis._three.remove(three);\r\n\t\t\r\n\t\treturn three;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n\t\r\n\trender(renderer: THREE.WebGLRenderer) {\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\trenderer.clearDepth();\r\n\t\t\tc[i].render(renderer, this._three);\r\n\t\t}\r\n\t}\r\n\t\r\n\tonInteraction(event: IInteractionEvent, raycaster: THREE.Raycaster, mouse: THREE.Vector2) {\r\n\t\tif (!this.interactive) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst c = this._cameras;\r\n\t\t\r\n\t\tfor (let i = 0; i < c.length; i++) {\r\n\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\traycaster.setFromCamera(mouse, c[i].camera);\r\n\t\t\t\r\n\t\t\tconst f: (p: THREE.Object3D) => THREE.Object3D[] = (p: THREE.Object3D) => {\r\n\t\t\t\treturn p.children.map(p => {\r\n\t\t\t\t\tif (p instanceof THREE.Mesh) {\r\n\t\t\t\t\t\treturn p;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn f(p);\r\n\t\t\t\t}).flat();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst meshes = f(this._three);\r\n\t\t\t\r\n\t\t\tconst intersects = raycaster.intersectObjects(meshes);\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < intersects.length; i++) {\r\n\t\t\t\tif (event.emitted.length > 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet p = intersects[i].object;\r\n\t\t\t\twhile (p !== this._three) {\r\n\t\t\t\t\tp.dispatchEvent(event);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!p.parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tp = p.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdateTransform() {\r\n\t\r\n\t}\r\n}\r\n","declare namespace OIMO {\r\n\tclass CommonConstructor {\r\n\t\tconstructor(...args: any[]);\r\n\t\t[key: string]: any;\r\n\t}\r\n\t\r\n\texport class World extends CommonConstructor {}\r\n\t\r\n\texport class RigidBody extends CommonConstructor {}\r\n\t\r\n\texport class RigidBodyConfig extends CommonConstructor {}\r\n\t\r\n\texport class Shape extends CommonConstructor {}\r\n\t\r\n\texport class ShapeConfig extends CommonConstructor {}\r\n\t\r\n\texport class ContactCallback extends CommonConstructor {}\r\n\t\r\n\texport class AabbTestCallback extends CommonConstructor {}\r\n\t\r\n\texport class Vec3 extends CommonConstructor {}\r\n\t\r\n\texport namespace RigidBodyType {\r\n\t\texport const STATIC: number;\r\n\t\texport const DYNAMIC: number;\r\n\t\texport const KINEMATIC: number;\r\n\t}\r\n}\r\n\r\nexport default OIMO;","import * as THREE from 'three';\r\nimport { View } from './View';\r\nimport { ITickerData } from './DisplayObject';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { Shape, SensoredShape } from './Shape';\r\nimport OIMO from './OIMO';\r\n\r\nexport class PhysicsView extends View {\r\n\tprivate _world: any;\r\n\tprivate _sensoredShapes: SensoredShape[] = [];\r\n\tprivate _onShapeAdded: (shape: SensoredShape) => void;\r\n\tprivate _onShapeRemoved: (shape: SensoredShape) => void;\r\n\tdeclare protected _children: PhysicsObject3D[];\r\n\tphysicsEnabled: boolean = true;\r\n\t\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._world = new OIMO.World();\r\n\t\tthis._world.setGravity(new OIMO.Vec3(0, -9.8, 0));\r\n\t\t\r\n\t\tthis._onShapeAdded = (shape: SensoredShape) => {\r\n\t\t\tconst index = this._sensoredShapes.indexOf(shape);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tthis._sensoredShapes.push(shape);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._onShapeRemoved = (shape: SensoredShape) => {\r\n\t\t\tconst index = this._sensoredShapes.indexOf(shape);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tthis._sensoredShapes.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tget world() {\r\n\t\treturn this._world;\r\n\t}\r\n\t\r\n\tget children() {\r\n\t\treturn this._children;\r\n\t}\r\n\t\r\n\taddChild(object: PhysicsObject3D) {\r\n\t\tsuper.addChild(object);\r\n\t\t\r\n\t\tthis._world.addRigidBody(object.body);\r\n\t\t\r\n\t\tconst sensoredShapes = object.body.getSensoredShapeList();\r\n\t\tfor (let i = 0; i < sensoredShapes.length; i++) {\r\n\t\t\tthis._onShapeAdded(sensoredShapes[i]);\r\n\t\t}\r\n\t\t\r\n\t\tobject.body.on('sensoredShapeAdded', this._onShapeAdded);\r\n\t\tobject.body.on('sensoredShapeRemoved', this._onShapeRemoved);\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t\r\n\tremoveChild(object: PhysicsObject3D) {\r\n\t\tconst o = super.removeChild(object);\r\n\t\t\r\n\t\tif (!o) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._world.removeRigidBody(object.body);\r\n\t\t\r\n\t\tconst sensoredShapes = object.body.getSensoredShapeList();\r\n\t\tfor (let i = 0; i < sensoredShapes.length; i++) {\r\n\t\t\tthis._onShapeRemoved(sensoredShapes[i]);\r\n\t\t}\r\n\t\t\r\n\t\tobject.body.off('sensoredShapeAdded', this._onShapeAdded);\r\n\t\tobject.body.off('sensoredShapeRemoved', this._onShapeRemoved);\r\n\t\t\r\n\t\treturn o;\r\n\t}\r\n\t\r\n\tupdate(e: ITickerData) {\r\n\t\tif (this.physicsEnabled) {\r\n\t\t\tthis._world.step(1 / 60);\r\n\t\t\t\r\n\t\t\t/*\r\n\t\t\tlet body = this._world.getRigidBodyList();\r\n\t\t\twhile (body) {\r\n\t\t\t\tconst object = body.userData.ref;\r\n\t\t\t\tif (object.sensorEnabled) {\r\n\t\t\t\t\tobject.aabbTest(this._world);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tbody = body.getNext();\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < this._sensoredShapes.length; i++) {\r\n\t\t\t\tthis._sensoredShapes[i].aabbTest(this._world);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.updateTask(e);\r\n\t\t\r\n\t\tconst c = this._children;\r\n\t\tfor (let i in this._children) {\r\n\t\t\tc[i].update(e);\r\n\t\t}\r\n\t}\r\n}\r\n","import OIMO from './OIMO';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { RigidBody } from './RigidBody';\r\nimport { Emitter, IEmitterDelegate } from '@tawaship/emitter';\r\n\r\nexport interface IContactData {\r\n\thit: Shape;\r\n\toriginalEvent: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst contactCallback = new OIMO.ContactCallback();\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction contactHandler(type: string, e: any) {\r\n\tconst selfShape: Shape = e.getShape1();\r\n\tconst opponentShape: Shape = e.getShape2();\r\n\t\r\n\tevent.originalEvent = e;\r\n\tevent.hit = opponentShape;\r\n\tselfShape.emit(type, event);\r\n}\r\n\r\ncontactCallback.beginContact = (e: any) => {\r\n\tcontactHandler('beginContact', e);\r\n};\r\ncontactCallback.endContact = (e: any) => {\r\n\tcontactHandler('endContact', e);\r\n};\r\ncontactCallback.preSolve = (e: any) => {\r\n\tcontactHandler('preSolve', e);\r\n};\r\ncontactCallback.postSolve = (e: any) => {\r\n\tcontactHandler('postSolve', e);\r\n};\r\n\r\nexport class Shape extends OIMO.Shape {\r\n\tprotected _collisionGroup: number;\r\n\tprotected _collisionMask: number;\r\n\tprotected _collisionEnabled: boolean = true;\r\n\tprotected _contactEnabled: boolean = false;\r\n\tprivate _emitter: Emitter = new Emitter();\r\n\t\r\n\tconstructor(shapeConfig: OIMO.ShapeConfig) {\r\n\t\tsuper(shapeConfig);\r\n\t\t\r\n\t\tthis._collisionGroup = this.getCollisionGroup();\r\n\t\tthis._collisionMask = this.getCollisionMask();\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\ton(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.on(type, callback);\r\n\t}\r\n\t\r\n\toff(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.off(type, callback);\r\n\t}\r\n\t\r\n\temit(type: string, ...args: any[]) {\r\n\t\tthis._emitter.cemit(type, this, ...args);\r\n\t}\r\n\t\r\n\tget collisionGroup() {\r\n\t\treturn this._collisionGroup;\r\n\t}\r\n\t\r\n\tget collisionMask() {\r\n\t\treturn this._collisionMask;\r\n\t}\r\n\t\r\n\tget collisionEnabled() {\r\n\t\treturn this._collisionEnabled;\r\n\t}\r\n\t\r\n\tset collisionEnabled(value: boolean) {\r\n\t\tthis._collisionEnabled = value;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tget contectEnabled() {\r\n\t\treturn this._contactEnabled;\r\n\t}\r\n\t\r\n\tset contactEnabled(value: boolean) {\r\n\t\tthis._contactEnabled = value;\r\n\t\t\r\n\t\tif (value) {\r\n\t\t\tthis.setContactCallback(contactCallback);\r\n\t\t} else {\r\n\t\t\tthis.setContactCallback(null);\r\n\t\t}\r\n\t}\r\n\t\r\n\tsetCollisionGroup(collisionGroup: number) {\r\n\t\tthis._collisionGroup = collisionGroup;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t}\r\n\t\r\n\tsetCollisionMask(collisionMask: number) {\r\n\t\tthis._collisionMask = collisionMask;\r\n\t\t\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tprotected _setCollisionGroup(collisionGroup: number) {\r\n\t\tsuper.setCollisionGroup(collisionGroup);\r\n\t}\r\n\t\r\n\tprotected _setCollisionMask(collisionMask: number) {\r\n\t\tsuper.setCollisionMask(collisionMask);\r\n\t}\r\n\t\r\n\tprotected _updateCollisionGroup() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionGroup);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionMask() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionMask);\r\n\t\t}\r\n\t}\r\n\t\r\n\tgetObject() {\r\n\t\tconst body = this.getRigidBody();\r\n\t\tif (!body) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\treturn body.getObject();\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst event: IContactData = { hit: new Shape(new OIMO.ShapeConfig()), originalEvent: null };\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction sensorHandler(type: string, selfShape: SensoredShape, opponentShape: Shape) {\r\n\tevent.originalEvent = null;\r\n\tevent.hit = opponentShape;\r\n\tselfShape.emit(type, event);\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction getObject(shape: SensoredShape) {\r\n\tconst body = shape.getRigidBody();\r\n\tif (!body) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\treturn body.getObject();\r\n}\r\n\r\nexport class SensoredShape extends Shape {\r\n\tprivate _sensorEnabled: boolean = true;\r\n\tprotected _aabbTestCallback: OIMO.AabbTestCallback = new OIMO.AabbTestCallback();\r\n\tprotected _touchedShapes: Shape[] = [];\r\n\tprotected _touchShapes: Shape[] = [];\r\n\t\r\n\tconstructor(shapeConfig: OIMO.ShapeConfig) {\r\n\t\tsuper(shapeConfig);\r\n\t\t\r\n\t\tthis.contactEnabled = true;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t\t\r\n\t\tthis._aabbTestCallback.process = (shape: Shape) => {\r\n\t\t\tif ((this._collisionMask & shape.collisionGroup) === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif ((this._collisionGroup & shape.collisionMask) === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst index = this._touchedShapes.indexOf(shape);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tsensorHandler('beginContact', this, shape);\r\n\t\t\t} else {\r\n\t\t\t\tthis._touchedShapes.splice(index, 1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._touchShapes.push(shape);\r\n\t\t};\r\n\t}\r\n\t\r\n\tget sensorEnabled() {\r\n\t\treturn this._sensorEnabled;\r\n\t}\r\n\t\r\n\tset sensorEnabled(value: boolean) {\r\n\t\tthis._sensorEnabled = value;\r\n\t\t\r\n\t\tthis._updateCollisionGroup();\r\n\t\tthis._updateCollisionMask();\r\n\t}\r\n\t\r\n\tget isSensor() {\r\n\t\treturn this._collisionEnabled && this._contactEnabled && this._sensorEnabled;\r\n\t}\r\n\t\r\n\taabbTest(world: OIMO.World) {\r\n\t\tif (!this.isSensor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._touchedShapes = this._touchShapes;\r\n\t\tthis._touchShapes = [];\r\n\t\t\r\n\t\tworld.aabbTest(this.getAabb(), this._aabbTestCallback);\r\n\t\t\r\n\t\tfor (let i = 0; i < this._touchedShapes.length; i++) {\r\n\t\t\tsensorHandler('endContact', this, this._touchedShapes[i]);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionGroup() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else if (this._sensorEnabled) {\r\n\t\t\tthis._setCollisionGroup(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionGroup(this._collisionGroup);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotected _updateCollisionMask() {\r\n\t\tif (!this._collisionEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else if (this._sensorEnabled) {\r\n\t\t\tthis._setCollisionMask(0);\r\n\t\t} else {\r\n\t\t\tthis._setCollisionMask(this._collisionMask);\r\n\t\t}\r\n\t}\r\n}","import OIMO from './OIMO';\r\nimport { Shape, SensoredShape } from './Shape';\r\nimport { PhysicsObject3D } from './PhysicsObject3D';\r\nimport { Emitter, IEmitterDelegate } from '@tawaship/emitter';\r\n\r\nexport type TShape = Shape | SensoredShape;\r\n\r\nexport class RigidBody extends OIMO.RigidBody {\r\n\tprivate _emitter: Emitter = new Emitter();\r\n\t\r\n\tdeclare userData: { ref: PhysicsObject3D | null };\r\n\t\r\n\tconstructor(rigidBodyConfig: OIMO.RigidBodyConfig) {\r\n\t\tsuper(rigidBodyConfig);\r\n\t\t\r\n\t\tthis.userData = { ref: null };\r\n\t}\r\n\t\r\n\tgetObject(): PhysicsObject3D | null {\r\n\t\treturn this.userData.ref;\r\n\t}\r\n\t\r\n\ton(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.on(type, callback);\r\n\t}\r\n\t\r\n\toff(type: string, callback: IEmitterDelegate) {\r\n\t\tthis._emitter.off(type, callback);\r\n\t}\r\n\t\r\n\temit(type: string, ...args: any[]) {\r\n\t\tthis._emitter.cemit(type, this, ...args);\r\n\t}\r\n\t\r\n\tgetSensoredShapeList(): TShape[] {\r\n\t\tconst res: SensoredShape[] = [];\r\n\t\t\r\n\t\tlet shape = this.getShapeList();\r\n\t\twhile (shape) {\r\n\t\t\tif (shape instanceof SensoredShape) {\r\n\t\t\t\tres.push(shape);\r\n\t\t\t}\r\n\t\t\tshape = shape.getNext();\r\n\t\t}\r\n\t\t\r\n\t\treturn res;\r\n\t}\r\n\t\r\n\taddShape(shape: Shape | SensoredShape) {\r\n\t\tsuper.addShape(shape);\r\n\t\t\r\n\t\tif (shape instanceof SensoredShape) {\r\n\t\t\tthis.emit('sensoredShapeAdded', shape);\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveShape(shape: Shape | SensoredShape) {\r\n\t\tsuper.removeShape(shape);\r\n\t\t\r\n\t\tif (shape instanceof SensoredShape) {\r\n\t\t\tthis.emit('sensoredShapeRemoved', shape);\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic createStatic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.STATIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n\t\r\n\tstatic createDynamic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.DYNAMIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n\t\r\n\tstatic createKinematic() {\r\n\t\tconst rigidBodyConfig = new OIMO.RigidBodyConfig();\r\n\t\trigidBodyConfig.type = OIMO.RigidBodyType.KINEMATIC;\r\n\t\t\r\n\t\treturn new RigidBody(rigidBodyConfig);\r\n\t}\r\n}","import * as THREE from 'three';\r\nimport { Object2D } from './Object2D';\r\nimport { Anchor } from './Anchor';\r\nimport { IMesh } from './IMesh'\r\n\r\nexport class Sprite extends Object2D<THREE.Mesh> implements IMesh {\r\n\tprivate _texture: THREE.Texture;\r\n\tprivate _anchor: Anchor;\r\n\tprivate _material: THREE.MeshBasicMaterial;\r\n\tprivate _width: number = 0;\r\n\tprivate _height: number = 0;\r\n\t\r\n\tconstructor(texture: THREE.Texture) {\r\n\t\tsuper(new THREE.Mesh());\r\n\t\t\r\n\t\tthis._anchor = new Anchor(0, 0, 0, this);\r\n\t\t\r\n\t\tthis._material = new THREE.MeshBasicMaterial();\r\n\t\tthis._material.transparent = true;\r\n\t\t\r\n\t\tthis._three.material = this._material;\r\n\t\t\r\n\t\tthis._texture = texture;\r\n\t\tthis.texture = texture;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this._texture;\r\n\t}\r\n\t\r\n\tset texture(texture) {\r\n\t\tthis._texture = texture;\r\n\t\tthis._material.needsUpdate = true;\r\n\t\tthis._material.map = texture;\r\n\t\t\r\n\t\tif (texture && texture.image) {\r\n\t\t\tthis._updateGeometry(texture.image.width, texture.image.height);\r\n\t\t} else {\r\n\t\t\tthis._updateGeometry(0, 0);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget anchor() {\r\n\t\treturn this._anchor;\r\n\t}\r\n\t\r\n\t_updateGeometry(width: number, height: number) {\r\n\t\tthis._three.geometry = new THREE.PlaneGeometry(width, height);\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tthis.updateGeometryPosition();\r\n\t}\r\n\t\r\n\tupdateGeometryPosition() {\r\n\t\tthis._three.geometry.center();\r\n\t\tthis._three.geometry.translate(this._width * (0.5 - this._anchor.x), this._height * (0.5 - this._anchor.y), 0)\r\n\t}\r\n\t\r\n\tupdateBoundingBox() {\r\n\t\tthis._three.geometry.computeBoundingBox();\r\n\t\tthis._three.geometry.boundingBox && this._three.geometry.boundingBox.getSize(this._size);\r\n\t\tthis._size.multiply(this.scale);\r\n\t}\r\n\t\r\n\tstatic from(url: string, callback: (sprite: Sprite) => void) {\r\n\t\tconst sprite = new Sprite(new THREE.TextureLoader().load(url, texture => {\r\n\t\t\tsprite.texture = texture;\r\n\t\t\tcallback && callback(sprite);\r\n\t\t}));\r\n\t\t\r\n\t\treturn sprite;\r\n\t}\r\n}"],"names":["Anchor","x","y","z","mesh","this","_x","_y","_z","_mesh","prototypeAccessors","value","updateGeometryPosition","set","undefined","appleIphone","appleIpod","appleTablet","appleUniversal","androidPhone","androidTablet","amazonPhone","amazonTablet","windowsPhone","windowsTablet","otherBlackBerry","otherBlackBerry10","otherOpera","otherChrome","otherFirefox","isAppleTabletOnIos13","navigator","platform","maxTouchPoints","MSStream","Application","options","const","canvas","container","document","body","rendererOptions","alpha","transparent","antialias","renderer","THREE.WebGLRenderer","width","height","resolution","backgroundColor","autoAdjust","basepath","version","setClearColor","setSize","setPixelRatio","autoClear","_container","_renderer","_rendererSize","THREE.Vector2","_basepath","_version","dom","domElement","style","position","isSP","param","nav","userAgent","tmp","split","match","regex","test","createMatch","result","apple","phone","ipod","tablet","universal","device","amazon","android","windows","other","blackberry","blackberry10","opera","firefox","chrome","any","isMobile","raycaster","THREE.Raycaster","mouse","event","type","emitted","originalEvent","down","over","cast","e","w","offsetWidth","h","offsetHeight","c","_views","i","length","onInteraction","dispatch","targets","let","emit","separate","_first","_emitted","first","concat","both","p","index","indexOf","splice","push","startHandler","interactionDown","moveHandler","interactionMove","saparated","endHandler","interactionUp","addEventListener","touches","clientX","offsetLeft","clientY","offsetTop","changedTouches","offsetX","offsetY","window","_lastTime","timeStamp","step","timestamp","delta","_playing","update","requestAnimationFrame","autoAdjuster","fullScreen","attachAsync","content","loadAssetsAsync","then","resources","vars","$","viewClasses","addView","element","view","removeView","play","appendChild","start","stop","render","setViewport","clear","_autoAdjuster","removeEventListener","rect","r","innerWidth","innerHeight","adjustHeight","toCenter","toTop","adjustWidth","toMiddle","toLeft","horizontal","hol","left","_getViewRect","toRight","vertical","ver","top","toBottom","parseInt","replace","BodyPosition","object","_object","getPosition","setPosition","updateTransform","BodyRotation","getRotation","toEulerXyz","rotation","setRotationXyz","Emitter","_events","_on","callback","once","events","on","off","_emit","context","apply","args","cemit","_emitAll","emitAll","cemitAll","Task","callbacks","_taskData","enabled","add","Array","isArray","list","Function","done","task","_to","Number","prev","next","to","finish","reset","destroy","_box","THREE.Box3","DisplayObject","three","super","THREE.Vector3","_three","_sub","interactive","_task","parent","userData","children","_children","updateTask","updateBoundingBox","_size","depth","scale","pivot","_pivot","setFromObject","getSize","multiply","addChild","removeChild","remove","Object3D","Camera","camera","viewport","_viewport","scene","Object2D","matrixAutoUpdate","skew","_skew","_updateMatrix","scaleX","scaleY","skewX","skewY","pivotX","pivotY","a","Math","cos","b","sin","d","tx","ty","matrix","Container2D","THREE.Group","_updateOrder","Container3D","resolvePath","path","resolveVersion","url","_assetLoaders","Content","_viewClasses","Object","assign","_vars","defineViews","forEach","viewClass","defineAssets","key","data","_assetDefines","defineTextures","defineGLBs","promises","assets","Promise","all","defineVars","registerLoader","delegate","loader","THREE.TextureLoader","textures","resolve","reject","load","texture","GLTFLoader","models","model","Mesh","geometry","material","THREE.Mesh","_anchor","anchor","center","translate","computeBoundingBox","boundingBox","PhysicsObject3D","_body","_position","_rotation","ref","copy","quaternion","getOrientation","View","THREE.Scene","addCamera","_cameras","removeCamera","clearDepth","setFromCamera","f","map","flat","meshes","intersects","intersectObjects","dispatchEvent","OIMO","PhysicsView","_world","World","setGravity","Vec3","_onShapeAdded","shape","_sensoredShapes","_onShapeRemoved","world","addRigidBody","sensoredShapes","getSensoredShapeList","o","removeRigidBody","physicsEnabled","aabbTest","contactCallback","ContactCallback","contactHandler","selfShape","getShape1","opponentShape","getShape2","hit","beginContact","endContact","preSolve","postSolve","Shape","shapeConfig","_collisionGroup","getCollisionGroup","_collisionMask","getCollisionMask","_updateCollisionGroup","_updateCollisionMask","_emitter","collisionGroup","collisionMask","collisionEnabled","_collisionEnabled","contectEnabled","_contactEnabled","contactEnabled","setContactCallback","setCollisionGroup","setCollisionMask","_setCollisionGroup","_setCollisionMask","getObject","getRigidBody","ShapeConfig","sensorHandler","SensoredShape","AabbTestCallback","_aabbTestCallback","process","_touchedShapes","_touchShapes","prototypeAccessors$1","sensorEnabled","_sensorEnabled","isSensor","getAabb","RigidBody","rigidBodyConfig","res","getShapeList","getNext","addShape","removeShape","createStatic","RigidBodyConfig","RigidBodyType","STATIC","createDynamic","DYNAMIC","createKinematic","KINEMATIC","Sprite","_material","THREE.MeshBasicMaterial","_texture","needsUpdate","image","_updateGeometry","THREE.PlaneGeometry","_width","_height","from","sprite"],"mappings":"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"}